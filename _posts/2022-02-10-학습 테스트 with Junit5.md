---
toc: true
layout: post
title: 학습 테스트 with Junit5
description: assertThat, assertThatThrownBy, @BeforeEach, @ValueSource, @CsvSource
categories: [우테코, 테스트, java]
image: "images/posts/wootech.png"
---

## 학습 테스트 with Junit5



- **`학습테스트`: 모듈 사용법 읽히기**  -> **다른사람이 만든 코드(api)를 검증  =  학습 테스트**
- **`단위테스트`: 내가 짠 코드를 검증하기 위해 만드는 테스트**
    - 단위테스트부터 모든 코드를 설계하는 -> **TDD**





### StringTest - assertThat, assertThatThrownBy



1.  **build.gradle에 `assertj`추가 -> depenecies `run` or 우측에 gradle > `Reload All Gradle Project`**

    ```java
    testImplementation 'org.assertj:assertj-core:3.22.0'
    ```

    - `assertThat()`메서드 사용안될 시

        ```java
        import static org.assertj.core.api.Assertions.assertThat;
        import static org.assertj.core.api.Assertions.assertThatThrownBy;
        ```

        



2. `given(data)` -> `when(actual값)` ->  `then(expected넣어서 비교)` 나눠서 코드를 짠다.

    - **배열 Test: `.contains( ) or .containsExactly()` + 콤마로 개별원소 입력**

    ```java
    @Test
    void 숫자2개_분리() {
        //given
        String data = "1,2";
        //when
        String[] actual = data.split(",");
        //then
        //        assertThat(actual).contains("1", "2");
        assertThat(actual).containsExactly("1", "2");
    }
    
    @Test
    void 숫자1개_분리() {
        //given
        String data = "1";
        //when
        String[] actual = data.split(",");
        //then
        //        assertThat(actual).contains("1", "2");
        assertThat(actual).containsExactly("1");
    }
    
    
    @Test
    void 괄호제거() {
        String data = "(1,2)";
        String actual = data.substring(1, 4);
        assertThat(actual).isEqualTo("1,2");
    }
    ```

    



3. **에러 내는 테스트는 `assertThatThrownBy( () -> {} ).isinstanceof();`에다가 `예외이름.class`를 인자로 줘서 해당 예외일때 통과된다.**

    - **필요하다면, `해당에러 + 에러메세지까지 확인`하기 위해 `.hasMessageContaining( "메세지" );`까지 체이닝한다. **

    ```java
    //원하는 에러을 안줬더니... 테스트 통과 못한다.
    @Test
    @DisplayName("문자열 인덱스 에러 테스트1")
    void 문자열_인덱스_테스트() {
        assertThatThrownBy(() -> {
            "abc".charAt(4);
        }).isInstanceOf(IllegalArgumentException.class);
    }
    
    //    java.lang.AssertionError:
    //    Expecting actual throwable to be an instance of:
    //    java.lang.IllegalArgumentException
    //    but was:
    //    java.lang.StringIndexOutOfBoundsException: String index out of range: 4
    
    @Test
    @DisplayName("문자열 인덱스 에러 테스트2")
    void 문자열_인덱스_테스트2() {
        assertThatThrownBy(() -> {
            "abc".charAt(4);
        }).isInstanceOf(StringIndexOutOfBoundsException.class);
    }
    
    @Test
    @DisplayName("문자열 인덱스 에러 테스트3")
    void 문자열_인덱스_테스트3() {
        assertThatThrownBy(() -> {
            "abc".charAt(4);
        }).isInstanceOf(StringIndexOutOfBoundsException.class)
                .hasMessageContaining("String index out of range: 4");
    }
    ```

    





### SetTest - @BeforeEach, @PaprameterizedTest, @ValueSource, @CsvSource

1. **매번 초기화해야하는 변수는 `Test안에서의 class <빈> 변수` + `@BeforeEach`로 정의한 `setUp`메소드에서 `초기화 + 데이터삽입`해준다.**

    ```java
    public class SetTest {
    
        // [빈 변수] -> 매 TEST마다 초기화+데이터 삽입을 반복해준다.
        private HashSet<Integer> numbers;
    
        @BeforeEach
        void setUp() {
            numbers = new HashSet<>();
            numbers.add(1);
            numbers.add(1);
            numbers.add(2);
            numbers.add(3);
        }
    
        @Test
        void 사이즈_확인() {
            //given, when
            int size = numbers.size();
            //then
            assertThat(size).isEqualTo(3);
        }
    }
    ```

    



2. **`@ParameterizedTest`로 중복해서 테스트할 필요없이, `given으로 들어갈 메소드인자` or `given + expected로 들어갈 메소드 인자들**을 지정해서 여러 케이스를 테스트한다.

    - `@ValueSource(ints = {1,2,3,4})`
    - `@CsvSource(value = {"1:true", "2:true", "3:true", "4:false"}, delimiter = `':')

    ```java
    //@ParameterizedTest -> @ValueSource(인자들) or @CsvSource(인자+결과들 with 구분자) 선택 -> 메서드 인자 -> 사용
    //assertThat( actual from 인 ).isTrue()  or  assertEquals( a, e);
    @ParameterizedTest
    @ValueSource(ints = {1,2,3,4})
    public void set_contains(int number) {
        assertThat(numbers.contains(number)).isTrue();
    }
    
    @ParameterizedTest
    @CsvSource(value = {"1:true", "2:true", "3:true", "4:false"}, delimiter = ':')
    void set_contains2(int number, boolean expected) {
        assertEquals(numbers.contains(number), expected);
    }
    ```

    