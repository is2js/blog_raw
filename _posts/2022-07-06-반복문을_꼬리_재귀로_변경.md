---
toc: true
layout: post
title: 반복문을 꼬리재귀로 변경하기
description: 꼬리 재귀를 통해 stack이 쌓이지 않고 바로 누적결과변수를 반환

categories: [python, recursive, tailrecursive, loop, algorithm]
image: "images/posts/python.png"
---



## 반복문 to 꼬리재귀

### 피보나치 수열 반복문(업데이트 변수 2개)



- 피보나치 수열의 반복문 예시
  ![image-20220716132835476](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716132835476.png)

  ```python
  def fibonacci_loop(n):
      assert n > 0, "0이하를 입력할 수 없습니다."
  
      if n <= 1:
          return n
  
      a, b = 0, 1  # 1 2  3 5
  
      for _ in range(2, n + 1):
          a, b = b, (a + b)
  
      return b
  ```



#### 01 전체로직을 업데이트변수를 가지는 꼬리재귀 함수helper로 추출



1. 반복문을 실행시키는 **메서드 파라미터  n만 존재하는 상태**이므로 **전체로직을 `꼬리재귀용 파라미터가 추가될 새 메서드(helper)`로 추출한다.**

   ![48a1909a-96d9-41c1-89e5-2ff35b5d8859](https://raw.githubusercontent.com/is3js/screenshots/main/48a1909a-96d9-41c1-89e5-2ff35b5d8859.gif)
   ![image-20220716132916096](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716132916096.png)



#### 02 반복문에서 업데이트되는 변수들의 초기값들의, 반복문 위의 초기값을 -> 파라미터로 추출 후 최초 호출 인자로 대입



2. 반복문 위에 초기값으로 시작하여 **`업데이트 되는 변수(a,b)들을 파라미터로 빼고, 반복문 위 초기값(0,1)들`을, `최초 호출시 인자`로 사용하도록 올린다.**

   - 재귀함수는 업데이트되는 값들을 파라미터로 올리고 다음 재귀 호출시, 인자에서 업데이트 시키는데

     - n을 **인자로 호출하여 시작해서 n-1로 업데이트**되는 것처럼, 다른 파라미터도 **초기값을 인자로 호출하여** 매번 업데이트 시킨다.
       - **재귀함수는 n부터 시작해서 내려가므로, n이 초기값이다.**
       - **꼬리 재귀함수는 n이외의 파라미터도 `시작 초기값을 준다`**

   - **업데이트 되는 `필수 누적결과값 b`의 파라미터 추출** 및 **초기값을 최초호출 인자로**
     ![d86492b7-6435-4b79-93f3-32aec3276041](https://raw.githubusercontent.com/is3js/screenshots/main/d86492b7-6435-4b79-93f3-32aec3276041.gif)

   - **업데이트 되는 `변수 a`의 파라미터 추출** 및 **초기값을 최초호출 인자로**

     ![66d8ffcc-2688-498e-a915-9d15d20d786c](https://raw.githubusercontent.com/is3js/screenshots/main/66d8ffcc-2688-498e-a915-9d15d20d786c.gif)

   ![image-20220716134724419](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716134724419.png)

   

#### 03 return문에서 다음 꼬리재귀만 호출 + 업데이트 로직을 인자로 대입



1. **꼬리재귀를 만들기 위해, `return문에서 업데이트변수들을 품은 꼬리재귀를 호출`하되, `업데이트 로직을 반영해서 호출`하도록 한다.**

   ![be6d956b-5a0a-4c43-8f91-5a1085ba8e09](https://raw.githubusercontent.com/is3js/screenshots/main/be6d956b-5a0a-4c43-8f91-5a1085ba8e09.gif)

   ![image-20220716135212111](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716135212111.png)





#### 04 반복문 끝 횟수(n to 시작)의 다음을 종착역으로 잡아, 종착역에서 누적 결과값 반환



4. **꼬리재귀는 `마지막 연산(n -> 2)`의 `다음을 종착역`으로 잡고, 그 `종착역에서 누적된 결과값을 반환`한다**

   - 현재 반복문이 n부터 -1씩 업데이트되서 2까지 가고 있다.

   - **2에서 누적연산이 끝나고, `다음번인 1을 종착역으로 잡아, 연산없이 누적된 결과값을 반환`해줘야한다.**

     ![939c69be-e01d-4266-b4a0-1bf0b025bd81](https://raw.githubusercontent.com/is3js/screenshots/main/939c69be-e01d-4266-b4a0-1bf0b025bd81.gif)

   ![image-20220716135632733](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716135632733.png)







### 누적합 반복문(업데이트 변수 1개)

- 누적합 반복문으로 구현

  ![image-20220716140845779](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716140845779.png)

  ```python
  def cumulative_sum_loop(n):
      s = 0
      for i in range(1, n + 1):
          s += i
      return s
  ```

  ![6b089eca-d2b8-46db-99d8-f80c20c7401b](https://raw.githubusercontent.com/is3js/screenshots/main/6b089eca-d2b8-46db-99d8-f80c20c7401b.gif)

- 반복문에서 업데이트시 `index i`를 사용하지만, `n번째라고 생각하고 업데이트 인자에 반영해준다.`

  - 반복문은 1부터 시작하지만, **재귀함수는 n부터 깍으면서 내려가며, n-1번째 연산시, index i는 n이다.**

  ![image-20220716140729103](https://raw.githubusercontent.com/is3js/screenshots/main/image-20220716140729103.png)

  

