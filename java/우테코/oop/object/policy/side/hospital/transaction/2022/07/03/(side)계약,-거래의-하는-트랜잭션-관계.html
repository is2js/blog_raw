<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>SIDE)계약, 거래의 트랜잭션 관계 맺기 | 돌범텤놑</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="SIDE)계약, 거래의 트랜잭션 관계 맺기" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="계약과 거래와 같은 서로 정보를 주고 받을 때" />
<meta property="og:description" content="계약과 거래와 같은 서로 정보를 주고 받을 때" />
<link rel="canonical" href="https://blog.chojaeseong.com/java/%EC%9A%B0%ED%85%8C%EC%BD%94/oop/object/policy/side/hospital/transaction/2022/07/03/(side)%EA%B3%84%EC%95%BD,-%EA%B1%B0%EB%9E%98%EC%9D%98-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84.html" />
<meta property="og:url" content="https://blog.chojaeseong.com/java/%EC%9A%B0%ED%85%8C%EC%BD%94/oop/object/policy/side/hospital/transaction/2022/07/03/(side)%EA%B3%84%EC%95%BD,-%EA%B1%B0%EB%9E%98%EC%9D%98-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84.html" />
<meta property="og:site_name" content="돌범텤놑" />
<meta property="og:image" content="https://blog.chojaeseong.com/images/posts/java.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-03T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2022-07-03T00:00:00-05:00","url":"https://blog.chojaeseong.com/java/%EC%9A%B0%ED%85%8C%EC%BD%94/oop/object/policy/side/hospital/transaction/2022/07/03/(side)%EA%B3%84%EC%95%BD,-%EA%B1%B0%EB%9E%98%EC%9D%98-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84.html","@type":"BlogPosting","image":"https://blog.chojaeseong.com/images/posts/java.png","headline":"SIDE)계약, 거래의 트랜잭션 관계 맺기","dateModified":"2022-07-03T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chojaeseong.com/java/%EC%9A%B0%ED%85%8C%EC%BD%94/oop/object/policy/side/hospital/transaction/2022/07/03/(side)%EA%B3%84%EC%95%BD,-%EA%B1%B0%EB%9E%98%EC%9D%98-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84.html"},"description":"계약과 거래와 같은 서로 정보를 주고 받을 때","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- 폰트추가를 위한 link태그 삽입 -->
  <!-- 폰트1:  기본 spoqa 웹폰트 -->
  <!-- css에서 * {} 다 뒤집어씀. -->
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
  <!-- 폰트2:  블로그 제목들 sunflower 웹폰트 -->
  <!-- 쥬피터 등 포스트 내부 글자 h1, h2 제목은 sunflower체 도입 -->
  <link href="//fonts.googleapis.com/css?family=Sunflower:300,500,700" rel="stylesheet"> 

  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.chojaeseong.com/feed.xml" title="돌범텤놑" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">돌범텤놑</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SIDE)계약, 거래의 트랜잭션 관계 맺기</h1><p class="page-description">계약과 거래와 같은 서로 정보를 주고 받을 때</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-07-03T00:00:00-05:00" itemprop="datePublished">
        Jul 3, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#java">java</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#우테코">우테코</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#oop">oop</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#object">object</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#policy">policy</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#side">side</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#hospital">hospital</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#transaction">transaction</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!-- toc가 먼저 나오므로 h3로 안내하기 -->
    <h3>📜 제목으로 보기</h3><ul class="section-nav">
<li class="toc-entry toc-h3"><a href="#계약과-거래를-하는-트랜잭션-관계">계약과 거래를 하는 트랜잭션 관계</a>
<ul>
<li class="toc-entry toc-h4"><a href="#계약하기">계약하기</a></li>
<li class="toc-entry toc-h4"><a href="#거래하기">거래하기</a></li>
</ul>
</li>
</ul><h3 id="계약과-거래를-하는-트랜잭션-관계">
<a class="anchor" href="#%EA%B3%84%EC%95%BD%EA%B3%BC-%EA%B1%B0%EB%9E%98%EB%A5%BC-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84" aria-hidden="true"><span class="octicon octicon-link"></span></a>계약과 거래를 하는 트랜잭션 관계</h3>

<h4 id="계약하기">
<a class="anchor" href="#%EA%B3%84%EC%95%BD%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>계약하기</h4>

<ul>
  <li>형태
    <ul>
      <li>
<strong>을</strong>인 doctor가 reception들에게 [void setter/boolean 거래 제안기능]을 통해, [거래조건]과 함께 먼저 알고서 데리고 온다.
        <ul>
          <li>[거래 제안기능]은 내부에서 갑인 reception의 [boolean 거래 수락기능]을 통해 결과를 받아와서, 결국엔 <strong>내부 필드에 계약자들을 저장</strong>하는 <strong>void setter받기기능과 유사한 형태며, boolean으로 doctor를 사용하는 사람에게 알려</strong>줘도 된다.</li>
        </ul>
      </li>
      <li>
<strong>갑</strong>인  reception은 [boolean 거래 수락기능]을 통해, <strong>doctor와 [거래조건]을 알고서 데려가 검증한 뒤, 성공시 필드에 거래조건과 함께 저장</strong>하며,  boolean으로 수락여부를 을인 doctor에게 알려준다.
        <ul>
          <li>계약이든 거래든 <strong>갑이 데리고 가서 검증/결정후 결과를 반환해서 알려주면</strong> 을은 결과에 따라서 행동한다.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p>을(doctor)가 먼저 [boolean 거래제안 기능]을  거래대상인 갑(reception)에게 [거래조건]과 함께 제안한다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629213237291.png" alt="image-20220629213237291"></p>
  </li>
  <li>
    <p><strong>doctor</strong>의 계약제안 기능의 내부에서는</p>

    <ul>
      <li>
        <p><strong>갑의 [boolean 계약수락 기능]을 호출한 뒤, 반환받은 결과에 따라 행동</strong>한다.</p>
      </li>
      <li>
<strong>추가로 이미 계약중(컬렉션필드 -&gt; CRUD 생각 -&gt; CREATE시 중복검증)</strong>되면 안된다.
        <ul>
          <li>if A &amp;&amp; B 여야만 수행 -&gt; 컬렉션에 계약자로 추가
            <ul>
              <li>
                <table>
                  <tbody>
                    <tr>
                      <td>**if not A</td>
                      <td> </td>
                      <td>not B -&gt; return false (early return) -&gt;  수행**</td>
                    </tr>
                  </tbody>
                </table>
                <ul>
                  <li>만족(if A) 시 수행이라면 not A early return을 고려한다.</li>
                  <li>
                    <table>
                      <tbody>
                        <tr>
                          <td>**둘다 만족시(if A &amp;&amp; B) 수행이라면, not A</td>
                          <td> </td>
                          <td>not B early return을 고려한다.**</td>
                        </tr>
                      </tbody>
                    </table>
                    <ul>
                      <li>
                        <table>
                          <tbody>
                            <tr>
                              <td>**둘다 return값이 동일하다면,</td>
                              <td> </td>
                              <td>로 묶어서 한번에  early return**</td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                    </ul>
                  </li>
                  <li>not A return (early) false ;</li>
                  <li>not B return (early) false;</li>
                  <li>수행
                    <ul>
                      <li>
                        <table>
                          <tbody>
                            <tr>
                              <td>
<code class="language-plaintext highlighter-rouge">==</code>  not A</td>
                              <td> </td>
                              <td>not B  reutrn (early) false;</td>
                            </tr>
                          </tbody>
                        </table>
                      </li>
                      <li>
<code class="language-plaintext highlighter-rouge">==</code>  수행</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
<strong>Set컬렉션을 쓰고 있으므로 중복검증(A)는 생략한다.</strong>
        <ul>
          <li>if not B early return 후 수행만 하면 된다.</li>
        </ul>
      </li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/cb007026-e263-4ec9-a44e-2ca1dffa774d.gif" alt="cb007026-e263-4ec9-a44e-2ca1dffa774d"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629213706946.png" alt="image-20220629213706946"></p>
  </li>
  <li>
    <p><strong>reception</strong>의 거래수락 기능 내부에서는</p>

    <ol>
      <li><strong>거래대상과, 거래조건을 매칭해서 저장할 HashMap 필드를 만들고</strong></li>
      <li>(거래는 상대방의 돈검증) <strong>이미 계약중인지, <code class="language-plaintext highlighter-rouge">거래대상 검증(중복검증)</code></strong>을 한다.</li>
      <li>(거래는 내가 줄 물건검증) <strong>계약대상과 계약조건을 내부필드에 저장하여 계약</strong>한다.</li>
      <li>(거래는 상대방 돈차감 -&gt; 물건반환) <strong>수락여부true를 반환</strong>한다. (검증실패시 false)</li>
    </ol>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/fd6c3c9d-767e-4061-a23e-86eac71cbf50.gif" alt="fd6c3c9d-767e-4061-a23e-86eac71cbf50"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629214322785.png" alt="image-20220629214322785"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629214256145.png" alt="image-20220629214256145"></p>
  </li>
  <li>
    <p>계약 제안/수락 기능처럼, <strong>계약취소 제안/수락기능도 있다.</strong></p>

    <ol>
      <li>
        <p>계약취소 제안기능(DELETE)</p>

        <ul>
          <li>
            <p><strong>A: 계약취소 대상자 존재 검증</strong> &amp;&amp; <strong>B:갑의 계약취소 수락기능의 결과가 true</strong></p>

            <ul>
              <li>둘다 만족해야지 수행
                <ul>
                  <li>
                    <table>
                      <tbody>
                        <tr>
                          <td>**not A</td>
                          <td> </td>
                          <td>not B  early return한다.**</td>
                        </tr>
                      </tbody>
                    </table>
                  </li>
                </ul>
              </li>
            </ul>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/9761c111-683a-4a64-a5e5-eb9a43908dcf.gif" alt="9761c111-683a-4a64-a5e5-eb9a43908dcf"></p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629220352023.png" alt="image-20220629220352023"></p>
          </li>
        </ul>
      </li>
      <li>
        <p>계약취소 수락기능(DELETE)</p>

        <ul>
          <li>
            <p>갑으로서 누구의 결과를 기다리지 않으니, 삭제 전 존재 검증만 하면 된다.</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/df449e6b-fbff-4e44-ba9d-66455e177081.gif" alt="df449e6b-fbff-4e44-ba9d-66455e177081"></p>
          </li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220629220807026.png" alt="image-20220629220807026"></p>
      </li>
    </ol>
  </li>
</ol>

<h4 id="거래하기">
<a class="anchor" href="#%EA%B1%B0%EB%9E%98%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>거래하기</h4>

<ul>
  <li>
    <p>참고</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/08_ticketoffice_theater_screening.png" alt="거래이미지"></p>

    <ul>
      <li>
        <p>Patient가 [void setter구매기능]을 통해 거래를 제안한다.</p>
      </li>
      <li>
        <p>Coordinator는 최초 [getter물건 판매기능]을 제공하고, Patient에게 결과를 [물건반환]으로 알려주는데, 실패시 NULL객체를 반환한다. (NULL객체를 쓰는 순간, boolean의 반환이 필요없어진다.)</p>

        <ul>
          <li>A(돈 검증) &amp;&amp; B(물건 검증)시  상대방의 돈을 차감한다. 돈 가산은 물건을 주는 Reception에게 미룬다.
            <ul>
              <li>
                <table>
                  <tbody>
                    <tr>
                      <td>not A</td>
                      <td> </td>
                      <td>not B early NULL객체 return을 해도 될 것 같지만.</td>
                    </tr>
                  </tbody>
                </table>
                <ul>
                  <li>if A 와 if B 사이에 로직이 존재하여 early return이 불가하다.</li>
                </ul>
              </li>
              <li>이 땐, 실패의 else마다 똑같은 값이 반환되므로, 애초에 반환값을 EMPTY(NULL객체)로 변수로 선언해놓고 시작하고, 성공시 재할당하여, 마지막에만 해당 변수를 return한다.</li>
            </ul>
          </li>
        </ul>

        <ol>
          <li>
            <p>[상대방 돈 검증] 하기 전, 검증기준인 [물건의 가격을 계산]해야한다.</p>

            <ul>
              <li>
                <p>Coordinator는 계산의 책임을 수수료를 챙겨서 계산하는 Reception에게 [물건 가격 계산]도 위임한다.</p>
              </li>
              <li>
                <p>사실, 물건가격계산은, 정책이 적용될 Specialty객체로 바로 할 수 있지만, 의존성이 1곳에서만 생기도록 Reception에게 위임한다.</p>
              </li>
            </ul>
          </li>
          <li>
            <p>[상대방 돈 검증]</p>
          </li>
          <li>
            <p>[건네줄 물건 검증]을 하기 전, 검증 기준은 [물건]을 받아와야한다.</p>

            <ul>
              <li>Coordinator는 최초 물건 발행권자인 Doctor로부터 생성해서 받아와야하므로 [getter물건 판매기능]을 Coordinator -&gt; Reception -&gt; Doctor까지 연쇄적으로 호출해서 물건을 받아온다.</li>
            </ul>
          </li>
          <li>
            <p>[받아온 물건 검증]</p>
          </li>
          <li>
            <p>[상대방 돈차감]</p>

            <ul>
              <li>돈 가산은 계산의 책임이 있는 Reception에서, Reception의 [판매기능]내에서 이루어지게 한다.</li>
            </ul>
          </li>
          <li>
            <p>[물건 반환]</p>
          </li>
        </ol>
      </li>
      <li>
        <p>Reception</p>

        <ol>
          <li>연쇄적인 [getter물건 판매기능]안에서 들어오는 [구매정보 검증]을 한다.
            <ul>
              <li>돈 검증은 구매자와 최초연결된 Coordinator에서 담당한다.</li>
              <li>[정보 검증]을 통해, Doctor로 가서 Package발행 전에 NULL객체를 물건으로 반환해서 미리 컷한다.</li>
            </ul>
          </li>
          <li>[물건 검증]전, 물건을 Doctor의 [getter물건 판매기능]으로 떼온다.
            <ul>
              <li>수량제한에 걸려서 Doctor가 NULL을 건네줄 수 있다.</li>
            </ul>
          </li>
          <li>[물건 검증]</li>
          <li>[돈 가산]
            <ul>
              <li>물건이 검증되면, Coordinator의 돈차감과 같은 레벨로 [돈 가산]을 해야한다.</li>
              <li>구매정보에 담긴 (정책적용객체) Specialty에서 물건가격을 계산하고</li>
              <li>**구매정보의 doctor와 계약된 commisionRate를 꺼내서, 수수료를 계산해, [내 자본금을 가산] **한 뒤</li>
              <li>
<strong>물건가격 -수수료 만큼을 [발행권자 doctor에게 가산]해준다.</strong>
                <ul>
                  <li>계산은 Reception에서만 이루어져서 나도 챙기고, 발행권자도 챙겨준다.</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>[물건 반환]</li>
        </ol>
      </li>
      <li>
        <p>Doctor</p>

        <ul>
          <li>연쇄적인 [getter물건 판매기능]을 통해  물건을 생성해야하는데</li>
        </ul>

        <ol>
          <li>내가 소유하고 있는 정보로 [구매정보 검증]한다.
            <ul>
              <li>Reception에서 컷 안당했지만, doctor만의 소유정보로 컷 당할 수 있다.</li>
              <li>예를 들어, Specialty - Treatment들의 매칭 정보</li>
            </ul>
          </li>
          <li>
<strong>[발행 전 <code class="language-plaintext highlighter-rouge">발행가능 갯수</code> 검증]을 한다.</strong>
            <ul>
              <li>
<strong>발행가능 갯수는 Treatment의 count로 명시되어있으며, 생성될때마다 감산되어야한다.</strong>
                <ul>
                  <li>발행가능한지 검증(trigger) 실패시 runtime에러를 낸다.</li>
                </ul>
              </li>
            </ul>
          </li>
          <li>[물건 <strong>발행하여</strong> 반환]한다.</li>
        </ol>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p><strong>환자</strong>는 [void setter 구매기능]을 통해 Coordinator(거래대상, 갑) 이외에 <code class="language-plaintext highlighter-rouge">구매package정보들</code> from 발행doctor내부정보와 <code class="language-plaintext highlighter-rouge">구매 갯수</code>를 같이 인자로 넘긴다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630005501089.png" alt="image-20220630005501089"></p>
  </li>
  <li>
    <p>구매기능 내부에서는, 거래의 갑인 Coordinator의 [getter물건 판매기능]을 이용하여 반환받아 저장한다.</p>

    <ul>
      <li>실패시 NULL객체가 반환되도록 짤 예정이므로 바로 필드에 저장만 하면 된다.</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630005607331.png" alt="image-20220630005607331"></p>
  </li>
  <li>
    <p><strong>coordinator</strong>(seller)의 판매기능은 거래 성공의 조건이 if + 로직 + if로 복잡하고 까다롭기 때문에</p>

    <ul>
      <li><strong>그외 많은 경우가 실패이므로 early return없이  default NULL객체가 반환되도록  미리 반환변수를 NULL객체로 선언하고, 성공의 경우 재할당해주도록 짠다.</strong></li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630010223294.png" alt="image-20220630010223294"></p>

    <ul>
      <li>쿠폰 유무의 경우의 수를 if + else 로 하기 싫다면 if + if  혹은 <code class="language-plaintext highlighter-rouge">if-earlyreturn + NoIf</code> 를 선택한다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630010947463.png" alt="image-20220630010947463">
</li>
    </ul>
  </li>
  <li>
    <p><strong>일반적인 쿠폰이 없는 경우부터 작성한다.</strong> Seller가 먼저 상대방의 돈 검증을 시행해서 돈 없으면 컷 해야한다. 그러기 위해선, 돈 검증 전에, <strong>물건(Package)의 가격을 계산</strong>해야한다.</p>

    <ul>
      <li>
        <ul>
          <li>가격계산은 가격정책이 적용될 예정 &amp;&amp; fee를 가지고 있는 Specialty객체로 할 수  있다.</li>
          <li>
            <p><strong>그러나, specialty를  <code class="language-plaintext highlighter-rouge">Coordinator내부</code>에서 사용할 경우 vs 전달만 할 경우 의존성을 가지냐 안가지냐의 차이를 가지므로 <code class="language-plaintext highlighter-rouge">specialty를 받아가고, 계산도 할 Reception에게 가격 계산의 책임을 위임</code>한다.</strong></p>
          </li>
          <li>구매 물건의 가격을 계산시, <code class="language-plaintext highlighter-rouge">1개당 가격정보를 포함하는 Specialty</code> + <code class="language-plaintext highlighter-rouge">몇개 살 것인지  Count</code>도 같이 받아야지 총 금액이 계산된다.
            <ul>
              <li><strong>또한, 차후 정책조건의 trigger에서 sequence/time 등을 조건판단 정보로 주려고, <code class="language-plaintext highlighter-rouge">지금은 사용하지 않는 treatment</code>도 같이 넘겨준다.</strong></li>
            </ul>
          </li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630024309178.png" alt="image-20220630024309178"></p>

        <ul>
          <li>
            <p>reception의 판매기능 내부에서도 <strong>결국 가격은 fee필드를 가진 specialty</strong>가 한다.</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630025235621.png" alt="image-20220630025235621"></p>
          </li>
          <li>
            <p>정책이 없다면, specialty는 내부 1개당 가격 X count를 해준다. <strong>나중에 NONE POLICY에서 이걸 반환하면 될 듯 하다.</strong></p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630121500908.png" alt="image-20220630121500908"></p>
          </li>
          <li>
            <p>맞는지는 모르겠지만, count만큼 돌면서 money를 더해서 곱하기를 만들었다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630121545120.png" alt="image-20220630121545120"></p>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p>구매자 돈 검증</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630123230334.png" alt="image-20220630123230334"></p>
  </li>
  <li>
    <p>물건 검증 전에, 물건 떼오기 from <strong>Reception</strong>
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630135717187.png" alt="image-20220630135717187"></p>

    <ul>
      <li>물건을 생성해주는 Doctor까지 위해 정보들을 다 전달해줘야한다.</li>
      <li>
        <p>Coordinator와 연결된 Reception에게 doctor부터 물건정보 + 갯수까지 다 전달한다.</p>
      </li>
      <li>
<strong>물건을 떼오는 것도, reception입장에서는 getter물건 판매기능으로서, 실패시 NULL객체를 반환, 성공시 정상물건이 온다.</strong>
        <ul>
          <li><strong>이 때, default NULL객체의 물건반환변수에 재할당한다.</strong></li>
        </ul>
      </li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630123532470.png" alt="image-20220630123532470"></p>

    <ul>
      <li>
        <p>reception은 앞에서 이미 상대방 돈검증으로 미리 컷 가능하게 했으니, <strong>구매정보 검증</strong>을 통해 doctor에게 가기전  <strong>컷(NULL객체로 물건반환)</strong>할 수 있게한다.</p>

        <ul>
          <li>
            <p><strong>3가지 구매정보 검증( A&amp;&amp; B&amp;&amp; C)을 다 통과해야하지, 판매가 진행되므로</strong></p>

            <ul>
              <li>
                <table>
                  <tbody>
                    <tr>
                      <td>**not A</td>
                      <td> </td>
                      <td>not B</td>
                      <td> </td>
                      <td>not C**  -&gt; <strong>early return</strong> false대신 NULL객체를 사용한다.</td>
                    </tr>
                  </tbody>
                </table>
              </li>
            </ul>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630134604418.png" alt="image-20220630134604418"></p>
          </li>
          <li>
            <p>doctor가 제공하는 isValidMatching</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630124711469.png" alt="image-20220630124711469"></p>
          </li>
          <li>
            <p>treatment가 제공하는 구매가능갯수 검증</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630132627284.png" alt="image-20220630132627284"></p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>doctor</strong>는 <strong>[getter물건 판매기능]</strong>으로 물건을 만들어서 반환해줘야한다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630134541595.png" alt="image-20220630134541595"></p>

        <ul>
          <li>
            <p>내부에서는 생성전, <strong>구매정보 검증하여 미리 컷</strong>(NULL객체 반환)</p>

            <ul>
              <li>돈 검증 대신 구매정보 검증한다.</li>
            </ul>
          </li>
          <li>
            <p><strong><code class="language-plaintext highlighter-rouge">발행(생산)전, 구매갯수가능 검증 및 차감</code></strong></p>

            <ul>
              <li>물건검증-&gt;돈차감 대신 <strong>생산가능갯수 검증 및 갯수 차감</strong>을 한다. 차감의 책임은 <strong>treatment에  있으며, count필드로 조정한다.</strong>
</li>
            </ul>
          </li>
          <li>
            <p>물건 생성하여 반환</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630135555024.png" alt="image-20220630135555024"></p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>reception</strong>은 떼온 <strong>물건을 검증</strong>한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630135849470.png" alt="image-20220630135849470"></p>
      </li>
      <li>
        <p><strong>reception</strong>은 구매자돈차감(Coordinator)대신 <strong>돈 가산(reception-커미션, doctor-나머지 금액)을 한다.</strong></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630140807614.png" alt="image-20220630140807614"></p>
      </li>
      <li>
        <p><strong>recpetion</strong>은 물건을 반환한다.</p>

        <ul>
          <li>if 물건검증 통과시만 돈계산이 이루어지고, 내부에서 반환은 안한다.
            <ul>
              <li><strong>if 내부에서하지 않아도 이미 물건떼오기에서 반환받은 물건은 <code class="language-plaintext highlighter-rouge">if와 무관하게반환될 물건은 결정된 상황</code>이기 때문이다.</strong></li>
              <li><strong>반환될 물건은 이미 결정, <code class="language-plaintext highlighter-rouge">if 정상물건일시, 돈계산 추가</code></strong></li>
            </ul>
          </li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630142409828.png" alt="image-20220630142409828"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>떼온 물건 검증 후 -&gt; 환자(구매자)의 돈차감</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630185008015.png" alt="image-20220630185008015"></p>
  </li>
  <li>
    <p><strong>쿠폰이 있는 경우는, Coordinator가 어떻게 해야할까</strong></p>

    <ul>
      <li>돈계산 -&gt; 돈검증안한다.</li>
      <li>물건 떼오기 -&gt; 물건 검증 -&gt; <strong>돈차감이 아니라 쿠폰차감 with count만큼</strong>
</li>
    </ul>
  </li>
  <li>
    <p>일단 reception에게 물건을 공짜로 가져온다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630185944884.png" alt="image-20220630185944884"></p>

    <ul>
      <li>
        <p><strong>reception</strong>에서는 <strong>doctor에게 발행하여 물건 받아오는 과정이 완전히 동일</strong>하기 때문에</p>

        <ul>
          <li>sellPackage 메서드를 그대로 쓴다.</li>
          <li>
<strong>doctor</strong>의 기능은 돈계산이 없이 정보검증 -&gt; <strong>구매가능갯수 차감 -&gt; 발행</strong>의  3단계만 거치기 때문이다.</li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630190530535.png" alt="image-20220630190530535"></p>
      </li>
      <li>
        <p>reception은 물건검증 성공시 돈차감했었는데, <strong>돈차감이 없으니 물건검증도 생략</strong>한다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630191224044.png" alt="image-20220630191224044"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Coordinator</strong>에서는 물건 검증이 되면, 돈차감 대신 <strong>patient의 쿠폰을 차감한다. <code class="language-plaintext highlighter-rouge">여러개 골랐으면 갯수만큼 차감</code>해야한다.</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630191408520.png" alt="image-20220630191408520"></p>
  </li>
  <li>
    <p><strong>patient는 Coupon coupon = Coupon.EMPTY</strong>로 1개 밖에 못들고 있게 설계되었다.</p>

    <ul>
      <li>
        <p>여러개 쿠폰을 가질 수 있게 <strong>coupon필드를 컬렉션</strong>으로 바꿔줘야한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630191757079.png" alt="image-20220630191757079"></p>

        <ul>
          <li>필드를 바꾸면 getter나 eq/hC도 변경해준다.</li>
          <li>setter도 할당이 아니라 add로 바꿔준다. / remove도 NULL객체 할당에서 remove(0)으로 바꿔준다.</li>
        </ul>
      </li>
      <li>
        <p><strong>컬렉션 필드의 검증은 EMTPY(NULL객체)가 아니라 size로 하도록 다시 다 바꿔줘야한다.</strong>
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630192036354.png" alt="image-20220630192036354"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>돈계산 -&gt; <code class="language-plaintext highlighter-rouge">돈검증</code> 대신, 돈검증 자리에 <code class="language-plaintext highlighter-rouge">구매count만큼 Coupon을 들고 있는지도 검증</code>한다.</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630192912538.png" alt="image-20220630192912538"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630192928861.png" alt="image-20220630192928861"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630193047170.png" alt="image-20220630193047170"></p>
  </li>
  <li>
    <p>원래로직을 유지하고 (뒤에 쿠폰없는 상황에 대한 early return이 껴있는 상황)</p>

    <ul>
      <li>쿠폰 갯수가 모자랄 땐, 에러메세지로 알려주도록 early thr를 던졌다.</li>
      <li><strong>그대로 두면, 쿠폰갯수가 모자라면 NULL객체로 갈텐데, 그것보다 직접 알려준다.</strong></li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630193410116.png" alt="image-20220630193410116"></p>
  </li>
  <li>
    <p><strong>Doctor -&gt; Paitent 쿠폰 주는 것</strong>에 대해, <strong>갯수를 정해서 주고, 차감시에도 여러개 차감</strong>하게 한다.</p>

    <ul>
      <li>
        <p><strong>쿠폰 직접주기 in Doctor</strong> by Client
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630230803854.png" alt="image-20220630230803854"></p>
      </li>
      <li>
        <p><strong>쿠폰 차감 in Patient</strong> by Coordinator (돈 차감 대신)</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630230844517.png" alt="image-20220630230844517">
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630233703119.png" alt="image-20220630233703119"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>Package와 Coupon을 발행하는 Doctor(생산자)</strong>는 Patient(구매자)가 가진 <strong>데이터객체(Package)를 확인하는 검증</strong>을 한다.</p>

    <ul>
      <li>Doctor는 필드에 무리하게 Many테이블의 정보를 컬렉션으로 모은 상태의 정보전문가로 만들어놨다.
        <ul>
          <li>원래 DB에서는 Many테이블의 One테이블의 정보를 fk로 가진다.</li>
        </ul>
      </li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630234523167.png" alt="image-20220630234523167"></p>

    <ul>
      <li>
        <p>Doctor가  Paitent들의 구매한 Package들을 검증한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220630234818309.png" alt="image-20220630234818309"></p>
      </li>
    </ul>
  </li>
  <li>
    <p>Doctor는 내부정보로 검증할 예정이므로 Patient를 인자로 받아서</p>

    <ol>
      <li>
<strong>물건 제공받기 by getter</strong>
        <ol>
          <li><strong>물건 검증(기본) : NULL객체 검증</strong></li>
          <li>
<strong>물건 기본정보(필드) 검증 by getter</strong>
            <ol>
              <li><strong>발행권자로 받은 것(Doctor자신)</strong></li>
              <li>
<strong>상하위도메인 매칭정보 검증</strong>
                <ul>
                  <li><strong>Treatment는 사기전 count필드와 사고난 후 count필드가 변한다</strong></li>
                  <li>
<strong>구매정보 비교시, <code class="language-plaintext highlighter-rouge">구매 전후로 변하는 필드</code>인 Count<code class="language-plaintext highlighter-rouge">eq/hC에서 제외</code>한다.</strong>
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220701004331144.png" alt="image-20220701004331144">
</li>
                </ul>
              </li>
              <li><strong>구매한 갯수 vs 검증할 갯수 검증</strong></li>
            </ol>
          </li>
        </ol>
      </li>
    </ol>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220701000335895.png" alt="image-20220701000335895"></p>
  </li>
  <li>
    <p><strong><code class="language-plaintext highlighter-rouge">A &amp;&amp; B &amp;&amp; C &amp;&amp; D</code>의 검증은 <code class="language-plaintext highlighter-rouge">검증마다 early thr</code>를 날려서 어떤 것에 검증실패했는지 알려주도록 변경한다.</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220701004515665.png" alt="image-20220701004515665"></p>
  </li>
</ol>

  </div><a class="u-url" href="/java/%EC%9A%B0%ED%85%8C%EC%BD%94/oop/object/policy/side/hospital/transaction/2022/07/03/(side)%EA%B3%84%EC%95%BD,-%EA%B1%B0%EB%9E%98%EC%9D%98-%ED%95%98%EB%8A%94-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EA%B4%80%EA%B3%84.html" hidden></a>
</article>


<!-- <script src="https://utteranc.es/client.js"
        repo="is2js/blog_raw"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://blog.chojaeseong.com/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>평범한 한의사 돌범의 엔지니어 도전기</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a href="/feed.xml" target="_blank" title="rss">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/is2js/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/yarotheslav" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/yshmarov/" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
