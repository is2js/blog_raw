<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>python decorator 작성 순서 | 돌범텤놑</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="python decorator 작성 순서" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="데코레이터 작성을 순차적으로 해보자." />
<meta property="og:description" content="데코레이터 작성을 순차적으로 해보자." />
<link rel="canonical" href="blog.chojaeseong.com/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html" />
<meta property="og:url" content="blog.chojaeseong.com/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html" />
<meta property="og:site_name" content="돌범텤놑" />
<meta property="og:image" content="blog.chojaeseong.com/images/posts/python.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-07-20T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2022-07-20T00:00:00-05:00","url":"blog.chojaeseong.com/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html","@type":"BlogPosting","image":"blog.chojaeseong.com/images/posts/python.png","headline":"python decorator 작성 순서","dateModified":"2022-07-20T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"blog.chojaeseong.com/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html"},"description":"데코레이터 작성을 순차적으로 해보자.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- 폰트추가를 위한 link태그 삽입 -->
  <!-- 폰트1:  기본 spoqa 웹폰트 -->
  <!-- css에서 * {} 다 뒤집어씀. -->
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
  <!-- 폰트2:  블로그 제목들 sunflower 웹폰트 -->
  <!-- 쥬피터 등 포스트 내부 글자 h1, h2 제목은 sunflower체 도입 -->
  <link href="//fonts.googleapis.com/css?family=Sunflower:300,500,700" rel="stylesheet"> 

  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="blog.chojaeseong.com/feed.xml" title="돌범텤놑" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">돌범텤놑</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">python decorator 작성 순서</h1><p class="page-description">데코레이터 작성을 순차적으로 해보자.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-07-20T00:00:00-05:00" itemprop="datePublished">
        Jul 20, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#algorithm">algorithm</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#pycharm">pycharm</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#decorator">decorator</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!-- toc가 먼저 나오므로 h3로 안내하기 -->
    <h3>📜 제목으로 보기</h3>
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#데코레이터를-작성하는-순서">데코레이터를 작성하는 순서</a>
<ul>
<li class="toc-entry toc-h3"><a href="#기본-데코레이터-만들기">기본 데코레이터 만들기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-기능을-입힐-base함수부터-작성한다-이왕이면-print가-아니라-return하는-결과물이-있는-함수를-작성하여-반환값에-대한-장식도-가능하게-한다">01 기능을 입힐 base함수부터 작성한다. 이왕이면 print가 아니라 return하는 결과물이 있는 함수를 작성하여, 반환값에 대한 장식도 가능하게 한다.</a></li>
<li class="toc-entry toc-h4"><a href="#02-base함수를-호출부없는함수객체를-인자로-받는-클로져-함수를-사용-생성한다--여기까지는-지역상태메서드내부-인자-등를-기억하는-함수객체를-return한-뒤-외부에서-실제-인자를-받는-클로져가-된다">02 base함수를 (호출부없는)함수객체를 인자로 받는 클로져 함수를 사용-생성한다.  여기까지는 지역상태(메서드내부 인자 등)를 기억하는 함수객체를 return한 뒤, 외부에서 실제 인자를 받는 클로져가 된다.</a></li>
<li class="toc-entry toc-h4"><a href="#03-클로져-상태에서-base함수를-호출한-결과값을-장식해야한다면-반환은-값이-되므로-함수객체를-반환하지-않게-되어-클로져도-아니고-데코레이터도-아니게-된다-그냥-값이-반환된-상태라서-외부에서-호출없이-끝난다">03 클로져 상태에서, base함수를 호출한 결과값을 장식해야한다면? 반환은 값이 되므로 함수객체를 반환하지 않게 되어, 클로져도 아니고 데코레이터도 아니게 된다. 그냥 값이 반환된 상태라서 외부에서 ()호출없이 끝난다.</a></li>
<li class="toc-entry toc-h4"><a href="#04-base결과물-장식-후-클로져-상태함수객체-반환를-유지하기-위한--inner메서드-wrapper로-감싼-뒤-return-wrapper함수객체---외부에서-호출될-함수로서-함부러-파라미터를-내부context라고-파라미터로-만들면-안된다---base함수의-인자에-맞춰야한다">04 base결과물 장식 후, 클로져 상태(함수객체 반환)를 유지하기 위한  inner메서드 wrapper로 감싼 뒤, return wrapper함수객체 -&gt; 외부에서 호출될 함수로서, 함부러 파라미터를 내부context라고 파라미터로 만들면 안된다. -&gt; base함수의 인자에 맞춰야한다.</a></li>
<li class="toc-entry toc-h4"><a href="#05-완성된-데코는-base함수에-달아서-사용해주기">05 완성된 데코는, base함수에 @달아서 사용해주기</a></li>
<li class="toc-entry toc-h4"><a href="#06-다중데코레이터는-외부에서-한번더-감싸서-만들고-달-때는-아래-위-순서대로-단다">06 다중데코레이터는, 외부에서 한번더 감싸서 만들고, 달 때는 아래-&gt;위 순서대로 단다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#함수객체-name에-base함수가-찍히도록-디버깅되는-데코레이터로-바꾸기-by-wrapper메서드에-functoolswrapsfunc-데코-달아주기">함수객체 name에 base함수가 찍히도록 디버깅되는 데코레이터로 바꾸기 by wrapper메서드에 @functools.wraps(func) 데코 달아주기</a></li>
<li class="toc-entry toc-h3"><a href="#base함수호출시-필요한-특정-인자를-외부에서-조달하려면-외부에-return되서-가-붙는-함수객체-wrapper에-args-kwargs로-파라미터를-정의하여-어떤-인자든-들어오게-한다">base함수호출시 필요한 특정 인자를 외부에서 조달하려면, 외부에 return되서 ()가 붙는 함수객체 wrapper에 *args, **kwargs로 파라미터를 정의하여 어떤 인자든 들어오게 한다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#역순으로-jwt-인증-decorator-작성">역순으로 jwt 인증 decorator 작성</a>
<ul>
<li class="toc-entry toc-h3"><a href="#01-route마다-매번-token-인증---실패시-예외의-검증하는-로직을-route에-반복-기술하는-대신-데코레이터로-만들기">01 Route마다 매번 [token 인증 -&gt; 실패시 예외]의 검증하는 로직을 route에 반복 기술하는 대신 데코레이터로 만들기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#001-src--auth_jwt--token_verifierpy-생성">001 src &gt; auth_jwt &gt; token_verifier.py 생성</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#02-token인증실패시-예외을-데코레이터-만드는-방법바깥에서부터">02 token인증(실패시 예외)을 데코레이터 만드는 방법(바깥에서부터)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#001-decorator는--호출-전의-base_func객체를-인자로-받아서-내부에서-호출하고-return은-func객체를-호출하고-실제-deco하는-inner-method-wrapper를-호출하지-않은체-반환하므로-inputfuncbase_func---output-funcwrapper이다">001 decorator는  ()호출 전의 base_func객체를 인자로 받아서 내부에서 호출하고, return은 func객체를 호출하고 실제 deco하는 inner method wrapper를 호출하지 않은체 반환하므로 [input:func(base_func) -&gt; output func(wrapper)]이다.</a></li>
<li class="toc-entry toc-h4"><a href="#002-inner-method-wrapper메서드는-결과값을-deco당하거나-or-호출전후로-작업을-하고-싶은-base_func의-decorating-과정에서---외부-인자가요구하는-순간-wrapper-method도-인자를-args-kwargs로-받는다-inner-method인-wrapper는-decorator-맨-마지막에-호출하지-않은-체-반환되는-closure다">002 inner method wrapper메서드는 [결과값을 deco당하거나 or 호출전후로 작업을 하고 싶은 base_func()]의 decorating 과정에서 -&gt; 외부 인자가요구하는 순간, wrapper method도 인자를 *args, **kwargs로 받는다. inner method인 wrapper는 decorator 맨 마지막에 호출하지 않은 체 반환되는 closure다</a></li>
<li class="toc-entry toc-h4"><a href="#003-get-route에서-token인증을-위한-decode--예외처리-했던-로직을-inner-method-warpper여기선-decorated-내부로-가져와서-base_func-여기서는-route함수-호출전-1token인증실패시-예외--2-token-refresh-작업을-항상-진행하게-해준다">003 GET route에서 token인증을 위한 decode + 예외처리 했던 로직을 inner method warpper(여기선 decorated) 내부로 가져와서, [base_func (여기서는 route함수) 호출전 (1)TOKEN인증(==실패시 예외) + (2) TOKEN REFRESH 작업]을 항상 진행하게 해준다.</a></li>
<li class="toc-entry toc-h4"><a href="#004-필요한-것들을-import하고-수정해나간다">004 필요한 것들을 import하고, 수정해나간다</a></li>
<li class="toc-entry toc-h4"><a href="#005-base_func인-functionroute함수는-wrapperdecorated에서-token인증-및-예외처리-끝내고-자신만-호출되면-되나-인증안되면-예외발생하고-인증되면-route-자신의-역할만-하면-끝">005 base_func인 function(route함수)는 wrapper(decorated)에서 [token인증 및 예외처리] 끝내고, 자신만 호출되면 되나? 인증안되면 예외발생하고, 인증되면 route 자신의 역할만 하면 끝??</a></li>
<li class="toc-entry toc-h4"><a href="#006-route함수가-decorator로-token인증을-거치는-경우-인증성공시의-refresh된-token을-route함수-인자로-받아야하며-decorator작성시-base_funcroute_func은-argskargs-앞에-가장-첫-인자로-next_token을-추가해야한다">006 route함수가 decorator로 token인증을 거치는 경우, 인증성공시의 refresh된 token을 route함수 인자로 받아야하며, decorator작성시, base_func(route_func)은 *args**kargs 앞에 가장 첫 인자로 next_token을 추가해야한다</a></li>
<li class="toc-entry toc-h4"><a href="#007-inner-method-wrapper메서드에-functoolswraps-base_func-을-달아주면-디버깅시-함수name이-같이-찍힌다">007 inner method wrapper메서드에 @functools.wraps( base_func )을 달아주면, 디버깅시 함수name이 같이 찍힌다</a></li>
<li class="toc-entry toc-h4"><a href="#008-auth_jwt-init에-올리기">008 auth_jwt init에 올리기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#03-token-인증필요-routeget에서-jwt-인증--decorator사용하기">03 token 인증필요 route(GET)에서 jwt 인증  decorator사용하기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#001-jwt-인증-데코레이터는-base_func이-인자로-next_token을-받는-것을-가정했으니---route함수는-token을-인자로-받아야한다---return에도-받은-next_token을-반환해보자">001 jwt 인증 데코레이터는 base_func이 인자로 next_token을 받는 것을 가정했으니 -&gt; route함수는 token을 인자로 받아야한다 -&gt; return에도 받은 next_token을 반환해보자.</a></li>
<li class="toc-entry toc-h4"><a href="#002-postman에서-토큰생성-post---토큰-인증get-해보기">002 POSTMAN에서 토큰생성 (POST) -&gt; 토큰 인증(GET) 해보기</a>
<ul>
<li class="toc-entry toc-h5"><a href="#token-생성은-생성요청자-uid를-넣어줘야하는데-여기선-하드코딩으로-넣어준다">token 생성은 생성요청자 uid를 넣어줘야하는데, 여기선 하드코딩으로 넣어준다</a></li>
<li class="toc-entry toc-h5"><a href="#token-인증요청자는-token생성한uid와-동일해야하는데-10headers에-하드코딩으로-post에-썼던-uid를-하드코딩해서-넣어주고-요청한다-또한-2-authrization탭에-post시-발급받은-token을-똑같이-직접-넣어줘야한다">token 인증요청자는 token생성한uid와 동일해야하는데, (10Headers에 하드코딩으로 POST에 썼던 uid를 하드코딩해서 넣어주고 요청한다. 또한, (2) Authrization탭에 POST시 발급받은 token을 똑같이 직접 넣어줘야한다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#003-인증요청자가-발급자와-다른uid를-가지고-있다면-token_verify가-인증실패---예외처리를-잘해준다--400-bad-request인데---400-user-not-permission">003 인증요청자가 발급자와 다른uid를 가지고 있다면? @token_verify가 인증실패 -&gt; 예외처리를 잘해준다.  (400, Bad Request인데, -&gt; 400, User not permission)</a>
<ul>
<li class="toc-entry toc-h5"><a href="#uid를-입력안해도-or-토큰이-없어도예외처리를-잘해준다400-bad-request인데----400에-no-authorized">uid를 입력안해도 (or 토큰이 없어도)예외처리를 잘해준다.(400, Bad Request인데 -&gt;  400에 No Authorized)</a></li>
<li class="toc-entry toc-h5"><a href="#token-맨끝에-12글자-지워도-잘-에러-내준다498-invalid-token---401-invalid-token">token 맨끝에 1~2글자 지워도 잘 에러 내준다.(498, Invalid Token, -&gt; 401 Invalid Token)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul><h2 id="데코레이터를-작성하는-순서">
<a class="anchor" href="#%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>데코레이터를 작성하는 순서</h2>

<h3 id="기본-데코레이터-만들기">
<a class="anchor" href="#%EA%B8%B0%EB%B3%B8-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>기본 데코레이터 만들기</h3>

<h4 id="01-기능을-입힐-base함수부터-작성한다-이왕이면-print가-아니라-return하는-결과물이-있는-함수를-작성하여-반환값에-대한-장식도-가능하게-한다">
<a class="anchor" href="#01-%EA%B8%B0%EB%8A%A5%EC%9D%84-%EC%9E%85%ED%9E%90-base%ED%95%A8%EC%88%98%EB%B6%80%ED%84%B0-%EC%9E%91%EC%84%B1%ED%95%9C%EB%8B%A4-%EC%9D%B4%EC%99%95%EC%9D%B4%EB%A9%B4-print%EA%B0%80-%EC%95%84%EB%8B%88%EB%9D%BC-return%ED%95%98%EB%8A%94-%EA%B2%B0%EA%B3%BC%EB%AC%BC%EC%9D%B4-%EC%9E%88%EB%8A%94-%ED%95%A8%EC%88%98%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EC%97%AC-%EB%B0%98%ED%99%98%EA%B0%92%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9E%A5%EC%8B%9D%EB%8F%84-%EA%B0%80%EB%8A%A5%ED%95%98%EA%B2%8C-%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 기능을 입힐 base함수부터 작성한다. 이왕이면 print가 아니라 return하는 결과물이 있는 함수를 작성하여, 반환값에 대한 장식도 가능하게 한다.</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/a55c4f3f-b77a-47ec-b9cf-b148bb0dd562.gif" alt="a55c4f3f-b77a-47ec-b9cf-b148bb0dd562"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720175248054.png" alt="image-20220720175248054"></p>

<h4 id="02-base함수를-호출부없는함수객체를-인자로-받는-클로져-함수를-사용-생성한다--여기까지는-지역상태메서드내부-인자-등를-기억하는-함수객체를-return한-뒤-외부에서-실제-인자를-받는-클로져가-된다">
<a class="anchor" href="#02-base%ED%95%A8%EC%88%98%EB%A5%BC-%ED%98%B8%EC%B6%9C%EB%B6%80%EC%97%86%EB%8A%94%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EC%9D%B8%EC%9E%90%EB%A1%9C-%EB%B0%9B%EB%8A%94-%ED%81%B4%EB%A1%9C%EC%A0%B8-%ED%95%A8%EC%88%98%EB%A5%BC-%EC%82%AC%EC%9A%A9-%EC%83%9D%EC%84%B1%ED%95%9C%EB%8B%A4--%EC%97%AC%EA%B8%B0%EA%B9%8C%EC%A7%80%EB%8A%94-%EC%A7%80%EC%97%AD%EC%83%81%ED%83%9C%EB%A9%94%EC%84%9C%EB%93%9C%EB%82%B4%EB%B6%80-%EC%9D%B8%EC%9E%90-%EB%93%B1%EB%A5%BC-%EA%B8%B0%EC%96%B5%ED%95%98%EB%8A%94-%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4%EB%A5%BC-return%ED%95%9C-%EB%92%A4-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%EC%8B%A4%EC%A0%9C-%EC%9D%B8%EC%9E%90%EB%A5%BC-%EB%B0%9B%EB%8A%94-%ED%81%B4%EB%A1%9C%EC%A0%B8%EA%B0%80-%EB%90%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 base함수를 (호출부없는)함수객체를 인자로 받는 클로져 함수를 사용-생성한다.  여기까지는 지역상태(메서드내부 인자 등)를 기억하는 함수객체를 return한 뒤, 외부에서 실제 인자를 받는 클로져가 된다.</h4>

<ul>
  <li>데코레이터는 <strong>장식할 함수를  일급객체로서 간주하여, ()호출부 없이 함수객체만 인자로 받으며 -&gt; 장식 후 -&gt; 다시 함수객체로 반환하는 클로져 형태를 띈다.</strong>
</li>
  <li>
<strong>대문자로 변경하는 장식을 할 것</strong>이므로, 데코레이터 메서드 명을 uppercase로 만든다.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/64d3b405-bc6b-4779-bdb8-f22808ccec5b.gif" alt="64d3b405-bc6b-4779-bdb8-f22808ccec5b"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720175542359.png" alt="image-20220720175542359"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720175553030.png" alt="image-20220720175553030"></p>

<h4 id="03-클로져-상태에서-base함수를-호출한-결과값을-장식해야한다면-반환은-값이-되므로-함수객체를-반환하지-않게-되어-클로져도-아니고-데코레이터도-아니게-된다-그냥-값이-반환된-상태라서-외부에서-호출없이-끝난다">
<a class="anchor" href="#03-%ED%81%B4%EB%A1%9C%EC%A0%B8-%EC%83%81%ED%83%9C%EC%97%90%EC%84%9C-base%ED%95%A8%EC%88%98%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%95%9C-%EA%B2%B0%EA%B3%BC%EA%B0%92%EC%9D%84-%EC%9E%A5%EC%8B%9D%ED%95%B4%EC%95%BC%ED%95%9C%EB%8B%A4%EB%A9%B4-%EB%B0%98%ED%99%98%EC%9D%80-%EA%B0%92%EC%9D%B4-%EB%90%98%EB%AF%80%EB%A1%9C-%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EB%B0%98%ED%99%98%ED%95%98%EC%A7%80-%EC%95%8A%EA%B2%8C-%EB%90%98%EC%96%B4-%ED%81%B4%EB%A1%9C%EC%A0%B8%EB%8F%84-%EC%95%84%EB%8B%88%EA%B3%A0-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%8F%84-%EC%95%84%EB%8B%88%EA%B2%8C-%EB%90%9C%EB%8B%A4-%EA%B7%B8%EB%83%A5-%EA%B0%92%EC%9D%B4-%EB%B0%98%ED%99%98%EB%90%9C-%EC%83%81%ED%83%9C%EB%9D%BC%EC%84%9C-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%EC%97%86%EC%9D%B4-%EB%81%9D%EB%82%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 클로져 상태에서, base함수를 호출한 결과값을 장식해야한다면? 반환은 값이 되므로 함수객체를 반환하지 않게 되어, 클로져도 아니고 데코레이터도 아니게 된다. 그냥 값이 반환된 상태라서 외부에서 ()호출없이 끝난다.</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/47058064-f7f1-402e-8240-f1abb50a0be6.gif" alt="47058064-f7f1-402e-8240-f1abb50a0be6"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720180253854.png" alt="image-20220720180253854"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720181046173.png" alt="image-20220720181046173"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720181054087.png" alt="image-20220720181054087"></p>

<h4 id="04-base결과물-장식-후-클로져-상태함수객체-반환를-유지하기-위한--inner메서드-wrapper로-감싼-뒤-return-wrapper함수객체---외부에서-호출될-함수로서-함부러-파라미터를-내부context라고-파라미터로-만들면-안된다---base함수의-인자에-맞춰야한다">
<a class="anchor" href="#04-base%EA%B2%B0%EA%B3%BC%EB%AC%BC-%EC%9E%A5%EC%8B%9D-%ED%9B%84-%ED%81%B4%EB%A1%9C%EC%A0%B8-%EC%83%81%ED%83%9C%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4-%EB%B0%98%ED%99%98%EB%A5%BC-%EC%9C%A0%EC%A7%80%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C--inner%EB%A9%94%EC%84%9C%EB%93%9C-wrapper%EB%A1%9C-%EA%B0%90%EC%8B%BC-%EB%92%A4-return-wrapper%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4---%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%EB%90%A0-%ED%95%A8%EC%88%98%EB%A1%9C%EC%84%9C-%ED%95%A8%EB%B6%80%EB%9F%AC-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-%EB%82%B4%EB%B6%80context%EB%9D%BC%EA%B3%A0-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A1%9C-%EB%A7%8C%EB%93%A4%EB%A9%B4-%EC%95%88%EB%90%9C%EB%8B%A4---base%ED%95%A8%EC%88%98%EC%9D%98-%EC%9D%B8%EC%9E%90%EC%97%90-%EB%A7%9E%EC%B6%B0%EC%95%BC%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 base결과물 장식 후, 클로져 상태(함수객체 반환)를 유지하기 위한  inner메서드 wrapper로 감싼 뒤, return wrapper함수객체 -&gt; 외부에서 호출될 함수로서, 함부러 파라미터를 내부context라고 파라미터로 만들면 안된다. -&gt; base함수의 인자에 맞춰야한다.</h4>

<ul>
  <li>
    <p>wrapper는 <strong><code class="language-plaintext highlighter-rouge">inner메서드</code>이므로</strong>, <strong>context객체들을 그대로 사용하여 paramter로 뺄 필요가 없다.(외부호출시 사용될 메서드 객체기 때문에 파라미터를 함부러줘선 안된다.)</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/ff64c879-a8d9-4342-9d7d-cd912b567b2c.gif" alt="ff64c879-a8d9-4342-9d7d-cd912b567b2c"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720183920956.png" alt="image-20220720183920956"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720184020793.png" alt="image-20220720184020793"></p>
  </li>
</ul>

<h4 id="05-완성된-데코는-base함수에-달아서-사용해주기">
<a class="anchor" href="#05-%EC%99%84%EC%84%B1%EB%90%9C-%EB%8D%B0%EC%BD%94%EB%8A%94-base%ED%95%A8%EC%88%98%EC%97%90-%EB%8B%AC%EC%95%84%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>05 완성된 데코는, base함수에 @달아서 사용해주기</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/ef532c24-00c5-499b-a7ab-478ffa120295.gif" alt="ef532c24-00c5-499b-a7ab-478ffa120295"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720184425813.png" alt="image-20220720184425813"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720184434604.png" alt="image-20220720184434604"></p>

<h4 id="06-다중데코레이터는-외부에서-한번더-감싸서-만들고-달-때는-아래-위-순서대로-단다">
<a class="anchor" href="#06-%EB%8B%A4%EC%A4%91%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%8A%94-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%ED%95%9C%EB%B2%88%EB%8D%94-%EA%B0%90%EC%8B%B8%EC%84%9C-%EB%A7%8C%EB%93%A4%EA%B3%A0-%EB%8B%AC-%EB%95%8C%EB%8A%94-%EC%95%84%EB%9E%98-%EC%9C%84-%EC%88%9C%EC%84%9C%EB%8C%80%EB%A1%9C-%EB%8B%A8%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>06 다중데코레이터는, 외부에서 한번더 감싸서 만들고, 달 때는 아래-&gt;위 순서대로 단다.</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185131350.png" alt="image-20220720185131350"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185150566.png" alt="image-20220720185150566"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185256023.png" alt="image-20220720185256023"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185237058.png" alt="image-20220720185237058"></p>

<h3 id="함수객체-name에-base함수가-찍히도록-디버깅되는-데코레이터로-바꾸기-by-wrapper메서드에-functoolswrapsfunc-데코-달아주기">
<a class="anchor" href="#%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4-name%EC%97%90-base%ED%95%A8%EC%88%98%EA%B0%80-%EC%B0%8D%ED%9E%88%EB%8F%84%EB%A1%9D-%EB%94%94%EB%B2%84%EA%B9%85%EB%90%98%EB%8A%94-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A1%9C-%EB%B0%94%EA%BE%B8%EA%B8%B0-by-wrapper%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90-functoolswrapsfunc-%EB%8D%B0%EC%BD%94-%EB%8B%AC%EC%95%84%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>함수객체 name에 base함수가 찍히도록 디버깅되는 데코레이터로 바꾸기 by wrapper메서드에 @functools.wraps(func) 데코 달아주기</h3>

<ul>
  <li>데코레이터를 입힌 base함수를,  <code class="language-plaintext highlighter-rouge">함수객체.__name__</code>을 찍어보면, 중간의 wrapper로 나온다.
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185516643.png" alt="image-20220720185516643">
</li>
  <li>
    <p><strong>데코레이터의 wrapper함수에 <code class="language-plaintext highlighter-rouge">@functools.wraps(func)</code> 데코레이터를 달아줘야, base함수가 찍힌다.</strong>
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185603276.png" alt="image-20220720185603276"></p>
  </li>
  <li>
    <p>만약, 2개의 데코레이터를 중첩적용하고 있고, 첫번째 데코만 처리해줬다면? -&gt; wrapper로 나온다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185658874.png" alt="image-20220720185658874"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185732640.png" alt="image-20220720185732640"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185741410.png" alt="image-20220720185741410"></p>

    <ul>
      <li>
        <p>2번째 데코레이터도 달아줘야한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185802853.png" alt="image-20220720185802853"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720185809409.png" alt="image-20220720185809409"></p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="base함수호출시-필요한-특정-인자를-외부에서-조달하려면-외부에-return되서-가-붙는-함수객체-wrapper에-args-kwargs로-파라미터를-정의하여-어떤-인자든-들어오게-한다">
<a class="anchor" href="#base%ED%95%A8%EC%88%98%ED%98%B8%EC%B6%9C%EC%8B%9C-%ED%95%84%EC%9A%94%ED%95%9C-%ED%8A%B9%EC%A0%95-%EC%9D%B8%EC%9E%90%EB%A5%BC-%EC%99%B8%EB%B6%80%EC%97%90%EC%84%9C-%EC%A1%B0%EB%8B%AC%ED%95%98%EB%A0%A4%EB%A9%B4-%EC%99%B8%EB%B6%80%EC%97%90-return%EB%90%98%EC%84%9C-%EA%B0%80-%EB%B6%99%EB%8A%94-%ED%95%A8%EC%88%98%EA%B0%9D%EC%B2%B4-wrapper%EC%97%90-args-kwargs%EB%A1%9C-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-%EC%A0%95%EC%9D%98%ED%95%98%EC%97%AC-%EC%96%B4%EB%96%A4-%EC%9D%B8%EC%9E%90%EB%93%A0-%EB%93%A4%EC%96%B4%EC%98%A4%EA%B2%8C-%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>base함수호출시 필요한 특정 인자를 외부에서 조달하려면, 외부에 return되서 ()가 붙는 함수객체 wrapper에 <code class="language-plaintext highlighter-rouge">*args, **kwargs</code>로 파라미터를 정의하여 어떤 인자든 들어오게 한다.</h3>

<ul>
  <li>
    <p>데코레이터 함수 자체에 인자가 아니다(func만 받는다.)</p>
  </li>
  <li>
    <p>마지막엔 <code class="language-plaintext highlighter-rouge">return wrapper</code>로 wrapper의 함수객체가 반환되므로 <strong>wrapper에 <code class="language-plaintext highlighter-rouge">*args</code>나 <code class="language-plaintext highlighter-rouge">\**kw args</code>를 받도록 하면, <code class="language-plaintext highlighter-rouge">어떤 인자든 다 들어올 수 있다</code></strong></p>

    <ul>
      <li><strong>들어온 인자를 그대로 사용하려면 <code class="language-plaintext highlighter-rouge">*args</code>를 base에서 그대로 사용한다.</strong></li>
      <li><strong>만약 <code class="language-plaintext highlighter-rouge">콤마로 연결된 인자들</code>이 들어왔는데,  <code class="language-plaintext highlighter-rouge">반복문 등에 사용</code>된다면 <code class="language-plaintext highlighter-rouge">*를 빼서 패킹</code>된 상태로 돌린다.</strong></li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p>현재 base함수를 <strong>파라미터를</strong> 통해 <strong>문자열 인자 받도록 변경</strong>한다.</p>

    <ul>
      <li><strong>그래도 바로 사용못한다. 왜냐면, 데코레이터에 감싸진 이상 <code class="language-plaintext highlighter-rouge">wrapper</code>가 반환되기 때문에</strong></li>
      <li>wrapper는 인자를 안받는데, 왜 받고 있냐 물어본다.</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/a76ed85b-936a-4c51-a3ae-7f50490548ad.gif" alt="a76ed85b-936a-4c51-a3ae-7f50490548ad"></p>
  </li>
  <li>
    <p><strong>외부에서 호출되는 wrapper함수에 <code class="language-plaintext highlighter-rouge">base함수호출시 필요한 인자</code>를 주되 <code class="language-plaintext highlighter-rouge">*args, *\*kwargs</code>로 주어 어떤 인자든 받을 수 있게 한다.</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">args</code> : 튜플로 패킹된다.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">*args</code>: 받은 인자 그대로를 언패킹해서 사용한다.</p>

        <ul>
          <li>파라미터속 <code class="language-plaintext highlighter-rouge">*args</code> : 콤마 = 튜플로 넘어온 인자를 언패킹한 상태로 가지고 있다. 언제든지 <code class="language-plaintext highlighter-rouge">*</code>를 떼서 컬렉션형태로 사용할 수 있다.</li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/58811d23-66eb-496d-8ceb-45ed76222443.gif" alt="58811d23-66eb-496d-8ceb-45ed76222443"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720193114348.png" alt="image-20220720193114348"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720193139906.png" alt="image-20220720193139906"></p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="역순으로-jwt-인증-decorator-작성">
<a class="anchor" href="#%EC%97%AD%EC%88%9C%EC%9C%BC%EB%A1%9C-jwt-%EC%9D%B8%EC%A6%9D-decorator-%EC%9E%91%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>역순으로 jwt 인증 decorator 작성</h2>

<h3 id="01-route마다-매번-token-인증---실패시-예외의-검증하는-로직을-route에-반복-기술하는-대신-데코레이터로-만들기">
<a class="anchor" href="#01-route%EB%A7%88%EB%8B%A4-%EB%A7%A4%EB%B2%88-token-%EC%9D%B8%EC%A6%9D---%EC%8B%A4%ED%8C%A8%EC%8B%9C-%EC%98%88%EC%99%B8%EC%9D%98-%EA%B2%80%EC%A6%9D%ED%95%98%EB%8A%94-%EB%A1%9C%EC%A7%81%EC%9D%84-route%EC%97%90-%EB%B0%98%EB%B3%B5-%EA%B8%B0%EC%88%A0%ED%95%98%EB%8A%94-%EB%8C%80%EC%8B%A0-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A1%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 Route마다 매번 [token 인증 -&gt; 실패시 예외]의 검증하는 로직을 route에 반복 기술하는 대신 데코레이터로 만들기</h3>

<ul>
  <li>
    <p><a href="https://blog.chojaeseong.com/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html">참고 내 블로그</a></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>기본 데코레이터 만들기
01 기능을 입힐 base함수부터 작성한다. 이왕이면 print가 아니라 return하는 결과물이 있는 함수를 작성하여, 반환값에 대한 장식도 가능하게 한다.
02 base함수를 (호출부없는)함수객체를 인자로 받는 클로져 함수를 사용-생성한다. 여기까지는 지역상태(메서드내부 인자 등)를 기억하는 함수객체를 return한 뒤, 외부에서 실제 인자를 받는 클로져가 된다.
03 클로져 상태에서, base함수를 호출한 결과값을 장식해야한다면? 반환은 값이 되므로 함수객체를 반환하지 않게 되어, 클로져도 아니고 데코레이터도 아니게 된다. 그냥 값이 반환된 상태라서 외부에서 ()호출없이 끝난다.
04 base결과물 장식 후, 클로져 상태(함수객체 반환)를 유지하기 위한 inner메서드 wrapper로 감싼 뒤, return wrapper함수객체 -&gt; 외부에서 호출될 함수로서, 함부러 파라미터를 내부context라고 파라미터로 만들면 안된다. -&gt; base함수의 인자에 맞춰야한다.
05 완성된 데코는, base함수에 @달아서 사용해주기
06 다중데코레이터는, 외부에서 한번더 감싸서 만들고, 달 때는 아래-&gt;위 순서대로 단다.
함수객체 name에 base함수가 찍히도록 디버깅되는 데코레이터로 바꾸기 by wrapper메서드에 @functools.wraps(func) 데코 달아주기
base함수호출시 필요한 특정 인자를 외부에서 조달하려면, 외부에 return되서 ()가 붙는 함수객체 wrapper에 *args, **kwargs로 파라미터를 정의하여 어떤 인자든 들어오게 한다.
</code></pre></div>    </div>
  </li>
</ul>

<h4 id="001-src--auth_jwt--token_verifierpy-생성">
<a class="anchor" href="#001-src--auth_jwt--token_verifierpy-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>001 src &gt; auth_jwt &gt; token_verifier.py 생성</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010211709522.png" alt="image-20221010211709522"></p>

<h3 id="02-token인증실패시-예외을-데코레이터-만드는-방법바깥에서부터">
<a class="anchor" href="#02-token%EC%9D%B8%EC%A6%9D%EC%8B%A4%ED%8C%A8%EC%8B%9C-%EC%98%88%EC%99%B8%EC%9D%84-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95%EB%B0%94%EA%B9%A5%EC%97%90%EC%84%9C%EB%B6%80%ED%84%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 token인증(실패시 예외)을 데코레이터 만드는 방법(바깥에서부터)</h3>

<ul>
  <li>
<strong>route의 메서드</strong>가, 데코레이터의 decorator -&gt; warpper -&gt; base_func 중 <strong>basefunc을 차지하게 됨.</strong>
</li>
</ul>

<h4 id="001-decorator는--호출-전의-base_func객체를-인자로-받아서-내부에서-호출하고-return은-func객체를-호출하고-실제-deco하는-inner-method-wrapper를-호출하지-않은체-반환하므로-inputfuncbase_func---output-funcwrapper이다">
<a class="anchor" href="#001-decorator%EB%8A%94--%ED%98%B8%EC%B6%9C-%EC%A0%84%EC%9D%98-base_func%EA%B0%9D%EC%B2%B4%EB%A5%BC-%EC%9D%B8%EC%9E%90%EB%A1%9C-%EB%B0%9B%EC%95%84%EC%84%9C-%EB%82%B4%EB%B6%80%EC%97%90%EC%84%9C-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B3%A0-return%EC%9D%80-func%EA%B0%9D%EC%B2%B4%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%95%98%EA%B3%A0-%EC%8B%A4%EC%A0%9C-deco%ED%95%98%EB%8A%94-inner-method-wrapper%EB%A5%BC-%ED%98%B8%EC%B6%9C%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80%EC%B2%B4-%EB%B0%98%ED%99%98%ED%95%98%EB%AF%80%EB%A1%9C-inputfuncbase_func---output-funcwrapper%EC%9D%B4%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>001 decorator는  ()호출 전의 base_func객체를 인자로 받아서 내부에서 호출하고, return은 func객체를 호출하고 실제 deco하는 inner method wrapper를 호출하지 않은체 반환하므로 [input:func(base_func) -&gt; output func(wrapper)]이다.</h4>

<ul>
  <li>
    <p>참고</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720183920956.png" alt=""></p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">token_verify</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>
</code></pre></div></div>

<h4 id="002-inner-method-wrapper메서드는-결과값을-deco당하거나-or-호출전후로-작업을-하고-싶은-base_func의-decorating-과정에서---외부-인자가요구하는-순간-wrapper-method도-인자를-args-kwargs로-받는다-inner-method인-wrapper는-decorator-맨-마지막에-호출하지-않은-체-반환되는-closure다">
<a class="anchor" href="#002-inner-method-wrapper%EB%A9%94%EC%84%9C%EB%93%9C%EB%8A%94-%EA%B2%B0%EA%B3%BC%EA%B0%92%EC%9D%84-deco%EB%8B%B9%ED%95%98%EA%B1%B0%EB%82%98-or-%ED%98%B8%EC%B6%9C%EC%A0%84%ED%9B%84%EB%A1%9C-%EC%9E%91%EC%97%85%EC%9D%84-%ED%95%98%EA%B3%A0-%EC%8B%B6%EC%9D%80-base_func%EC%9D%98-decorating-%EA%B3%BC%EC%A0%95%EC%97%90%EC%84%9C---%EC%99%B8%EB%B6%80-%EC%9D%B8%EC%9E%90%EA%B0%80%EC%9A%94%EA%B5%AC%ED%95%98%EB%8A%94-%EC%88%9C%EA%B0%84-wrapper-method%EB%8F%84-%EC%9D%B8%EC%9E%90%EB%A5%BC-args-kwargs%EB%A1%9C-%EB%B0%9B%EB%8A%94%EB%8B%A4-inner-method%EC%9D%B8-wrapper%EB%8A%94-decorator-%EB%A7%A8-%EB%A7%88%EC%A7%80%EB%A7%89%EC%97%90-%ED%98%B8%EC%B6%9C%ED%95%98%EC%A7%80-%EC%95%8A%EC%9D%80-%EC%B2%B4-%EB%B0%98%ED%99%98%EB%90%98%EB%8A%94-closure%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>002 inner method wrapper메서드는 [결과값을 deco당하거나 or 호출전후로 작업을 하고 싶은 base_func()]의 decorating 과정에서 -&gt; 외부 인자가요구하는 순간, wrapper method도 인자를 <code class="language-plaintext highlighter-rouge">*args, **kwargs</code>로 받는다. inner method인 wrapper는 decorator 맨 마지막에 호출하지 않은 체 반환되는 closure다</h4>

<ul>
  <li>
    <p>참고</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220720193114348.png" alt=""></p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">token_verify</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">## pre decoration
</span>
        <span class="c1"># result = function()
</span>
        <span class="c1">## post decoration
</span>        <span class="c1"># post_decorated_result = result + @
</span>        <span class="c1"># return decorated_result
</span>        
    <span class="k">return</span> <span class="n">decorated</span>
</code></pre></div></div>

<h4 id="003-get-route에서-token인증을-위한-decode--예외처리-했던-로직을-inner-method-warpper여기선-decorated-내부로-가져와서-base_func-여기서는-route함수-호출전-1token인증실패시-예외--2-token-refresh-작업을-항상-진행하게-해준다">
<a class="anchor" href="#003-get-route%EC%97%90%EC%84%9C-token%EC%9D%B8%EC%A6%9D%EC%9D%84-%EC%9C%84%ED%95%9C-decode--%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC-%ED%96%88%EB%8D%98-%EB%A1%9C%EC%A7%81%EC%9D%84-inner-method-warpper%EC%97%AC%EA%B8%B0%EC%84%A0-decorated-%EB%82%B4%EB%B6%80%EB%A1%9C-%EA%B0%80%EC%A0%B8%EC%99%80%EC%84%9C-base_func-%EC%97%AC%EA%B8%B0%EC%84%9C%EB%8A%94-route%ED%95%A8%EC%88%98-%ED%98%B8%EC%B6%9C%EC%A0%84-1token%EC%9D%B8%EC%A6%9D%EC%8B%A4%ED%8C%A8%EC%8B%9C-%EC%98%88%EC%99%B8--2-token-refresh-%EC%9E%91%EC%97%85%EC%9D%84-%ED%95%AD%EC%83%81-%EC%A7%84%ED%96%89%ED%95%98%EA%B2%8C-%ED%95%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>003 GET route에서 token인증을 위한 decode + 예외처리 했던 로직을 inner method warpper(여기선 decorated) 내부로 가져와서, [base_func (여기서는 route함수) 호출전 (1)TOKEN인증(==실패시 예외) + (2) TOKEN REFRESH 작업]을 항상 진행하게 해준다.</h4>

<ul>
  <li>
    <p>get route</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010214759256.png" alt="image-20221010214759256"></p>
  </li>
  <li>
    <p>이동</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010214905612.png" alt="image-20221010214905612"></p>
  </li>
</ul>

<h4 id="004-필요한-것들을-import하고-수정해나간다">
<a class="anchor" href="#004-%ED%95%84%EC%9A%94%ED%95%9C-%EA%B2%83%EB%93%A4%EC%9D%84-import%ED%95%98%EA%B3%A0-%EC%88%98%EC%A0%95%ED%95%B4%EB%82%98%EA%B0%84%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>004 필요한 것들을 import하고, 수정해나간다</h4>

<ul>
  <li>auth_jwt &gt; token_verifier.py에
    <ul>
      <li>flaks관련 모듈이 import된다</li>
      <li>jwt가 import된다</li>
      <li>싱글톤 token_creator도 import된다
        <ul>
          <li><strong>인증 및 예외발생 route에는 없던 refresh를 해주기 위해</strong></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>


<span class="k">def</span> <span class="nf">token_verify</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">raw_token</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"uid"</span><span class="p">)</span>

        <span class="c1"># if not raw_token:
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw_token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">uid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Bad Request"</span>
            <span class="p">}),</span> <span class="mi">400</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">raw_token</span><span class="p">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">token_information</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">'1234'</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="s">'HS256'</span><span class="p">)</span>
            <span class="n">token_uid</span> <span class="o">=</span> <span class="n">token_information</span><span class="p">[</span><span class="s">"uid"</span><span class="p">]</span>

        <span class="k">except</span> <span class="n">jwt</span><span class="p">.</span><span class="n">InvalidSignatureError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Invalid Token"</span>
            <span class="p">}),</span> <span class="mi">498</span>

        <span class="k">except</span> <span class="n">jwt</span><span class="p">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Token expried"</span>
            <span class="p">}),</span> <span class="mi">401</span>
            
        <span class="k">except</span> <span class="nb">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Invalid Token2"</span>
            <span class="p">}),</span> <span class="mi">401</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">token_uid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"User not permission"</span>
            <span class="p">}),</span> <span class="mi">400</span>

    <span class="k">return</span> <span class="n">decorated</span>

</code></pre></div></div>

<h4 id="005-base_func인-functionroute함수는-wrapperdecorated에서-token인증-및-예외처리-끝내고-자신만-호출되면-되나-인증안되면-예외발생하고-인증되면-route-자신의-역할만-하면-끝">
<a class="anchor" href="#005-base_func%EC%9D%B8-functionroute%ED%95%A8%EC%88%98%EB%8A%94-wrapperdecorated%EC%97%90%EC%84%9C-token%EC%9D%B8%EC%A6%9D-%EB%B0%8F-%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC-%EB%81%9D%EB%82%B4%EA%B3%A0-%EC%9E%90%EC%8B%A0%EB%A7%8C-%ED%98%B8%EC%B6%9C%EB%90%98%EB%A9%B4-%EB%90%98%EB%82%98-%EC%9D%B8%EC%A6%9D%EC%95%88%EB%90%98%EB%A9%B4-%EC%98%88%EC%99%B8%EB%B0%9C%EC%83%9D%ED%95%98%EA%B3%A0-%EC%9D%B8%EC%A6%9D%EB%90%98%EB%A9%B4-route-%EC%9E%90%EC%8B%A0%EC%9D%98-%EC%97%AD%ED%95%A0%EB%A7%8C-%ED%95%98%EB%A9%B4-%EB%81%9D" aria-hidden="true"><span class="octicon octicon-link"></span></a>005 base_func인 function(route함수)는 wrapper(decorated)에서 [token인증 및 예외처리] 끝내고, 자신만 호출되면 되나? 인증안되면 예외발생하고, 인증되면 route 자신의 역할만 하면 끝??</h4>

<ul>
  <li>
    <p>시나리오</p>

    <ul>
      <li>
        <p><strong>route함수가, 인증 및 예외처리만 할 경우 -&gt; deco내wrapper내 token처리 끝나고 base_func()호출시 특별한 인자 없이 <code class="language-plaintext highlighter-rouge">base_func(\*args, \**kwargs)</code>로 return하고 끝낸다</strong></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010220636213.png" alt="image-20221010220636213"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010220852840.png" alt="image-20221010220852840"></p>
      </li>
      <li>
        <p><strong>route함수가, 인증 및 예외처리하고 <code class="language-plaintext highlighter-rouge">REFRESH한 token이 새로 발급</code>되어서, <code class="language-plaintext highlighter-rouge">이것을 인자로 받아갈 때</code></strong></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010220940515.png" alt="image-20221010220940515"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221010221134178.png" alt="image-20221010221134178"></p>
      </li>
    </ul>
  </li>
</ul>

<h4 id="006-route함수가-decorator로-token인증을-거치는-경우-인증성공시의-refresh된-token을-route함수-인자로-받아야하며-decorator작성시-base_funcroute_func은-argskargs-앞에-가장-첫-인자로-next_token을-추가해야한다">
<a class="anchor" href="#006-route%ED%95%A8%EC%88%98%EA%B0%80-decorator%EB%A1%9C-token%EC%9D%B8%EC%A6%9D%EC%9D%84-%EA%B1%B0%EC%B9%98%EB%8A%94-%EA%B2%BD%EC%9A%B0-%EC%9D%B8%EC%A6%9D%EC%84%B1%EA%B3%B5%EC%8B%9C%EC%9D%98-refresh%EB%90%9C-token%EC%9D%84-route%ED%95%A8%EC%88%98-%EC%9D%B8%EC%9E%90%EB%A1%9C-%EB%B0%9B%EC%95%84%EC%95%BC%ED%95%98%EB%A9%B0-decorator%EC%9E%91%EC%84%B1%EC%8B%9C-base_funcroute_func%EC%9D%80-argskargs-%EC%95%9E%EC%97%90-%EA%B0%80%EC%9E%A5-%EC%B2%AB-%EC%9D%B8%EC%9E%90%EB%A1%9C-next_token%EC%9D%84-%EC%B6%94%EA%B0%80%ED%95%B4%EC%95%BC%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>006 route함수가 decorator로 token인증을 거치는 경우, 인증성공시의 refresh된 token을 route함수 인자로 받아야하며, decorator작성시, base_func(route_func)은 *args**kargs 앞에 가장 첫 인자로 next_token을 추가해야한다</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011014624097.png" alt="image-20221011014624097"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jwt</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">.token_handler</span> <span class="kn">import</span> <span class="n">token_creator</span>


<span class="k">def</span> <span class="nf">token_verify</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">raw_token</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"Authorization"</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">headers</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"uid"</span><span class="p">)</span>

        <span class="c1"># if not raw_token:
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">raw_token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">uid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Bad Request"</span>
            <span class="p">}),</span> <span class="mi">400</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">token</span> <span class="o">=</span> <span class="n">raw_token</span><span class="p">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">token_information</span> <span class="o">=</span> <span class="n">jwt</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">'1234'</span><span class="p">,</span> <span class="n">algorithms</span><span class="o">=</span><span class="s">'HS256'</span><span class="p">)</span>
            <span class="n">token_uid</span> <span class="o">=</span> <span class="n">token_information</span><span class="p">[</span><span class="s">"uid"</span><span class="p">]</span>

        <span class="k">except</span> <span class="n">jwt</span><span class="p">.</span><span class="n">InvalidSignatureError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Invalid Token"</span>
            <span class="p">}),</span> <span class="mi">498</span>

        <span class="k">except</span> <span class="n">jwt</span><span class="p">.</span><span class="n">ExpiredSignatureError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Token expried"</span>
            <span class="p">}),</span> <span class="mi">401</span>

        <span class="k">except</span> <span class="nb">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"Invalid Token2"</span>
            <span class="p">}),</span> <span class="mi">401</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">token_uid</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s">"error"</span><span class="p">:</span> <span class="s">"User not permission"</span>
            <span class="p">}),</span> <span class="mi">400</span>

        <span class="n">next_token</span> <span class="o">=</span> <span class="n">token_creator</span><span class="p">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="c1"># route function
</span>        <span class="c1"># return function(*args, **kwargs)
</span>        <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">next_token</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">decorated</span>
</code></pre></div></div>

<h4 id="007-inner-method-wrapper메서드에-functoolswraps-base_func-을-달아주면-디버깅시-함수name이-같이-찍힌다">
<a class="anchor" href="#007-inner-method-wrapper%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90-functoolswraps-base_func-%EC%9D%84-%EB%8B%AC%EC%95%84%EC%A3%BC%EB%A9%B4-%EB%94%94%EB%B2%84%EA%B9%85%EC%8B%9C-%ED%95%A8%EC%88%98name%EC%9D%B4-%EA%B0%99%EC%9D%B4-%EC%B0%8D%ED%9E%8C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>007 inner method wrapper메서드에 @functools.wraps( base_func )을 달아주면, 디버깅시 함수name이 같이 찍힌다</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="c1">#...
</span><span class="k">def</span> <span class="nf">token_verify</span><span class="p">(</span><span class="n">function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">callable</span><span class="p">:</span>
    
    <span class="o">@</span><span class="n">wraps</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</code></pre></div></div>

<h4 id="008-auth_jwt-init에-올리기">
<a class="anchor" href="#008-auth_jwt-init%EC%97%90-%EC%98%AC%EB%A6%AC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>008 auth_jwt init에 올리기</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.token_handler</span> <span class="kn">import</span> <span class="n">token_creator</span>
<span class="kn">from</span> <span class="nn">.token_verifier</span> <span class="kn">import</span> <span class="n">token_verify</span>
</code></pre></div></div>

<h3 id="03-token-인증필요-routeget에서-jwt-인증--decorator사용하기">
<a class="anchor" href="#03-token-%EC%9D%B8%EC%A6%9D%ED%95%84%EC%9A%94-routeget%EC%97%90%EC%84%9C-jwt-%EC%9D%B8%EC%A6%9D--decorator%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 token 인증필요 route(GET)에서 jwt 인증  decorator사용하기</h3>

<h4 id="001-jwt-인증-데코레이터는-base_func이-인자로-next_token을-받는-것을-가정했으니---route함수는-token을-인자로-받아야한다---return에도-받은-next_token을-반환해보자">
<a class="anchor" href="#001-jwt-%EC%9D%B8%EC%A6%9D-%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%8A%94-base_func%EC%9D%B4-%EC%9D%B8%EC%9E%90%EB%A1%9C-next_token%EC%9D%84-%EB%B0%9B%EB%8A%94-%EA%B2%83%EC%9D%84-%EA%B0%80%EC%A0%95%ED%96%88%EC%9C%BC%EB%8B%88---route%ED%95%A8%EC%88%98%EB%8A%94-token%EC%9D%84-%EC%9D%B8%EC%9E%90%EB%A1%9C-%EB%B0%9B%EC%95%84%EC%95%BC%ED%95%9C%EB%8B%A4---return%EC%97%90%EB%8F%84-%EB%B0%9B%EC%9D%80-next_token%EC%9D%84-%EB%B0%98%ED%99%98%ED%95%B4%EB%B3%B4%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>001 jwt 인증 데코레이터는 base_func이 인자로 next_token을 받는 것을 가정했으니 -&gt; route함수는 token을 인자로 받아야한다 -&gt; return에도 받은 next_token을 반환해보자.</h4>

<ul>
  <li>api_route.py</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#...
</span><span class="kn">from</span> <span class="nn">src.auth_jwt</span> <span class="kn">import</span> <span class="n">token_creator</span><span class="p">,</span> <span class="n">token_verifier</span>
<span class="c1">#...
</span>
<span class="o">@</span><span class="n">api_routes_bp</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/secret"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">"GET"</span><span class="p">])</span>
<span class="o">@</span><span class="n">token_verifier</span>
<span class="k">def</span> <span class="nf">secret_route</span><span class="p">(</span><span class="n">token</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
        <span class="s">'data'</span><span class="p">:</span> <span class="n">token</span>
    <span class="p">}),</span> <span class="mi">200</span>
</code></pre></div></div>

<h4 id="002-postman에서-토큰생성-post---토큰-인증get-해보기">
<a class="anchor" href="#002-postman%EC%97%90%EC%84%9C-%ED%86%A0%ED%81%B0%EC%83%9D%EC%84%B1-post---%ED%86%A0%ED%81%B0-%EC%9D%B8%EC%A6%9Dget-%ED%95%B4%EB%B3%B4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>002 POSTMAN에서 토큰생성 (POST) -&gt; 토큰 인증(GET) 해보기</h4>

<h5 id="token-생성은-생성요청자-uid를-넣어줘야하는데-여기선-하드코딩으로-넣어준다">
<a class="anchor" href="#token-%EC%83%9D%EC%84%B1%EC%9D%80-%EC%83%9D%EC%84%B1%EC%9A%94%EC%B2%AD%EC%9E%90-uid%EB%A5%BC-%EB%84%A3%EC%96%B4%EC%A4%98%EC%95%BC%ED%95%98%EB%8A%94%EB%8D%B0-%EC%97%AC%EA%B8%B0%EC%84%A0-%ED%95%98%EB%93%9C%EC%BD%94%EB%94%A9%EC%9C%BC%EB%A1%9C-%EB%84%A3%EC%96%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>token 생성은 생성요청자 uid를 넣어줘야하는데, 여기선 하드코딩으로 넣어준다</h5>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011015852728.png" alt="image-20221011015852728"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011015644925.png" alt="image-20221011015644925"></p>

<h5 id="token-인증요청자는-token생성한uid와-동일해야하는데-10headers에-하드코딩으로-post에-썼던-uid를-하드코딩해서-넣어주고-요청한다-또한-2-authrization탭에-post시-발급받은-token을-똑같이-직접-넣어줘야한다">
<a class="anchor" href="#token-%EC%9D%B8%EC%A6%9D%EC%9A%94%EC%B2%AD%EC%9E%90%EB%8A%94-token%EC%83%9D%EC%84%B1%ED%95%9Cuid%EC%99%80-%EB%8F%99%EC%9D%BC%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94%EB%8D%B0-10headers%EC%97%90-%ED%95%98%EB%93%9C%EC%BD%94%EB%94%A9%EC%9C%BC%EB%A1%9C-post%EC%97%90-%EC%8D%BC%EB%8D%98-uid%EB%A5%BC-%ED%95%98%EB%93%9C%EC%BD%94%EB%94%A9%ED%95%B4%EC%84%9C-%EB%84%A3%EC%96%B4%EC%A3%BC%EA%B3%A0-%EC%9A%94%EC%B2%AD%ED%95%9C%EB%8B%A4-%EB%98%90%ED%95%9C-2-authrization%ED%83%AD%EC%97%90-post%EC%8B%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EC%9D%80-token%EC%9D%84-%EB%98%91%EA%B0%99%EC%9D%B4-%EC%A7%81%EC%A0%91-%EB%84%A3%EC%96%B4%EC%A4%98%EC%95%BC%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>token 인증요청자는 token생성한uid와 동일해야하는데, (10Headers에 하드코딩으로 POST에 썼던 uid를 하드코딩해서 넣어주고 요청한다. 또한, (2) Authrization탭에 POST시 발급받은 token을 똑같이 직접 넣어줘야한다.</h5>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011015731021.png" alt="image-20221011015731021"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011015706030.png" alt="image-20221011015706030"></p>

<h4 id="003-인증요청자가-발급자와-다른uid를-가지고-있다면-token_verify가-인증실패---예외처리를-잘해준다--400-bad-request인데---400-user-not-permission">
<a class="anchor" href="#003-%EC%9D%B8%EC%A6%9D%EC%9A%94%EC%B2%AD%EC%9E%90%EA%B0%80-%EB%B0%9C%EA%B8%89%EC%9E%90%EC%99%80-%EB%8B%A4%EB%A5%B8uid%EB%A5%BC-%EA%B0%80%EC%A7%80%EA%B3%A0-%EC%9E%88%EB%8B%A4%EB%A9%B4-token_verify%EA%B0%80-%EC%9D%B8%EC%A6%9D%EC%8B%A4%ED%8C%A8---%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC%EB%A5%BC-%EC%9E%98%ED%95%B4%EC%A4%80%EB%8B%A4--400-bad-request%EC%9D%B8%EB%8D%B0---400-user-not-permission" aria-hidden="true"><span class="octicon octicon-link"></span></a>003 인증요청자가 발급자와 다른uid를 가지고 있다면? @token_verify가 인증실패 -&gt; 예외처리를 잘해준다.  (400, Bad Request인데, -&gt; 400, User not permission)</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020126251.png" alt="image-20221011020126251"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020306881.png" alt="image-20221011020306881"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011021008053.png" alt="image-20221011021008053"></p>

<h5 id="uid를-입력안해도-or-토큰이-없어도예외처리를-잘해준다400-bad-request인데----400에-no-authorized">
<a class="anchor" href="#uid%EB%A5%BC-%EC%9E%85%EB%A0%A5%EC%95%88%ED%95%B4%EB%8F%84-or-%ED%86%A0%ED%81%B0%EC%9D%B4-%EC%97%86%EC%96%B4%EB%8F%84%EC%98%88%EC%99%B8%EC%B2%98%EB%A6%AC%EB%A5%BC-%EC%9E%98%ED%95%B4%EC%A4%80%EB%8B%A4400-bad-request%EC%9D%B8%EB%8D%B0----400%EC%97%90-no-authorized" aria-hidden="true"><span class="octicon octicon-link"></span></a>uid를 입력안해도 (or 토큰이 없어도)예외처리를 잘해준다.(400, Bad Request인데 -&gt;  400에 No Authorized)</h5>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020237204.png" alt="image-20221011020237204"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020246890.png" alt="image-20221011020246890"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020826150.png" alt="image-20221011020826150"></p>

<h5 id="token-맨끝에-12글자-지워도-잘-에러-내준다498-invalid-token---401-invalid-token">
<a class="anchor" href="#token-%EB%A7%A8%EB%81%9D%EC%97%90-12%EA%B8%80%EC%9E%90-%EC%A7%80%EC%9B%8C%EB%8F%84-%EC%9E%98-%EC%97%90%EB%9F%AC-%EB%82%B4%EC%A4%80%EB%8B%A4498-invalid-token---401-invalid-token" aria-hidden="true"><span class="octicon octicon-link"></span></a>token 맨끝에 1~2글자 지워도 잘 에러 내준다.(498, Invalid Token, -&gt; 401 Invalid Token)</h5>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020415029.png" alt="image-20221011020415029"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020629922.png" alt="image-20221011020629922"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20221011020939299.png" alt="image-20221011020939299"></p>


  </div><a class="u-url" href="/python/algorithm/pycharm/decorator/2022/07/20/python_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%98%EB%8A%94-%EC%88%9C%EC%84%9C.html" hidden></a>
</article>


<script src="https://utteranc.es/client.js"
        repo="is2js/blog_raw"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="blog.chojaeseong.com/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>평범한 한의사 돌범의 엔지니어 도전기</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a href="/feed.xml" target="_blank" title="rss">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/is2js/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/yarotheslav" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/yshmarov/" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
