<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>클린아키텍쳐 01 환경설정과 infra, domain, data_layer | 돌범텤놑</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="클린아키텍쳐 01 환경설정과 infra, domain, data_layer" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="python clean architecture" />
<meta property="og:description" content="python clean architecture" />
<link rel="canonical" href="blog.chojaeseong.com/python/flask/cleanarchitecture/2022/09/01/%ED%81%B4%EB%A6%B0%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90_01_infra_domain_data_layer.html" />
<meta property="og:url" content="blog.chojaeseong.com/python/flask/cleanarchitecture/2022/09/01/%ED%81%B4%EB%A6%B0%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90_01_infra_domain_data_layer.html" />
<meta property="og:site_name" content="돌범텤놑" />
<meta property="og:image" content="blog.chojaeseong.com/images/posts/python.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-01T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2022-09-01T00:00:00-05:00","url":"blog.chojaeseong.com/python/flask/cleanarchitecture/2022/09/01/%ED%81%B4%EB%A6%B0%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90_01_infra_domain_data_layer.html","@type":"BlogPosting","image":"blog.chojaeseong.com/images/posts/python.png","headline":"클린아키텍쳐 01 환경설정과 infra, domain, data_layer","dateModified":"2022-09-01T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"blog.chojaeseong.com/python/flask/cleanarchitecture/2022/09/01/%ED%81%B4%EB%A6%B0%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90_01_infra_domain_data_layer.html"},"description":"python clean architecture","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- 폰트추가를 위한 link태그 삽입 -->
  <!-- 폰트1:  기본 spoqa 웹폰트 -->
  <!-- css에서 * {} 다 뒤집어씀. -->
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSansNeo.css' rel='stylesheet' type='text/css'>
  <!-- 폰트2:  블로그 제목들 sunflower 웹폰트 -->
  <!-- 쥬피터 등 포스트 내부 글자 h1, h2 제목은 sunflower체 도입 -->
  <link href="//fonts.googleapis.com/css?family=Sunflower:300,500,700" rel="stylesheet"> 

  <link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="blog.chojaeseong.com/feed.xml" title="돌범텤놑" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">돌범텤놑</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">클린아키텍쳐 01 환경설정과 infra, domain, data_layer</h1><p class="page-description">python clean architecture</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-09-01T00:00:00-05:00" itemprop="datePublished">
        Sep 1, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      31 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#flask">flask</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#cleanarchitecture">cleanarchitecture</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!-- toc가 먼저 나오므로 h3로 안내하기 -->
    <h3>📜 제목으로 보기</h3>
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#클린-아키텍쳐">클린 아키텍쳐</a>
<ul>
<li class="toc-entry toc-h2"><a href="#1-데이터베이스-및-인프라-계층">1 데이터베이스 및 인프라 계층</a>
<ul>
<li class="toc-entry toc-h3"><a href="#01-환경-세팅pylink-flake8-pre-commit">01 환경 세팅(pylink, flake8, pre-commit)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#pre-commit에서-window-linux-모두-작동하는-requirements-hook만들기">pre-commit에서 window, linux 모두 작동하는 requirements hook만들기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#02-src-infra-폴더-세팅">02 src, infra 폴더 세팅</a></li>
<li class="toc-entry toc-h3"><a href="#03-config설정">03 config설정</a>
<ul>
<li class="toc-entry toc-h4"><a href="#03-1-db_config--db_base-설정sqlalchemy">03-1 db_config + db_base 설정(sqlalchemy)</a></li>
<li class="toc-entry toc-h4"><a href="#03-2-config의-initpy에-같이-import될-모듈들-handlerdb_config-basedb_base-올려놓기">03-2 config의 init.py에 같이 import될 모듈들 handler(db_config), Base(db_base) 올려놓기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#04-entities-설정-및-생성">04 entities 설정 및 생성</a>
<ul>
<li class="toc-entry toc-h4"><a href="#04-1-entity폴더-및-파일-생성">04-1 entity폴더 및 파일 생성</a></li>
<li class="toc-entry toc-h4"><a href="#04-2-각-entity파일별-sqla재료들--선언후-config가-올려놓은-것-중-1개인-base-class-사용하기">04-2 각 entity파일별, sqla재료들 + 선언후 Config가 올려놓은 것 중 1개인 Base class 사용하기</a>
<ul>
<li class="toc-entry toc-h5"><a href="#userspy">users.py</a></li>
<li class="toc-entry toc-h5"><a href="#petspy">pets.py</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#04-3-entities의-initpy에-같이-import될-모듈entity들-올려놓기">04-3 entities의 init.py에 같이 import될 모듈(entity)들 올려놓기</a></li>
<li class="toc-entry toc-h4"><a href="#1m-entity-필드-정리1relationshiporm-mforeignkey">1:M entity 필드 정리(1:relationship(orm), M:ForeignKey)</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#05-python-console에서-config---entities-2개-모듈로-db연결-및-table생성">05 python console에서 config  + entities 2개 모듈로 DB연결 및 table생성</a>
<ul>
<li class="toc-entry toc-h4"><a href="#my-ipython설치하여-console에-자동완성">my) ipython설치하여 console에 자동완성</a></li>
<li class="toc-entry toc-h4"><a href="#from-srcinfraconfig-import-">from src.infra.config import *</a></li>
<li class="toc-entry toc-h4"><a href="#from-srcinfraentities-import--까지하고-base--engine으로-db-생성">from src.infra.entities import * 까지하고 Base + engine으로 DB 생성</a></li>
<li class="toc-entry toc-h4"><a href="#테스트용-sqlitedb파일은-ignore에-등록해주기-후-commit했었다면-cache제거해주기">테스트용 sqlite.db파일은 ignore에 등록해주기 후 commit했었다면 cache제거해주기</a></li>
<li class="toc-entry toc-h4"><a href="#git-기존-commit에-처리-추가-add--후-commit-amend-no-edit">(git) 기존 commit에 처리 추가: add . 후 commit –amend –no-edit</a></li>
<li class="toc-entry toc-h4"><a href="#1m-관계확인">1:M 관계확인</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#06-db연결-후-engine만db생성가능-소유하던--dbconnecthandler를-crud를-위한-session소유-context-manager화">06 (DB연결 후) engine만(DB생성가능) 소유하던  DBConnectHandler를 CRUD를 위한 session소유 context manager화</a>
<ul>
<li class="toc-entry toc-h4"><a href="#참고-testpy로-context-manage가-아니면-직접-close해야하는-번거로움">참고) test.py로 context manage가 아니면 직접 close해야하는 번거로움</a></li>
<li class="toc-entry toc-h4"><a href="#dbconnectionhandler에-enterexit-정의해주기">DBConnectionHandler에 enter/exit 정의해주기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#07-repo-설정-및-fakepyrepo-생성하기">07 repo 설정 및 fake.py(Repo) 생성하기</a></li>
<li class="toc-entry toc-h3"><a href="#08-설정완료된-프로젝트를-push후-작업할-br을-딴-뒤-local원본레포삭제db챙기기-후-특정브랜치만-clone하여-개별작업하기">08 설정완료된 프로젝트를 push후 작업할 br을 딴 뒤, local원본레포삭제(.db챙기기) 후 특정브랜치만 clone하여 개별작업하기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-설정이-끝난-project를-push하고-upstream으로-간주하며-작업branch를-미리-따놓는다">01 설정이 끝난 project를 push하고 upstream으로 간주하며, 작업branch를 미리 따놓는다</a></li>
<li class="toc-entry toc-h4"><a href="#02-br생성된-repo를-pull해서-checkout해서-처리하지말고-pr을-사용하기-위해-원본repo는-남겨두고-남의repo면-fork후-브랜치단위로--b-clone해서-작업후-pr로-끝내기">02 br생성된 repo를 pull해서 checkout해서 처리하지말고, PR을 사용하기 위해, 원본repo는 남겨두고 (남의repo면 fork후) 브랜치단위로 -b clone해서 작업후 PR로 끝내기</a></li>
<li class="toc-entry toc-h4"><a href="#03-clone받고-백업db-넣어준-폴더에-가상환경-생성---requirementstxt-설치---pre-commit-install까지">03 clone받고 백업db 넣어준 폴더에 가상환경 생성 -&gt; requirements.txt 설치 -&gt; pre-commit install까지</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#2-repository와-pytest">2 Repository와 PyTest</a>
<ul>
<li class="toc-entry toc-h3"><a href="#01-user-repository-작성">01 User Repository 작성</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-repository는-config의-handler와-entities의-entity를-기본적으로-import">01 repository는 config의 handler와 entities의 entity를 기본적으로 import</a></li>
<li class="toc-entry toc-h4"><a href="#02--pytest를-위해-user_repository_testpy를-작성한다">02  pytest를 위해, user_repository_test.py를 작성한다.</a></li>
<li class="toc-entry toc-h4"><a href="#03-pytest--faker를-설치하고-_testpy에서-사용한다">03 pytest + faker를 설치하고 _test.py에서 사용한다.</a></li>
<li class="toc-entry toc-h4"><a href="#04-pytest는-터미널에서-돌린다">04 pytest는 터미널에서 돌린다</a>
<ul>
<li class="toc-entry toc-h5"><a href="#pytest의-결과-pytest_cache폴더가-추가되니-gitignore에-폴더를-추가한다">pytest의 결과 .pytest_cache폴더가 추가되니 gitignore에 폴더를 추가한다</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#02-_testpy에서-createinsert-메서드-테스트">02 _test.py에서 CREATE(insert) 메서드 테스트</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-원본메서드-내부에서-확인할-생성-데이터를-namedtuple불변클래스의-객체로-생성해서-반환한다">01 원본메서드 내부에서 확인할 생성 데이터를 namedTuple(불변클래스)의 객체로 생성해서, 반환한다</a></li>
<li class="toc-entry toc-h4"><a href="#02-test메서드에서는-return물을-받아-print한다">02 test메서드에서는 return물을 받아 print한다</a></li>
<li class="toc-entry toc-h4"><a href="#03-pytest에서는--v---s옵션을-가한다">03 pytest에서는 -v + -s옵션을 가한다</a></li>
<li class="toc-entry toc-h4"><a href="#04-namedtuple의-typename을-entity와-동일하게-준-것의-장점을-살려-insert메서드의-return-type-명시-및-docstring도-수정해준다">04 namedTuple의 typename을 entity와 동일하게 준 것의 장점을 살려, insert메서드의 return type 명시 및 docstring도 수정해준다.</a></li>
<li class="toc-entry toc-h4"><a href="#05-handler의-engine---execute-sql-query를-이용해서-생성된-데이터를-print없이-db데이터로-필드끼리-assert로-비교한다">05 handler의 engine -&gt; execute sql query를 이용해서, 생성된 데이터를 print없이 DB데이터로 필드끼리 assert로 비교한다</a></li>
<li class="toc-entry toc-h4"><a href="#생성---sql로-로드---비교-전-db속-데이터는-sql로-삭제까지-해준다">생성 -&gt; sql로 로드 -&gt; 비교 전 db속 데이터는 sql로 삭제까지 해준다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#03-pre-commit-설정에-pytest-추가하기">03 pre-commit 설정에 pytest 추가하기</a></li>
<li class="toc-entry toc-h3"><a href="#04-upstream내꺼라면-remote에-push해서-해당-작업br를-확인한다">04 upstream(내꺼라면 remote)에 push해서 해당 작업br를 확인한다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#3-domain-layer-및-models-use_cases-개발">3 Domain layer 및 models, use_cases 개발</a>
<ul>
<li class="toc-entry toc-h3"><a href="#01-src-domain--models-use_cases-모듈-생성">01 src&gt; domain &gt; models, use_cases 모듈 생성</a></li>
<li class="toc-entry toc-h3"><a href="#02-repository에-있던-namedtupleusers를-domain--modelsuserspy로-옮기고-users-entity는-usersmodel로-취급하기">02 repository에 있던 namedTuple(“Users”)를 domain &gt; models&gt;users.py로 옮기고, Users entity는 UsersModel로 취급하기</a></li>
<li class="toc-entry toc-h3"><a href="#03-select_userselect메서드를-객체가-부르는-static메서드인-classmethod로-정의">03 select_user(SELECT)메서드를 객체가 부르는 static메서드인 @classmethod로 정의</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-select의-결과는-listmodel불변class">01 select의 결과는 List[model(불변class)]</a></li>
<li class="toc-entry toc-h4"><a href="#02-select는-insert와-달리-파라미터의-경우의수---try가-제일-바깥에서-내부if-elif별-진입후에-with-handler">02 select는 insert와 달리 파라미터의 경우의수 -&gt; try가 제일 바깥에서 내부if elif별 진입후에 with handler</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#04-select메서드에-대한-test메서드-작성">04 select메서드에 대한 test메서드 작성</a>
<ul>
<li class="toc-entry toc-h4"><a href="#insertcreate메서드---db조회후-db삭제-와-달리-select는-db삽입생성후----select메서드---db삭제">insert(create메서드 -&gt; db조회후 db삭제 )와 달리, select는 db삽입생성후  -&gt; select메서드 -&gt; db삭제</a></li>
<li class="toc-entry toc-h4"><a href="#데이터를-assert-필드비교를-떠나-entity객체별-비교하기-위해서-entity별-eq메서드-정의하기파라미터를-other로-주고-비교">데이터를 assert 필드비교를 떠나 entity객체별 비교하기 위해서, entity별 eq메서드 정의하기(파라미터를 other로 주고 비교)</a></li>
<li class="toc-entry toc-h4"><a href="#uniquekey칼럼을-가진-경우의수별-조회결과1개라도listentitymodel를-assert-in으로-여러개-다-비교하기">uniquekey칼럼을 가진 경우의수별 조회결과(1개라도List[entityModel])를 assert in으로 여러개 다 비교하기</a></li>
<li class="toc-entry toc-h4"><a href="#commit포맷팅등-후-hook에-의해-취소되었다면-수정된-것을-다시-한번-add-commit">commit(포맷팅등) 후 hook에 의해 취소되었다면, 수정된 것을 다시 한번 add commit</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#05-pr후-동일br에서-다른-작업이-끝났을-때">05 PR후 동일br에서 다른 작업이 끝났을 때</a>
<ul>
<li class="toc-entry toc-h4"><a href="#commit후-push-전-github를-보니-이전-pr이-merge되어있는데도-남아있다면-close-pr해준다">commit후 push 전, github를 보니 이전 PR이 merge되어있는데도 남아있다면, close PR해준다.</a></li>
<li class="toc-entry toc-h4"><a href="#push전-prnew-pull-request를-눌러-들어가서-comparing-changes로-이전pr이-어디까지-작업됬는지-확인한다">push전 PR&gt;New pull request를 눌러 들어가서, Comparing changes로 이전PR이 어디까지 작업됬는지 확인한다</a></li>
<li class="toc-entry toc-h4"><a href="#local의-clone-작업br에서--commit을-push해서한-뒤---직접-new-pr--compare-branch-바꿔서---create-pr해서-새로운-pr을-만든다">local의 [clone 작업br]에서  commit을 push해서한 뒤 -&gt; 직접 New PR &gt; Compare branch 바꿔서 -&gt; Create PR해서 새로운 PR을 만든다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#06-github에서-만든-타-작업br을-가져오되-최신master를-rebase하고-사용하기">06 github에서 만든 타 작업br을 가져오되, 최신master를 rebase하고 사용하기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#br1과-br2를-동시에-만들고-동시에-clone--b했었더라면">br1과 br2를 동시에 만들고 동시에 clone -b했었더라면</a></li>
<li class="toc-entry toc-h4"><a href="#다음작업br만-local-clone--b하고-ignore되었던---상위폴더에-백업해놓았던-sqlite-db파일을-복붙해준다">다음작업br만 local clone -b하고, ignore되었던 -&gt; 상위폴더에 백업해놓았던 sqlite .db파일을 복붙해준다.</a></li>
<li class="toc-entry toc-h4"><a href="#최신업뎃된-master를-두고-다시-작업br로-넘어와-git-rebase-master를-통해-master로부터-최신작업을-가져온다">최신업뎃된 master를 두고, 다시 작업br로 넘어와, git rebase master를 통해 master로부터 최신작업을 가져온다.</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#07-clone한-폴더-new-setting최초">07 clone한 폴더 new setting(최초)</a>
<ul>
<li class="toc-entry toc-h4"><a href="#01-gitignore중에-db파일-있으면-옮겨주기">01 gitignore중에 db파일 있으면 옮겨주기</a></li>
<li class="toc-entry toc-h4"><a href="#02-github에서-따온-빈-새br에-대해-venv를-만들고-활성화하고--vscode를-연다">02 github에서 따온 빈 새br에 대해, venv를 만들고 활성화하고  vscode를 연다</a></li>
<li class="toc-entry toc-h4"><a href="#03-최초-requirementstxt-직접-설치">03 최초 requirements.txt 직접 설치</a></li>
<li class="toc-entry toc-h4"><a href="#04-최초-pre-commit-install-직접-설치">04 최초 pre-commit install 직접 설치</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#08-pet-repository-개발">08 pet repository 개발</a>
<ul>
<li class="toc-entry toc-h4"><a href="#insert_petcreate-메서드">insert_pet(CREATE) 메서드</a>
<ul>
<li class="toc-entry toc-h5"><a href="#pets-entity에-대한-srcdomainmodels에서-petspydto-pets-만들어서-올리기">pets entity에 대한 src&gt;domain&gt;models에서 pets.py(dto Pets) 만들어서 올리기</a></li>
<li class="toc-entry toc-h5"><a href="#pets-entity에-대한-srcinfrarepo에서-pet_repositorypy-에서-create메서드insert_부터-만들기">pets entity에 대한 src&gt;infra&gt;repo에서 pet_repository.py 에서 CREATE메서드(insert_)부터 만들기</a></li>
<li class="toc-entry toc-h5"><a href="#pet-repo-메서드1개-만들때마다-_testpy에-test작성하기">pet repo 메서드1개 만들때마다 _test.py에 test작성하기</a></li>
<li class="toc-entry toc-h5"><a href="#createinsert의-결과비교는-메서드-결과namedtuple-vs-engine쿼리결과lecayrow-tuple-결과은-어쩔수-없이-필드끼리-한다">create(insert)의 결과비교는 메서드 결과(namedTuple) vs engine쿼리결과(LecayRow, tuple) 결과은 어쩔수 없이 필드끼리 한다</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#test_insert_pet">test_insert_pet</a>
<ul>
<li class="toc-entry toc-h5"><a href="#pytest를-경로를-직접-찾아가-1개의-testpy만-걸-수도-있다">pytest를 경로를 직접 찾아가 1개의 test.py만 걸 수도 있다.</a></li>
<li class="toc-entry toc-h5"><a href="#dto-repo의-createinsert메서드의-결과물에서-enum-field를-dto에-담을-때는-value로--담는다">[DTO] repo의 create(insert)메서드의 결과물에서 enum field를 DTO에 담을 때는 .value로  담는다.</a></li>
<li class="toc-entry toc-h5"><a href="#my-dtonamedtuple과-lecacyrow-모두-tuple이라-값비교시-통과-바로-되더라">my) DTO(namedTuple)과 LecacyRow 모두 tuple이라 값비교시 통과 바로 되더라…</a></li>
<li class="toc-entry toc-h5"><a href="#method-test완료후-commit작업을-이어할-것이면-push없이-commit후-바로-진행">method test완료후 commit(작업을 이어할 것이면, push없이 commit후 바로 진행)</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#select_pet-메서드">select_pet 메서드</a>
<ul>
<li class="toc-entry toc-h5"><a href="#조심-fk가-select메서드에-들어간-경우-one이-아니라-all을-쓰며-return-data가-아니라-그냥-return-data">조심! fk가 select메서드에 들어간 경우, .one()이 아니라 .all()을 쓰며, return [data]가 아니라 그냥 return data</a></li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#select_test">select_test</a>
<ul>
<li class="toc-entry toc-h5"><a href="#insertcreate와-다르게-id도-faker로-생성해서-조회한다">insert(CREATE)와 다르게, id도 faker로 생성해서 조회한다.</a></li>
<li class="toc-entry toc-h5"><a href="#insertcreate-test와-다르게-selectread-test는-해당-entity-model-및-enum도-직접필요하다">insert(CREATE) test와 다르게, select(READ) test는 해당 entity Model 및 enum도 직접필요하다.</a>
<ul>
<li class="toc-entry toc-h6"><a href="#insert는-dtotuple-vs-query결과tuple">insert는 dto(tuple) vs query결과(tuple)</a></li>
<li class="toc-entry toc-h6"><a href="#create는-faker---entitymodel-vs--faker-insert-into---select메서드-listdto">create는 faker -&gt; entitymodel vs  faker-&gt;insert into -&gt; select메서드 List[DTO]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h4"><a href="#pre-commit에-의해-한번은-걸리고-수정되니-매번-add하지말고-그냥--am으로-commit해주고-log확인하자">pre-commit에 의해 한번은 걸리고, 수정되니 매번 add하지말고 그냥 -am으로 commit해주고 log확인하자</a></li>
<li class="toc-entry toc-h4"><a href="#test-정리-insert메서드와-select메서드-테스트">[Test] 정리: insert메서드와 select메서드 테스트</a>
<ul>
<li class="toc-entry toc-h5"><a href="#01-insert메서드test_insert_pet">01 insert메서드(test_insert_pet)</a></li>
<li class="toc-entry toc-h5"><a href="#02-select-메서드test_select_pet">02 select 메서드(test_select_pet)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#4-insert-select-메서드들의-interface-제작">4 insert, select 메서드들의 Interface 제작</a>
<ul>
<li class="toc-entry toc-h3"><a href="#01-src-data폴더-및-init-생성--interfaces-폴더-및-init생성">01 src&gt; data폴더 및 init 생성 &gt; interfaces 폴더 및 init생성</a></li>
<li class="toc-entry toc-h3"><a href="#02-각-repositorypy별-repository_interfacepy-만들기">02 각 repository.py별 repository_interface.py 만들기</a>
<ul>
<li class="toc-entry toc-h4"><a href="#user_repository_interfacepy도-pet꺼를-복사해서-바꿔주기">user_repository_interface.py도 Pet꺼를 복사해서 바꿔주기</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#03-initpy에-생성한-interface-올려주기">03 init.py에 생성한 Interface 올려주기</a></li>
<li class="toc-entry toc-h3"><a href="#04-각-infrarepo속-repositorypy들의-class들은-datainterfaces-속repository_interfacepy들을-상속해서-구현해야한다">04 각 infra&gt;repo속&gt; repository.py들의 class들은 data&gt;interfaces 속&gt;repository_interface.py들을 상속해서 구현해야한다.</a></li>
<li class="toc-entry toc-h3"><a href="#05-작업br-완료구현-pytest---커밋-push---github에서-new-pr까지">05 작업br 완료(구현 pytest) -&gt; 커밋 push -&gt; github에서 new PR까지</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#참고">참고</a>
<ul>
<li class="toc-entry toc-h4"><a href="#gitignore">gitignore</a></li>
<li class="toc-entry toc-h4"><a href="#sqlalchemy패키지">sqlalchemy패키지</a></li>
<li class="toc-entry toc-h4"><a href="#clone후-작업-세팅">clone후 작업 세팅</a></li>
<li class="toc-entry toc-h4"><a href="#clone--b-작업테스트완료후--merge까지-정리">clone -b 작업+테스트완료후 ~ merge까지 정리</a></li>
<li class="toc-entry toc-h4"><a href="#vscode-설정">vscode 설정</a></li>
<li class="toc-entry toc-h4"><a href="#test정리">test정리</a></li>
</ul>
</li>
</ul>
</li>
</ul><h1 id="클린-아키텍쳐">
<a class="anchor" href="#%ED%81%B4%EB%A6%B0-%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>클린 아키텍쳐</h1>

<h2 id="1-데이터베이스-및-인프라-계층">
<a class="anchor" href="#1-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EB%B0%8F-%EC%9D%B8%ED%94%84%EB%9D%BC-%EA%B3%84%EC%B8%B5" aria-hidden="true"><span class="octicon octicon-link"></span></a>1 데이터베이스 및 인프라 계층</h2>

<h3 id="01-환경-세팅pylink-flake8-pre-commit">
<a class="anchor" href="#01-%ED%99%98%EA%B2%BD-%EC%84%B8%ED%8C%85pylink-flake8-pre-commit" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 환경 세팅(pylink, flake8, pre-commit)</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">backend-python</code>폴더 생성 &gt; <code class="language-plaintext highlighter-rouge">wt -d .</code>로 터미널 열기 &gt;  <code class="language-plaintext highlighter-rouge">code .</code> vscode열어놓기</p>
  </li>
  <li>
    <p>터미널 폴더경로에서 git, 가상환경 세팅</p>

    <ol>
      <li>
        <p>깃 초기화: <code class="language-plaintext highlighter-rouge">git init</code></p>
      </li>
      <li>
        <p>가상환경 직접 생성:</p>

        <ol>
          <li><code class="language-plaintext highlighter-rouge">pip install virtualenv</code></li>
          <li>
<code class="language-plaintext highlighter-rouge">python -m virtualenv [-p python310] venv</code>
            <ul>
              <li>리눅스: <code class="language-plaintext highlighter-rouge">virtualenv -p python3[10] venv</code>
</li>
            </ul>
          </li>
        </ol>
      </li>
      <li>
        <p>가상환경 터미널 실행</p>

        <ol>
          <li>
<code class="language-plaintext highlighter-rouge">.\venv\Scripts\activate</code> or <code class="language-plaintext highlighter-rouge">. .\venv\Scripts\activate</code>
            <ul>
              <li>리눅스: <code class="language-plaintext highlighter-rouge">. venv/bin/activate</code>
</li>
            </ul>
          </li>
        </ol>
      </li>
      <li>
        <p>vscode에서 생성된 가상환경 select되었는지 확인</p>

        <ol>
          <li>
            <p>F1 &gt; python interpreter &gt; 확인</p>

            <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925023738394.png" alt="image-20220925023738394"></p>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
    <p>pylint 패키지 설치후 .pylintrc세팅</p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">. .\venv\Scripts\activate</code></p>
      </li>
      <li>
        <p>pylint 패키지 설치후 <code class="language-plaintext highlighter-rouge">.pylintrc</code> 파일 생성</p>

        <ol>
          <li>
            <p><code class="language-plaintext highlighter-rouge">pip3 install pylint</code></p>
          </li>
          <li>
            <p><code class="language-plaintext highlighter-rouge">pylint --generate-rcfile &gt; .pylintrc</code></p>
          </li>
          <li>
            <p>pylintrc 파일 수정</p>

            <ol>
              <li>
                <p>docstring 없어도 무시하게 설정해준다.</p>

                <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925024348809.png" alt="image-20220925024348809"></p>
              </li>
              <li>
                <p>max-line-length를 100 -&gt; 120으로 수정해준다.</p>

                <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925024421370.png" alt="image-20220925024421370"></p>
              </li>
              <li>
                <p>min-public-methods 수를 2-&gt;1로 수정해준다.</p>

                <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925024540248.png" alt="image-20220925024540248"></p>
              </li>
            </ol>
          </li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>flake8, black 패키지 설치후 <code class="language-plaintext highlighter-rouge">.flake8</code> 세팅</strong></p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pip3 install black</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pip3 install flake8</code></p>
      </li>
      <li>
        <p><strong>pylint와 달리 <code class="language-plaintext highlighter-rouge">.flake8</code>파일을 vscode에서 생성해준다.</strong></p>

        <ul>
          <li>파일별 ignores를 F401을 걸어줘야한다.</li>
        </ul>

        <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>[flake8]
ignore = E722, W503
max-line-length = 120
per-file-ignores =
	__init__.py: F401
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p><strong>pre-comit 패키지 설치 후  <code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code> 세팅 -&gt; <code class="language-plaintext highlighter-rouge">pre-commit install</code></strong></p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pip3 install pre-commit</code></p>
      </li>
      <li>
        <p><strong>pylint와 달리 .<code class="language-plaintext highlighter-rouge">pre-commit-config.yaml</code>파일을 직접 vscode에서 생성해준다.</strong></p>

        <ul>
          <li>stages가 다 [commit]이다.</li>
          <li>black -&gt; python language version을 수정해준다.</li>
          <li>
<strong>requirements만 repo가 local로서 직접 작동할 내역을 entry에 입력해줘야한다.</strong>
            <ul>
              <li>아래는 기본적으로 linux에서 bash -c로 실행되는 코드다</li>
            </ul>
          </li>
        </ul>

        <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>repos:
-   repo: https://github.com/ambv/black
    rev: stable
    hooks:
    - id: black
      language_version: python3.10
      stages: [commit]
-   repo: https://gitlab.com/pycqa/flake8
    rev: 3.7.9
    hooks:
    - id: flake8
      stages: [commit]
-   repo: local
    hooks:
      - id: requirements
        name: requirements
        entry: bash -c 'venv/bin/pip3 freeze &gt; requirements.txt; git add requirements.txt'
        language: system
        pass_filenames: false
        stages: [commit]
</code></pre></div>        </div>

        <ul>
          <li>추후 아래부분을 pytest관련 설정을 추가할 것이다.</li>
        </ul>

        <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>-   repo: local
    hooks:
    - id: pytest
      name: pytest
      language: system
      entry: pytest -v -s
      always_run: true
      pass_filenames: false
      stages: [commit]
</code></pre></div>        </div>
      </li>
      <li>
        <p><strong><code class="language-plaintext highlighter-rouge">pre-commit install</code>로 <code class="language-plaintext highlighter-rouge">.git/hooks/pre-commit</code> 생성해주기</strong></p>
      </li>
    </ol>
  </li>
  <li>
    <p>test.py로 설치 확인하기</p>

    <ol>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pylint</code>익스텐션 설치</p>
      </li>
      <li>
        <p>test.py 생성후 에러 확인</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">start</span><span class="p">():</span>
      	
	<span class="k">print</span><span class="p">(</span><span class="s">"Ola Muno"</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>doctstring없이 pylint에러 띄우기</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925033200028.png" alt="image-20220925033200028"></p>
      </li>
      <li>
        <p>git status -&gt; git add . -&gt; git commit -m ‘‘를 통해 <strong>pre-commit 작동 확인해보기</strong></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925033924139.png" alt="image-20220925033924139"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925034015944.png" alt="image-20220925034015944"></p>
      </li>
      <li>
        <p>test.py  삭제하고 <code class="language-plaintext highlighter-rouge">git log --oneline</code>로 확인</p>
      </li>
    </ol>
  </li>
  <li>
    <p>vscode에서 <code class="language-plaintext highlighter-rouge">.gitignore</code>생성 후</p>

    <ol>
      <li>
        <p>pycache 무시하기</p>
      </li>
      <li>
        <p>venv폴더 무시하기</p>

        <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>**/__pycache__
venv
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<h4 id="pre-commit에서-window-linux-모두-작동하는-requirements-hook만들기">
<a class="anchor" href="#pre-commit%EC%97%90%EC%84%9C-window-linux-%EB%AA%A8%EB%91%90-%EC%9E%91%EB%8F%99%ED%95%98%EB%8A%94-requirements-hook%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>pre-commit에서 window, linux 모두 작동하는 requirements hook만들기</h4>

<ol>
  <li>
    <p>각각의 <code class="language-plaintext highlighter-rouge">entry</code>명령어를 입력해주면, 1개의 운영체제에서 밖에 사용안된다.</p>

    <ul>
      <li>
        <p><strong>linux의 bash -c 로 작동시키기</strong></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="n">repo</span><span class="p">:</span> <span class="n">local</span>
    <span class="n">hooks</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="n">requirements</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">requirements</span>
        <span class="n">entry</span><span class="p">:</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s">'venv/bin/pip3 freeze &gt; requirements.txt; git add requirements.txt'</span>
        <span class="c1"># entry: powershell -command '.\venv\Scripts\pip3 freeze &gt; .\requirements.txt; git add requirements.txt'
</span>        <span class="c1">#entry: ./.pre-commit-scripts/requirements.py
</span>        <span class="n">language</span><span class="p">:</span> <span class="n">system</span>
        <span class="n">pass_filenames</span><span class="p">:</span> <span class="n">false</span>
        <span class="n">stages</span><span class="p">:</span> <span class="p">[</span><span class="n">commit</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p><strong>windows의 powershell -comand로 작동시키기</strong></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">-</span>   <span class="n">repo</span><span class="p">:</span> <span class="n">local</span>
    <span class="n">hooks</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">id</span><span class="p">:</span> <span class="n">requirements</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">requirements</span>
        <span class="c1"># entry: bash -c 'venv/bin/pip3 freeze &gt; requirements.txt; git add requirements.txt'
</span>        <span class="n">entry</span><span class="p">:</span> <span class="n">powershell</span> <span class="o">-</span><span class="n">command</span> <span class="s">'.</span><span class="se">\v</span><span class="s">env\Scripts\pip3 freeze &gt; .</span><span class="se">\r</span><span class="s">equirements.txt; git add requirements.txt'</span>
        <span class="c1"># entry: ./.pre-commit-scripts/requirements.py
</span>        <span class="n">language</span><span class="p">:</span> <span class="n">system</span>
        <span class="n">pass_filenames</span><span class="p">:</span> <span class="n">false</span>
        <span class="n">stages</span><span class="p">:</span> <span class="p">[</span><span class="n">commit</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>python script를 만들어, 운영체제마다(sys.platform) 커맨드 명령어 실행(subprocess.call)시키기</strong></p>

    <ul>
      <li>이 때, 명령어를 ` &gt; requirements.txt`까지 다 입력하면, 윈도우에서 경로를 못찾는 문제가 발생한다
        <ul>
          <li><strong>with open() 을 사용해서 <code class="language-plaintext highlighter-rouge">requirements.txt</code>를 <code class="language-plaintext highlighter-rouge">w</code>모드로 열어놓고 덮어쓴다</strong></li>
        </ul>
      </li>
    </ul>

    <ol>
      <li>
        <p>root에 <code class="language-plaintext highlighter-rouge">.pre-commit-scripts</code>폴더를 만들고 <code class="language-plaintext highlighter-rouge">requirements.py</code>를 작성한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927003959890.png" alt="image-20220927003959890"></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>      
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>  <span class="c1"># nosec
</span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">platform</span>
      
      
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s">"./requirements.txt"</span>
      
    <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s">"win32"</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">call</span><span class="p">([</span><span class="s">"./venv/Scripts/pip3"</span><span class="p">,</span> <span class="s">"freeze"</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">file_</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file_</span><span class="p">:</span>
            <span class="n">call</span><span class="p">([</span><span class="s">"./venv/bin/pip3"</span><span class="p">,</span> <span class="s">"freeze"</span><span class="p">],</span> <span class="n">stdout</span><span class="o">=</span><span class="n">file_</span><span class="p">)</span>
    <span class="n">call</span><span class="p">(</span><span class="s">f"git add </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>  <span class="c1"># nosec
</span>      
      
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="nb">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code>의 hook entry에서 해당 py 스크립트 파일을 걸어준다.</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="pi">-</span>   <span class="na">repo</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">hooks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">requirements</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">requirements</span>
        <span class="c1"># entry: bash -c 'venv/bin/pip3 freeze &gt; requirements.txt; git add requirements.txt'</span>
        <span class="c1"># entry: powershell -command '.\venv\Scripts\pip3 freeze &gt; .\requirements.txt; git add requirements.txt'</span>
        <span class="na">entry</span><span class="pi">:</span> <span class="s">./.pre-commit-scripts/requirements.py</span>
        <span class="na">language</span><span class="pi">:</span> <span class="s">system</span>
        <span class="na">pass_filenames</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">stages</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">commit</span><span class="pi">]</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p>다른 방법으로 pip-tools를 설치하고, 내부에서 call 시 pip-complie을 이용하는 방법도 있다.</p>

    <ul>
      <li>
        <p><a href="https://github.com/jazzband/pip-tools/">깃허브</a></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pip3 install pip-tools</code> 설치</p>
      </li>
      <li>
        <p>python310이면, pip-tools버전(6.8.0)을 잘 맞춰야한다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927004806256.png" alt="image-20220927004806256"></p>
      </li>
      <li>
        <p>yaml</p>

        <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="pi">-</span>   <span class="na">repo</span><span class="pi">:</span> <span class="s">https://github.com/jazzband/pip-tools</span>
    <span class="na">rev</span><span class="pi">:</span> <span class="s">6.8.0</span>
    <span class="na">hooks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">pip-compile</span>
      <span class="na">entry</span><span class="pi">:</span> <span class="s">./.pre-commit-scripts/pip-compile.py</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>pip-compile.py</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>     
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>  <span class="c1"># nosec
</span><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">platform</span>
     
     
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">platform</span> <span class="o">==</span> <span class="s">"win32"</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">r"pip-compile.exe"</span><span class="p">,</span> <span class="s">"--output-file"</span><span class="p">,</span> <span class="s">"requirements.win.txt"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s">"pip-compile"</span><span class="p">,)</span>
    <span class="k">return</span> <span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>  <span class="c1"># nosec
</span>     
     
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="nb">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h3 id="02-src-infra-폴더-세팅">
<a class="anchor" href="#02-src-infra-%ED%8F%B4%EB%8D%94-%EC%84%B8%ED%8C%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 src, infra 폴더 세팅</h3>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">src</code>폴더 -&gt; import용 모듈라이져를 위한  <code class="language-plaintext highlighter-rouge">init.py</code> 생성
    <ol>
      <li>
<code class="language-plaintext highlighter-rouge">infra</code>폴더 -&gt; <code class="language-plaintext highlighter-rouge">init.py</code>생성
        <ol>
          <li>
<code class="language-plaintext highlighter-rouge">config</code>폴더 생성 &gt; <code class="language-plaintext highlighter-rouge">init.py</code>생성</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925182202353.png" alt="image-20220925182202353"></p>

<h3 id="03-config설정">
<a class="anchor" href="#03-config%EC%84%A4%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 config설정</h3>

<h4 id="03-1-db_config--db_base-설정sqlalchemy">
<a class="anchor" href="#03-1-db_config--db_base-%EC%84%A4%EC%A0%95sqlalchemy" aria-hidden="true"><span class="octicon octicon-link"></span></a>03-1 db_config + db_base 설정(sqlalchemy)</h4>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pip3 install sqlalchemy</code></p>
  </li>
  <li>
    <p>src &gt; infra &gt; config &gt; <code class="language-plaintext highlighter-rouge">db_config.py</code></p>

    <ol>
      <li>
        <p>아래 그림과 같은 생성자(필드들)와 메서드를 만든다.</p>

        <ul>
          <li>engine용 url의 string 상수 필드와</li>
          <li>객체별 sesion을 보유할 필드를 None으로초기화</li>
        </ul>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925182238123.png" alt="image-20220925182238123"></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DBConnectionHandler</span><span class="p">:</span>
	<span class="s">"""Sqlalchemy database connection"""</span>
      
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">__connection_string</span> <span class="o">=</span> <span class="s">'sqlite://storage.db'</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>sqlalchemy의 create_engine메서드로, URL을 이용해서, db에 connection하여 engine을 생성하여 반환받는 메서드를 <code class="language-plaintext highlighter-rouge">get_engine</code>을 정의함</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
      
<span class="k">class</span> <span class="nc">DBConnectionHandler</span><span class="p">:</span>
	<span class="s">"""Sqlalchemy database connection"""</span>
      
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">__connection_string</span> <span class="o">=</span> <span class="s">'sqlite:///storage.db'</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="bp">None</span>
      
	<span class="k">def</span> <span class="nf">get_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="s">"""Return Connection Engine
		:param - None
		:return - engine connection to Database
		"""</span>
		<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__connection_string</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">engine</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p>src &gt; infra &gt; config &gt; <code class="language-plaintext highlighter-rouge">db_base.py</code></p>

    <ol>
      <li>
        <p>sqlalchemy의 <strong>entity class별 상속할</strong> Base class를 반환해주는 파일이다.</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
      
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<h4 id="03-2-config의-initpy에-같이-import될-모듈들-handlerdb_config-basedb_base-올려놓기">
<a class="anchor" href="#03-2-config%EC%9D%98-initpy%EC%97%90-%EA%B0%99%EC%9D%B4-import%EB%90%A0-%EB%AA%A8%EB%93%88%EB%93%A4-handlerdb_config-basedb_base-%EC%98%AC%EB%A0%A4%EB%86%93%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>03-2 config의 init.py에 같이 import될 모듈들 handler(db_config), Base(db_base) 올려놓기</h4>

<ul>
  <li>내 폴더안에서 잇는 모듈들은 <code class="language-plaintext highlighter-rouge">from .모듈명 import 사용할 class</code>로 init에 import해놓을 수 있다.
    <ul>
      <li><strong>init에 내하위모듈들을 import해놓으면 -&gt; <code class="language-plaintext highlighter-rouge">외부에서 내 폴더 import시 다 같이 올라가는 효과</code>다</strong></li>
    </ul>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.db_base</span> <span class="kn">import</span> <span class="n">Base</span>
<span class="kn">from</span> <span class="nn">.db_config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
</code></pre></div></div>

<h3 id="04-entities-설정-및-생성">
<a class="anchor" href="#04-entities-%EC%84%A4%EC%A0%95-%EB%B0%8F-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 entities 설정 및 생성</h3>

<h4 id="04-1-entity폴더-및-파일-생성">
<a class="anchor" href="#04-1-entity%ED%8F%B4%EB%8D%94-%EB%B0%8F-%ED%8C%8C%EC%9D%BC-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>04-1 entity폴더 및 파일 생성</h4>

<ol>
  <li>
    <p>src &gt; infra &gt; <code class="language-plaintext highlighter-rouge">entities</code> 폴더 및 <code class="language-plaintext highlighter-rouge">init.py</code>를 만든다.</p>
  </li>
  <li>
    <p><strong>entity digram을 보고 <code class="language-plaintext highlighter-rouge">소문자and복수 users.py / pets.py</code> 등 entity별로 py파일을 만든다.</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925183730003.png" alt="image-20220925183730003"></p>
  </li>
</ol>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220925183149480.png" alt="image-20220925183149480"></p>

<h4 id="04-2-각-entity파일별-sqla재료들--선언후-config가-올려놓은-것-중-1개인-base-class-사용하기">
<a class="anchor" href="#04-2-%EA%B0%81-entity%ED%8C%8C%EC%9D%BC%EB%B3%84-sqla%EC%9E%AC%EB%A3%8C%EB%93%A4--%EC%84%A0%EC%96%B8%ED%9B%84-config%EA%B0%80-%EC%98%AC%EB%A0%A4%EB%86%93%EC%9D%80-%EA%B2%83-%EC%A4%91-1%EA%B0%9C%EC%9D%B8-base-class-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>04-2 각 entity파일별, sqla재료들 + 선언후 Config가 올려놓은 것 중 1개인 Base class 사용하기</h4>

<h5 id="userspy">
<a class="anchor" href="#userspy" aria-hidden="true"><span class="octicon octicon-link"></span></a>users.py</h5>

<ol>
  <li>
    <p>users.py에서 entity구성에 필요한 재료들과 <strong>config 속 Base class를 import</strong>한다</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Integer</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">Base</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>users.py</p>

    <ul>
      <li>
        <p><strong>entity class를 Base를 상속받아서 작성한다</strong></p>
      </li>
      <li>
<strong>fk관계가 필요하면 <code class="language-plaintext highlighter-rouge">sqlalchemy.orm</code>패키지에서 <code class="language-plaintext highlighter-rouge">relationshiop</code>을 재료로 가져온다</strong>
        <ul>
          <li>relationship관계의 테이블은 <code class="language-plaintext highlighter-rouge">"대문자복수 클래스명"</code>으로 줘야한다.</li>
          <li><strong>1:m관계에서는 1에서 relationship만 명시해주고, <code class="language-plaintext highlighter-rouge">M에서 ForeignKey재료를 사용</code>해서 필드로 소유하게 한다</strong></li>
        </ul>
      </li>
      <li>tablename은 소문자 복수로 적자</li>
      <li>repr는 unique필드로 1개로만 나타내주자</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#..
</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span>
<span class="c1">#..
</span>   
<span class="k">class</span> <span class="nc">Users</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
	<span class="s">"""Users Entity"""</span>
   
	<span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"users"</span>
   
	<span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">id_pet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s">"Pets"</span><span class="p">)</span>
   
	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">f"User [name=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">]"</span>
</code></pre></div>    </div>
  </li>
</ol>

<h5 id="petspy">
<a class="anchor" href="#petspy" aria-hidden="true"><span class="octicon octicon-link"></span></a>pets.py</h5>

<ol>
  <li>
    <p>erd에 type이 적혀있으면 <code class="language-plaintext highlighter-rouge">import enum</code>후 enum.Enum을 상속한 class를 생성후 string 변수를 할당해주면 된다.</p>
  </li>
  <li>
    <p>M관계의 entity로서 <code class="language-plaintext highlighter-rouge">ForeignKey</code>재료가 추가 및 enum타입사용하려면 <code class="language-plaintext highlighter-rouge">Enum</code>재료도 추가된다.</p>

    <ul>
      <li>Column(Enum( 이넘상속정의한Class명), … )</li>
      <li>ForeignKey(“<code class="language-plaintext highlighter-rouge">소문자테이블명.id필드명</code>“)으로 넣어준다.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">enum</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">Base</span>
   
<span class="k">class</span> <span class="nc">AnimalTypes</span><span class="p">(</span><span class="n">enum</span><span class="p">.</span><span class="n">Enum</span><span class="p">):</span>
	<span class="s">"""defining Anymals Types"""</span>
	<span class="n">dog</span> <span class="o">=</span> <span class="s">'dog'</span>
	<span class="n">cat</span> <span class="o">=</span> <span class="s">'cat'</span>
	<span class="n">fish</span> <span class="o">=</span> <span class="s">'fish'</span>
	<span class="n">turtle</span> <span class="o">=</span> <span class="s">'turtle'</span>
   
   
<span class="k">class</span> <span class="nc">Pets</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
	<span class="s">"""Pets Entity"""</span>
   
	<span class="n">__tablename__</span> <span class="o">=</span> <span class="s">'pets'</span>
   
	<span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
	<span class="n">specie</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Enum</span><span class="p">(</span><span class="n">AnimalTypes</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
	<span class="n">age</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
	<span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">"users.id"</span><span class="p">))</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>repr는 unique필드 외에, Enum필드(나를 묶어주는 상위개념) 및 <strong>fk까지</strong> 찍히도록 해준다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>	<span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">f"Pets: [name=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, specie=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">specie</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, user_id=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">user_id</span><span class="si">}</span><span class="s">]"</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="04-3-entities의-initpy에-같이-import될-모듈entity들-올려놓기">
<a class="anchor" href="#04-3-entities%EC%9D%98-initpy%EC%97%90-%EA%B0%99%EC%9D%B4-import%EB%90%A0-%EB%AA%A8%EB%93%88entity%EB%93%A4-%EC%98%AC%EB%A0%A4%EB%86%93%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>04-3 entities의 init.py에 같이 import될 모듈(entity)들 올려놓기</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.pets</span> <span class="kn">import</span> <span class="n">Pets</span>
<span class="kn">from</span> <span class="nn">.users</span> <span class="kn">import</span> <span class="n">Users</span>
</code></pre></div></div>

<h4 id="1m-entity-필드-정리1relationshiporm-mforeignkey">
<a class="anchor" href="#1m-entity-%ED%95%84%EB%93%9C-%EC%A0%95%EB%A6%AC1relationshiporm-mforeignkey" aria-hidden="true"><span class="octicon octicon-link"></span></a>1:M entity 필드 정리(1:relationship(orm), M:ForeignKey)</h4>

<ol>
  <li>one table은 <code class="language-plaintext highlighter-rouge">sqlalchemy.orm</code>의 <code class="language-plaintext highlighter-rouge">relationship("대문자Class명")</code>으로 연결을 유지하고</li>
  <li>many table은 <code class="language-plaintext highlighter-rouge">sqlalchemy</code>의 <code class="language-plaintext highlighter-rouge">ForeignKey("소문자테이블명.id필드명")</code>으로 실제필드값을 유지한다.</li>
</ol>

<h3 id="05-python-console에서-config---entities-2개-모듈로-db연결-및-table생성">
<a class="anchor" href="#05-python-console%EC%97%90%EC%84%9C-config---entities-2%EA%B0%9C-%EB%AA%A8%EB%93%88%EB%A1%9C-db%EC%97%B0%EA%B2%B0-%EB%B0%8F-table%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>05 python console에서 config  + entities 2개 모듈로 DB연결 및 table생성</h3>

<h4 id="my-ipython설치하여-console에-자동완성">
<a class="anchor" href="#my-ipython%EC%84%A4%EC%B9%98%ED%95%98%EC%97%AC-console%EC%97%90-%EC%9E%90%EB%8F%99%EC%99%84%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>my) ipython설치하여 console에 자동완성</h4>

<p><code class="language-plaintext highlighter-rouge">pip3 install ipython</code></p>

<h4 id="from-srcinfraconfig-import-">
<a class="anchor" href="#from-srcinfraconfig-import-" aria-hidden="true"><span class="octicon octicon-link"></span></a>from src.infra.config import *</h4>

<ol>
  <li>
    <p>vscode terminal에서 <code class="language-plaintext highlighter-rouge">python</code>로 <strong>python console에 진입</strong>한다.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">from src.infra.config import *</code>를 통해 <strong>init에 올려둔 모듈들 모두 사용</strong>할 수 있게 한다.</p>

    <ul>
      <li>import해서 사용하는 순간 각 모듈들 마다 <code class="language-plaintext highlighter-rouge">__pycache__</code>들이 생기고 .gitignore에서  <code class="language-plaintext highlighter-rouge">**/__pycache/</code>로 처리했다</li>
    </ul>
  </li>
  <li>
    <p><strong>DBConnectionHandler클래스의 객체()를 db_conn으로 받아서, get_engine()메서드를 호출하여<code class="language-plaintext highlighter-rouge">engine객체</code>를 반환받자</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="o">*</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">db_conn</span> <span class="o">=</span> <span class="n">DBConnectionHandler</span><span class="p">()</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">db_conn</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
       
<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">engine</span>
       
<span class="n">Out</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">Engine</span><span class="p">(</span><span class="n">sqlite</span><span class="p">:</span><span class="o">///</span><span class="n">storage</span><span class="p">.</span><span class="n">db</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Base클래스의 <code class="language-plaintext highlighter-rouge">.metadata.create_all( engine )</code>으로 db를 생성하자</strong></p>

    <ul>
      <li>engine생성시 (DBConnectionHandler의 상수필드 -&gt; create_engine시 인자) 명시된 db URL 주소에 db를 생성한다.</li>
      <li>sqlite는
        <ul>
          <li>
<code class="language-plaintext highlighter-rouge">://</code> or <code class="language-plaintext highlighter-rouge">:///:memory:</code>-&gt; 메모리</li>
          <li>
<code class="language-plaintext highlighter-rouge">:///</code>  상대주소</li>
          <li>
<code class="language-plaintext highlighter-rouge">:////</code> 절대주소</li>
        </ul>
      </li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">Base</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926032016262.png" alt="image-20220926032016262"></p>
  </li>
  <li>
    <p><strong>이대로 DBeaver에서 열어보면 entity들이 없다</strong></p>
  </li>
</ol>

<ul>
  <li><strong>Base를 상속하고 있는 entity들을 import 안했기 때문에, metadata가 없다.</strong></li>
</ul>

<ol>
  <li>해당 잘못만들어진 db를 삭제해주자.</li>
</ol>

<h4 id="from-srcinfraentities-import--까지하고-base--engine으로-db-생성">
<a class="anchor" href="#from-srcinfraentities-import--%EA%B9%8C%EC%A7%80%ED%95%98%EA%B3%A0-base--engine%EC%9C%BC%EB%A1%9C-db-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>from src.infra.entities import * 까지하고 Base + engine으로 DB 생성</h4>

<ol>
  <li>
    <p>python console에서 config모듈들을(Base, ConnectionHandler)를 import하고</p>
  </li>
  <li>
    <p><strong>entity모듈들도 import 한다</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="o">*</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="o">*</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">db_conn</span> <span class="o">=</span> <span class="n">DBConnectionHandler</span><span class="p">()</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">engine</span> <span class="o">=</span> <span class="n">db_conn</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">Base</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926033048846.png" alt="image-20220926033048846"></p>
  </li>
</ol>

<h4 id="테스트용-sqlitedb파일은-ignore에-등록해주기-후-commit했었다면-cache제거해주기">
<a class="anchor" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%9A%A9-sqlitedb%ED%8C%8C%EC%9D%BC%EC%9D%80-ignore%EC%97%90-%EB%93%B1%EB%A1%9D%ED%95%B4%EC%A3%BC%EA%B8%B0-%ED%9B%84-commit%ED%96%88%EC%97%88%EB%8B%A4%EB%A9%B4-cache%EC%A0%9C%EA%B1%B0%ED%95%B4%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>테스트용 sqlite.db파일은 ignore에 등록해주기 후 commit했었다면 cache제거해주기</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**/__pycache__
venv
storage.db
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rm storage.db --cached
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927010956644.png" alt="image-20220927010956644"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927011003749.png" alt="image-20220927011003749"></p>

<h4 id="git-기존-commit에-처리-추가-add--후-commit-amend-no-edit">
<a class="anchor" href="#git-%EA%B8%B0%EC%A1%B4-commit%EC%97%90-%EC%B2%98%EB%A6%AC-%EC%B6%94%EA%B0%80-add--%ED%9B%84-commit-amend-no-edit" aria-hidden="true"><span class="octicon octicon-link"></span></a>(git) 기존 commit에 처리 추가: add . 후 commit –amend –no-edit</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add .
git commit --amend --no-edit
</code></pre></div></div>

<h4 id="1m-관계확인">
<a class="anchor" href="#1m-%EA%B4%80%EA%B3%84%ED%99%95%EC%9D%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>1:M 관계확인</h4>

<ol>
  <li>
    <p>1에 해당하는 Users는 <code class="language-plaintext highlighter-rouge">.orm패키지의 relationship</code>만 가져 <strong>컬럼 및 외부키가 없다</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926033303675.png" alt="image-20220926033303675"></p>

    <ul>
      <li>
        <p>대신 참조당하므로 <code class="language-plaintext highlighter-rouge">참조</code>만  있다.</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926033328113.png" alt="image-20220926033328113"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926033349552.png" alt="image-20220926033349552"></p>
      </li>
    </ul>
  </li>
  <li>
    <p>M에 해당하는 Pets는 <strong>user_id칼럼</strong>을 필드로 가지고 있으며, 외부키에 나타난다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926033435107.png" alt="image-20220926033435107"></p>
  </li>
</ol>

<h3 id="06-db연결-후-engine만db생성가능-소유하던--dbconnecthandler를-crud를-위한-session소유-context-manager화">
<a class="anchor" href="#06-db%EC%97%B0%EA%B2%B0-%ED%9B%84-engine%EB%A7%8Cdb%EC%83%9D%EC%84%B1%EA%B0%80%EB%8A%A5-%EC%86%8C%EC%9C%A0%ED%95%98%EB%8D%98--dbconnecthandler%EB%A5%BC-crud%EB%A5%BC-%EC%9C%84%ED%95%9C-session%EC%86%8C%EC%9C%A0-context-manager%ED%99%94" aria-hidden="true"><span class="octicon octicon-link"></span></a>06 (DB연결 후) engine만(DB생성가능) 소유하던  DBConnectHandler를 CRUD를 위한 session소유 context manager화</h3>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926170449260.png" alt="image-20220926170449260"></p>

<ul>
  <li>
<a href="https://github.com/is2js/CleanCode/blob/master/cleancode/03_01_enter_exit_%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8%EA%B4%80%EB%A6%AC%EC%9E%90%EC%99%80_withas_%EB%8D%B0%EC%BD%94%EB%A0%88%EC%9D%B4%ED%84%B0/With_as%EC%97%90_%EC%82%AC%EC%9A%A9%EB%90%98%EB%8A%94_%ED%81%B4%EB%9E%98%EC%8A%A4%EC%99%80_%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8_%EA%B4%80%EB%A6%AC%EC%9E%90.py">참고 내 깃허브 CleanCode</a>
    <ul>
      <li>
<strong>DBConnector  or DBConnectionHandler</strong>는 섹션을 실행동안만 유지되게 하기 위해서 <code class="language-plaintext highlighter-rouge">enter/exit를 정의한 context manager</code>를 만들어야한다.</li>
    </ul>
  </li>
</ul>

<h4 id="참고-testpy로-context-manage가-아니면-직접-close해야하는-번거로움">
<a class="anchor" href="#%EC%B0%B8%EA%B3%A0-testpy%EB%A1%9C-context-manage%EA%B0%80-%EC%95%84%EB%8B%88%EB%A9%B4-%EC%A7%81%EC%A0%91-close%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94-%EB%B2%88%EA%B1%B0%EB%A1%9C%EC%9B%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>참고) test.py로 context manage가 아니면 직접 close해야하는 번거로움</h4>

<ol>
  <li>
    <p>file.txt와 test.py 생성후 open()으로 파일을  열도록 하고 file변수.readline()으로 txt를 읽는 코드를 짠다.</p>

    <ul>
      <li>with as를 안쓰고, open만하면,  rw동시에 안되서, 파일을 w하고 r mode로는 열기만</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">())</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>terminal에서 <code class="language-plaintext highlighter-rouge">python test.py</code></p>
  </li>
  <li>
    <p><strong>만약, open된 file을 close안하고, 또다시 아래에서 with as로 열면.. 2번 열리게 된다(close 자동안됨)</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">())</span>
   
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'file.txt'</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
	<span class="k">print</span><span class="p">(</span><span class="nb">file</span><span class="p">.</span><span class="n">readline</span><span class="p">())</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="dbconnectionhandler에-enterexit-정의해주기">
<a class="anchor" href="#dbconnectionhandler%EC%97%90-enterexit-%EC%A0%95%EC%9D%98%ED%95%B4%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>DBConnectionHandler에 enter/exit 정의해주기</h4>

<ol>
  <li>
    <p>enter: 파라미터는 없으며 <strong>유지될 engine객체 생성 + .orm패키지의 sessionmaker객체 생성 -&gt; 2개를 연결해서 Handler의 self.session필드에 유지하게 하고, return self를 반환해야한다.</strong></p>
  </li>
  <li>
    <p>exit: 필수파라미터 3개가 있으며, <strong>context(session_maker(bind=engine)객체)를 close해주면 된다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#...
</span><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
   
<span class="k">class</span> <span class="nc">DBConnectionHandler</span><span class="p">:</span>
	<span class="c1">#...
</span>	<span class="k">def</span> <span class="nf">get_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="s">"""Return Connection Engine
		:param - None
		:return - engine connection to Database
		"""</span>
		<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">__connection_string</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">engine</span>
   
	<span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="n">engine</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
		<span class="n">session_maker</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">()</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session_maker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
		<span class="k">return</span> <span class="bp">self</span>
   
	<span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
		<span class="bp">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># pylint: disable=no-memebr
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>engine과 bind된 session객체 by session_maker를 가지고 있으면 <code class="language-plaintext highlighter-rouge">CRUD에 직접적으로 사용</code>된다.</strong></p>

    <ul>
      <li>handler 객체 -&gt; session필드 -&gt; .CRUD메서드()
        <ul>
          <li><code class="language-plaintext highlighter-rouge">with DBConnection() as db_connection -&gt; db_connection.session.add()</code></li>
        </ul>
      </li>
    </ul>
  </li>
</ol>

<h3 id="07-repo-설정-및-fakepyrepo-생성하기">
<a class="anchor" href="#07-repo-%EC%84%A4%EC%A0%95-%EB%B0%8F-fakepyrepo-%EC%83%9D%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>07 repo 설정 및 fake.py(Repo) 생성하기</h3>

<ol>
  <li>
    <p>src &gt; infra&gt; 아래에 repo폴더 및 init.py를 생성한다</p>
  </li>
  <li>
    <p>entity별 repo class를 만들어야하는데,<code class="language-plaintext highlighter-rouge">fake.py</code>를 일단 만든다.</p>

    <ul>
      <li>config(db_base, db_config:handler)를 통째로 import할 일은, console에서 entities와 함께 DB생성 변경 할 때만이다.</li>
    </ul>
  </li>
  <li>
    <p><strong>Repo class는 상속없이 + CRUD메서드를 @classmehod로 정의한다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FakeRepo</span><span class="p">:</span>
	<span class="s">"""A simple Repository"""</span>
   	
	<span class="o">@</span><span class="nb">classmethod</span>
	<span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
		<span class="s">"""something"""</span>
   
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Repo class의 CRUD메서드를 정의하기 위해서는 <code class="language-plaintext highlighter-rouge">DBConnectionHandler  및  해당 entity Class</code>가 필요하다</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Users</span>
   
<span class="k">class</span> <span class="nc">FakeRepo</span><span class="p">:</span>
    <span class="c1"># ...
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>insert(CREATE) 메서드의 경우를 예를 들어 작성한다.</strong></p>

    <ol>
      <li>context manager가 된 handler를 with as 로 연다 -&gt; <strong>해당 구문이 끝나면 session이 자동 close</strong>
</li>
      <li>session을 통한 CRUD를 <strong>try 작업+commit  excetp rollback+raise finally session.close()형태로 작성한다</strong>
        <ul>
          <li>finally는 작성안해도, handler를 통한 connection객체는  with구문이 끝나면 알아서 close될것 같은데..</li>
        </ul>
      </li>
    </ol>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># pylint: disable=E1101
</span>   
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Users</span>
   
<span class="k">class</span> <span class="nc">FakeRepo</span><span class="p">:</span>
	<span class="s">"""A simple Repository"""</span>
   	
	<span class="o">@</span><span class="nb">classmethod</span>
	<span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
		<span class="s">"""some thing"""</span>
   
		<span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">new_user</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
				<span class="k">raise</span>
			<span class="k">finally</span><span class="p">:</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
   
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>작성된 Repo class .py (fake.py)를 init에 올려두고 사용할 준비를 한다.</strong></p>

    <ul>
      <li>Repo를 통한CRUD에 필요한 것은 이미 해당 repo파일에 <strong>handler + entity</strong>가import되어있다</li>
    </ul>
  </li>
  <li>
    <p><strong>python콘솔로 들어가, <code class="language-plaintext highlighter-rouge">from src.infra.repo import *</code>을 통해, Repo를 올려놓고</strong></p>

    <ul>
      <li>해당repo객체를 만들고 crud메서드를 작동시켜본다.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">src.infra.repo</span> <span class="kn">import</span> <span class="o">*</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">FakeRepo</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">src</span><span class="p">.</span><span class="n">infra</span><span class="p">.</span><span class="n">repo</span><span class="p">.</span><span class="n">fake</span><span class="p">.</span><span class="n">FakeRepo</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">fake_repo</span> <span class="o">=</span> <span class="n">FakeRepo</span><span class="p">()</span>
   
<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">fake_repo</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="s">'cho'</span><span class="p">,</span> <span class="s">'1234'</span><span class="p">)</span>
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220926181531486.png" alt="image-20220926181531486"></p>
  </li>
</ol>

<h3 id="08-설정완료된-프로젝트를-push후-작업할-br을-딴-뒤-local원본레포삭제db챙기기-후-특정브랜치만-clone하여-개별작업하기">
<a class="anchor" href="#08-%EC%84%A4%EC%A0%95%EC%99%84%EB%A3%8C%EB%90%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-push%ED%9B%84-%EC%9E%91%EC%97%85%ED%95%A0-br%EC%9D%84-%EB%94%B4-%EB%92%A4-local%EC%9B%90%EB%B3%B8%EB%A0%88%ED%8F%AC%EC%82%AD%EC%A0%9Cdb%EC%B1%99%EA%B8%B0%EA%B8%B0-%ED%9B%84-%ED%8A%B9%EC%A0%95%EB%B8%8C%EB%9E%9C%EC%B9%98%EB%A7%8C-clone%ED%95%98%EC%97%AC-%EA%B0%9C%EB%B3%84%EC%9E%91%EC%97%85%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>08 설정완료된 프로젝트를 push후 작업할 br을 딴 뒤, local원본레포삭제(.db챙기기) 후 특정브랜치만 clone하여 개별작업하기</h3>

<h4 id="01-설정이-끝난-project를-push하고-upstream으로-간주하며-작업branch를-미리-따놓는다">
<a class="anchor" href="#01-%EC%84%A4%EC%A0%95%EC%9D%B4-%EB%81%9D%EB%82%9C-project%EB%A5%BC-push%ED%95%98%EA%B3%A0-upstream%EC%9C%BC%EB%A1%9C-%EA%B0%84%EC%A3%BC%ED%95%98%EB%A9%B0-%EC%9E%91%EC%97%85branch%EB%A5%BC-%EB%AF%B8%EB%A6%AC-%EB%94%B0%EB%86%93%EB%8A%94%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 설정이 끝난 project를 push하고 upstream으로 간주하며, 작업branch를 미리 따놓는다</h4>

<ol>
  <li>
    <p>github에 push해놓고 <strong><code class="language-plaintext highlighter-rouge">feat/xxx_repository</code>형태로 언더라인으로 repository별 작업하도록 한다</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">feat/user_repository</code>따기</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927012434633.png" alt="image-20220927012434633"></p>
      </li>
      <li>
        <p>바로 이어서 user_repository -&gt; pet_repository 바로 따기</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927012522777.png" alt="image-20220927012522777"></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927012552418.png" alt="image-20220927012552418"></p>
      </li>
    </ul>
  </li>
</ol>

<h4 id="02-br생성된-repo를-pull해서-checkout해서-처리하지말고-pr을-사용하기-위해-원본repo는-남겨두고-남의repo면-fork후-브랜치단위로--b-clone해서-작업후-pr로-끝내기">
<a class="anchor" href="#02-br%EC%83%9D%EC%84%B1%EB%90%9C-repo%EB%A5%BC-pull%ED%95%B4%EC%84%9C-checkout%ED%95%B4%EC%84%9C-%EC%B2%98%EB%A6%AC%ED%95%98%EC%A7%80%EB%A7%90%EA%B3%A0-pr%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%B4-%EC%9B%90%EB%B3%B8repo%EB%8A%94-%EB%82%A8%EA%B2%A8%EB%91%90%EA%B3%A0-%EB%82%A8%EC%9D%98repo%EB%A9%B4-fork%ED%9B%84-%EB%B8%8C%EB%9E%9C%EC%B9%98%EB%8B%A8%EC%9C%84%EB%A1%9C--b-clone%ED%95%B4%EC%84%9C-%EC%9E%91%EC%97%85%ED%9B%84-pr%EB%A1%9C-%EB%81%9D%EB%82%B4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 br생성된 repo를 pull해서 checkout해서 처리하지말고, PR을 사용하기 위해, 원본repo는 남겨두고 (남의repo면 fork후) 브랜치단위로 -b clone해서 작업후 PR로 끝내기</h4>

<ol>
  <li>
    <p>원본repo를 삭제하기 전에, <code class="language-plaintext highlighter-rouge">.gitignore</code>에 <code class="language-plaintext highlighter-rouge">.db</code>파일이 있나 확인한다.</p>

    <ul>
      <li><strong>있으면 임시로 상위폴더에 옮겨준다.</strong></li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927023327204.png" alt="image-20220927023327204"></p>
  </li>
  <li>
    <p><strong>작업했던 <code class="language-plaintext highlighter-rouge">backend-python</code> 폴더를 upstrema으로 간주하고 삭제</strong>한다</p>

    <ul>
      <li>venv터미널</li>
      <li>venv vscode다 꺼야한다</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927023448112.png" alt="image-20220927023448112"></p>
  </li>
  <li>
    <p><strong>상위폴더에서 터미널을 켜고 -b 특정브랜치</strong>를 넣어서 clone한다</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git clone -b feat/user_repository [복붙.git]
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927023743519.png" alt="image-20220927023743519"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927023754539.png" alt="image-20220927023754539"></p>
  </li>
  <li>
    <p><strong>백업해놓은 .db파일을 복사만 해서 넣어준다(다른 br도 복사해서 쓸 것이기 때문에 자리 유지)</strong></p>
  </li>
  <li>
    <p>터미널에서 clone한 프로젝트로 들어가 <strong>ls와 git branch를 확인한다.</strong></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>cd backend-python
   
ls
   
git branch
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927024318570.png" alt="image-20220927024318570"></p>
  </li>
</ol>

<h4 id="03-clone받고-백업db-넣어준-폴더에-가상환경-생성---requirementstxt-설치---pre-commit-install까지">
<a class="anchor" href="#03-clone%EB%B0%9B%EA%B3%A0-%EB%B0%B1%EC%97%85db-%EB%84%A3%EC%96%B4%EC%A4%80-%ED%8F%B4%EB%8D%94%EC%97%90-%EA%B0%80%EC%83%81%ED%99%98%EA%B2%BD-%EC%83%9D%EC%84%B1---requirementstxt-%EC%84%A4%EC%B9%98---pre-commit-install%EA%B9%8C%EC%A7%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 clone받고 백업db 넣어준 폴더에 가상환경 생성 -&gt; requirements.txt 설치 -&gt; pre-commit install까지</h4>

<ol>
  <li>
    <p>virtualenv로 가상환경 만들어주고, 진입후, txt에 따라 설치</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>python -m virtualenv -p python310 venv
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>.\venv\Scripts\activate
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pip3 install -r requirements.txt
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pre-commit install
</code></pre></div>    </div>
  </li>
  <li>
    <p>code. &gt; select interpreter</p>
  </li>
</ol>

<h2 id="2-repository와-pytest">
<a class="anchor" href="#2-repository%EC%99%80-pytest" aria-hidden="true"><span class="octicon octicon-link"></span></a>2 Repository와 PyTest</h2>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927005857759.png" alt="image-20220927005857759"></p>

<ul>
  <li>항상 프로젝트는 탐색기로 폴더 -&gt; 터미널 -&gt; code . &gt; interpreter select선택후 내부터미널 재오픈 &gt; 외부 터미널 venv직접 켜주기
    <ul>
      <li>
<strong><code class="language-plaintext highlighter-rouge">터미널(venv) &gt; vscode(venv)</code>를 같이 유지</strong>한다.</li>
    </ul>
  </li>
</ul>

<h3 id="01-user-repository-작성">
<a class="anchor" href="#01-user-repository-%EC%9E%91%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 User Repository 작성</h3>

<ol>
  <li>
    <p>fake.py 및 repo init 속 FakeRepo class올린 것 삭제</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">user_repository.py</code> 생성 후 UserRepository클래스 생성</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
	<span class="s">"""class to manage User Repository"""</span>
   	
</code></pre></div>    </div>
  </li>
  <li>
    <p>insert메서드 만들기</p>

    <ol>
      <li>create라서 자동생성용 id는 인자로 안받는다)</li>
      <li>docstring 작성</li>
    </ol>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
	<span class="s">"""class to manage User Repository"""</span>
   
	<span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
		<span class="s">"""insert data in user entity
		:param - name: person name
		       - password: user password
		:return
		"""</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="01-repository는-config의-handler와-entities의-entity를-기본적으로-import">
<a class="anchor" href="#01-repository%EB%8A%94-config%EC%9D%98-handler%EC%99%80-entities%EC%9D%98-entity%EB%A5%BC-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9C%BC%EB%A1%9C-import" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 repository는 config의 handler와 entities의 entity를 기본적으로 import</h4>

<ol>
  <li>
    <p><strong>CRUD메서드내에서 crud하기 위해서는 내부 session을 field로  유지하는 <code class="language-plaintext highlighter-rouge">DBConnectionHandler</code>을 with as db_connection으로 +  해당 db를 컨트롤 하기 위한 <code class="language-plaintext highlighter-rouge">Users entity</code>가 필요하므로src&gt;infra&gt;config + entities에서 import 해서 쓴다</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Users</span>
   
   
</code></pre></div>    </div>
  </li>
  <li>
    <p>insert 작성 및 pylint E1101(no-member) 무시하기</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># pylint: disable=E1101
</span>   
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Users</span>
   
   
<span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
    <span class="s">"""class to manage User Repository"""</span>
   
    <span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""insert data in user entity
        :param - name: person name
               - password: user password
        :return
        """</span>
        <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_uesr</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_uesr</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
				<span class="k">raise</span> 
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Repository는 CRUD메서드들을 @classmethod로 작성한다</strong></p>

    <ul>
      <li>repository는 <strong><code class="language-plaintext highlighter-rouge">필드(멤버)가 없는 객체 1개 생성해서 돌려쓰기</code>를 위해   <code class="language-plaintext highlighter-rouge">객체로 static 클래스</code>처럼 쓰기 위해 cls로 정의한다</strong>
</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="nb">classmethod</span>
<span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="02--pytest를-위해-user_repository_testpy를-작성한다">
<a class="anchor" href="#02--pytest%EB%A5%BC-%EC%9C%84%ED%95%B4-user_repository_testpy%EB%A5%BC-%EC%9E%91%EC%84%B1%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>02  pytest를 위해, user_repository_test.py를 작성한다.</h4>

<ul>
  <li>
    <p>테스트할 파일명<code class="language-plaintext highlighter-rouge">_test</code>.py 형태로 바로 옆에 작성해준다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927035013591.png" alt="image-20220927035013591"></p>
  </li>
</ul>

<h4 id="03-pytest--faker를-설치하고-_testpy에서-사용한다">
<a class="anchor" href="#03-pytest--faker%EB%A5%BC-%EC%84%A4%EC%B9%98%ED%95%98%EA%B3%A0-_testpy%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 pytest + faker를 설치하고 _test.py에서 사용한다.</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 install faker

pip3 install pytest
</code></pre></div></div>

<ol>
  <li>
    <p><strong>faker와 현재폴더에 원본py 속 테스트할 클래스를 import한다</strong></p>

    <ul>
      <li>같은 폴더의 py은 <code class="language-plaintext highlighter-rouge">.</code>을 붙여서 from으로 잡고 import class를 하면 됨.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">.user_repository</span> <span class="kn">import</span> <span class="n">UserRepository</span>
   
   
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Faker객체와, 테스트할클래스 객체를 생성해놓고, <code class="language-plaintext highlighter-rouge">test_</code>로 메서드를 만들어서  작성한다</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">.user_repository</span> <span class="kn">import</span> <span class="n">UserRepository</span>
<span class="kn">from</span> <span class="nn">src.infra.repo</span> <span class="kn">import</span> <span class="n">user_repository</span>
   
<span class="n">faker</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">user_repository</span> <span class="o">=</span> <span class="n">UserRepository</span><span class="p">()</span>
   
<span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="s">"""Should Insert User"""</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
	<span class="n">password</span> <span class="o">=</span><span class="n">faker</span><span class="p">.</span><span class="n">word</span><span class="p">()</span>
   
	<span class="n">user_repository</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="04-pytest는-터미널에서-돌린다">
<a class="anchor" href="#04-pytest%EB%8A%94-%ED%84%B0%EB%AF%B8%EB%84%90%EC%97%90%EC%84%9C-%EB%8F%8C%EB%A6%B0%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 pytest는 터미널에서 돌린다</h4>

<p><code class="language-plaintext highlighter-rouge">pytest</code></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927035951484.png" alt="image-20220927035951484"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927040205150.png" alt="image-20220927040205150"></p>

<ul>
  <li>
    <p>pytest할때마다 데이터가 추가될 것이다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927040235115.png" alt="image-20220927040235115"></p>
  </li>
</ul>

<h5 id="pytest의-결과-pytest_cache폴더가-추가되니-gitignore에-폴더를-추가한다">
<a class="anchor" href="#pytest%EC%9D%98-%EA%B2%B0%EA%B3%BC-pytest_cache%ED%8F%B4%EB%8D%94%EA%B0%80-%EC%B6%94%EA%B0%80%EB%90%98%EB%8B%88-gitignore%EC%97%90-%ED%8F%B4%EB%8D%94%EB%A5%BC-%EC%B6%94%EA%B0%80%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>pytest의 결과 .pytest_cache폴더가 추가되니 gitignore에 폴더를 추가한다</h5>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**/__pycache__
venv
storage.db
.pytest_cache
</code></pre></div></div>

<h3 id="02-_testpy에서-createinsert-메서드-테스트">
<a class="anchor" href="#02-_testpy%EC%97%90%EC%84%9C-createinsert-%EB%A9%94%EC%84%9C%EB%93%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 _test.py에서 CREATE(insert) 메서드 테스트</h3>

<h4 id="01-원본메서드-내부에서-확인할-생성-데이터를-namedtuple불변클래스의-객체로-생성해서-반환한다">
<a class="anchor" href="#01-%EC%9B%90%EB%B3%B8%EB%A9%94%EC%84%9C%EB%93%9C-%EB%82%B4%EB%B6%80%EC%97%90%EC%84%9C-%ED%99%95%EC%9D%B8%ED%95%A0-%EC%83%9D%EC%84%B1-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-namedtuple%EB%B6%88%EB%B3%80%ED%81%B4%EB%9E%98%EC%8A%A4%EC%9D%98-%EA%B0%9D%EC%B2%B4%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%B4%EC%84%9C-%EB%B0%98%ED%99%98%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 원본메서드 내부에서 확인할 생성 데이터를 namedTuple(불변클래스)의 객체로 생성해서, 반환한다</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
    <span class="s">"""class to manage User Repository"""</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="s">"""insert data in user entity
        :param - name: person name
               - password: user password
        :return
        """</span>

        <span class="n">InsertData</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">"Users"</span><span class="p">,</span> <span class="s">"id name password"</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_uesr</span> <span class="o">=</span> <span class="n">Users</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_uesr</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">InsertData</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
            	<span class="c1"># ...
</span>                
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<h4 id="02-test메서드에서는-return물을-받아-print한다">
<a class="anchor" href="#02-test%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90%EC%84%9C%EB%8A%94-return%EB%AC%BC%EC%9D%84-%EB%B0%9B%EC%95%84-print%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 test메서드에서는 return물을 받아 print한다</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="s">"""Should Insert User"""</span>
	<span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
	<span class="n">password</span> <span class="o">=</span><span class="n">faker</span><span class="p">.</span><span class="n">word</span><span class="p">()</span>

	<span class="n">new_user</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="03-pytest에서는--v---s옵션을-가한다">
<a class="anchor" href="#03-pytest%EC%97%90%EC%84%9C%EB%8A%94--v---s%EC%98%B5%EC%85%98%EC%9D%84-%EA%B0%80%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 pytest에서는 -v + -s옵션을 가한다</h4>

<ul>
  <li>
    <p>옵션별 출력</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pytest</code></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927144300378.png" alt="image-20220927144300378"></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">pytest - v</code> : 메서드별 성공여부</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927144355582.png" alt="image-20220927144355582"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>생성된 데이터를 변수에 받아 print까지 한 다음 <code class="language-plaintext highlighter-rouge">pytest -v -s</code></strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927150400983.png" alt="image-20220927150400983"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927150416488.png" alt="image-20220927150416488"></p>
  </li>
</ul>

<h4 id="04-namedtuple의-typename을-entity와-동일하게-준-것의-장점을-살려-insert메서드의-return-type-명시-및-docstring도-수정해준다">
<a class="anchor" href="#04-namedtuple%EC%9D%98-typename%EC%9D%84-entity%EC%99%80-%EB%8F%99%EC%9D%BC%ED%95%98%EA%B2%8C-%EC%A4%80-%EA%B2%83%EC%9D%98-%EC%9E%A5%EC%A0%90%EC%9D%84-%EC%82%B4%EB%A0%A4-insert%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-return-type-%EB%AA%85%EC%8B%9C-%EB%B0%8F-docstring%EB%8F%84-%EC%88%98%EC%A0%95%ED%95%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 namedTuple의 typename을 entity와 동일하게 준 것의 장점을 살려, insert메서드의 return type 명시 및 docstring도 수정해준다.</h4>

<ul>
  <li>docstring에서는 tuple이라고 이름지어놓는다?!</li>
</ul>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927150707294.png" alt="image-20220927150707294"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
    <span class="s">"""class to manage User Repository"""</span>

    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Users</span><span class="p">:</span>
        <span class="s">"""insert data in user entity
        :param - name: person name
               - password: user password
        :return - tuple with new user inserted
        """</span>
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927150808524.png" alt="image-20220927150808524"></p>

<h4 id="05-handler의-engine---execute-sql-query를-이용해서-생성된-데이터를-print없이-db데이터로-필드끼리-assert로-비교한다">
<a class="anchor" href="#05-handler%EC%9D%98-engine---execute-sql-query%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%83%9D%EC%84%B1%EB%90%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-print%EC%97%86%EC%9D%B4-db%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A1%9C-%ED%95%84%EB%93%9C%EB%81%BC%EB%A6%AC-assert%EB%A1%9C-%EB%B9%84%EA%B5%90%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>05 handler의 engine -&gt; execute sql query를 이용해서, 생성된 데이터를 print없이 DB데이터로 필드끼리 assert로 비교한다</h4>

<ol>
  <li>
    <p>이미 repository는 crud메서드내에서, with handler-&gt; engine -&gt; bind 한 session필드를 가지고 있지만, **<code class="language-plaintext highlighter-rouge">test</code>에서 추가로 <code class="language-plaintext highlighter-rouge">handler</code>를 import해서 <code class="language-plaintext highlighter-rouge">실시간session이 아닌 engine</code>만 가져와 <code class="language-plaintext highlighter-rouge">execute</code>해서  db속 데이터를 직접 가져와서 <code class="language-plaintext highlighter-rouge">필드끼리 assert</code>로  비교한다. **</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#...
</span><span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">.user_repository</span> <span class="kn">import</span> <span class="n">UserRepository</span>
   
<span class="c1">#...
</span><span class="n">db_connection_handler</span> <span class="o">=</span> <span class="n">DBConnectionHandler</span><span class="p">()</span>
   
<span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="c1"># ...
</span>	<span class="n">engine</span> <span class="o">=</span> <span class="n">db_connection_handler</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
   
	<span class="n">new_user</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
	<span class="c1"># SQL Commands
</span>	<span class="n">query_user</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"SELECT * FROM users WHERE id='</span><span class="si">{</span><span class="n">new_user</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">'"</span><span class="p">).</span><span class="n">fetchone</span><span class="p">()</span>
   
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="nb">id</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">name</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">password</span>
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pytest -v -s
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>execute후 fetchone()의 결과는 LegacyRow타입이며 <code class="language-plaintext highlighter-rouge">출력은 튜플형태</code>지만, <code class="language-plaintext highlighter-rouge">.필드</code>로 데이터를 가져올 수 있다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="c1">#...
</span>   
	<span class="n">new_user</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
	<span class="c1"># SQL Commands
</span>	<span class="n">query_user</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"SELECT * FROM users WHERE id='</span><span class="si">{</span><span class="n">new_user</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">'"</span><span class="p">).</span><span class="n">fetchone</span><span class="p">()</span>
	<span class="k">print</span><span class="p">(</span><span class="n">new_user</span><span class="p">)</span>
	<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">query_user</span><span class="p">))</span>
	<span class="k">print</span><span class="p">(</span><span class="n">query_user</span><span class="p">)</span>
</code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pytest -v -s
   
Users(id=14, name='Andrew Moore', password='amount')
&lt;class 'sqlalchemy.engine.row.LegacyRow'&gt;
(14, 'Andrew Moore', 'amount')
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927172953375.png" alt="image-20220927172953375"></p>
  </li>
</ol>

<h4 id="생성---sql로-로드---비교-전-db속-데이터는-sql로-삭제까지-해준다">
<a class="anchor" href="#%EC%83%9D%EC%84%B1---sql%EB%A1%9C-%EB%A1%9C%EB%93%9C---%EB%B9%84%EA%B5%90-%EC%A0%84-db%EC%86%8D-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%8A%94-sql%EB%A1%9C-%EC%82%AD%EC%A0%9C%EA%B9%8C%EC%A7%80-%ED%95%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>생성 -&gt; sql로 로드 -&gt; 비교 전 db속 데이터는 sql로 삭제까지 해준다.</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="c1">#...
</span>	<span class="n">new_user</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">insert_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
	<span class="c1"># SQL Commands
</span>	<span class="n">query_user</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"SELECT * FROM users WHERE id='</span><span class="si">{</span><span class="n">new_user</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">'"</span><span class="p">).</span><span class="n">fetchone</span><span class="p">()</span>
	
	<span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"DELETE FROM users WHERE id='</span><span class="si">{</span><span class="n">new_user</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">'"</span><span class="p">)</span>


	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="nb">id</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">name</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">password</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pytest -v -s
</code></pre></div></div>

<h3 id="03-pre-commit-설정에-pytest-추가하기">
<a class="anchor" href="#03-pre-commit-%EC%84%A4%EC%A0%95%EC%97%90-pytest-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 pre-commit 설정에 pytest 추가하기</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">.pre-commit-config.yaml</code> 맨 아래에 아래 스크립트를 추가한다.</p>

    <div class="language-yaml highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="pi">-</span>   <span class="na">repo</span><span class="pi">:</span> <span class="s">local</span>
    <span class="na">hooks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">pytest</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">pytest</span>
      <span class="na">language</span><span class="pi">:</span> <span class="s">system</span>
      <span class="na">entry</span><span class="pi">:</span> <span class="s">pytest -v -s</span>
      <span class="na">always_run</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">pass_filenames</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">stages</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">commit</span><span class="pi">]</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>일부러 test가 에러나도록 수정한다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_insert_user</span><span class="p">():</span>
	<span class="c1">#...
</span>   
	<span class="c1"># assert new_user.id == query_user.id
</span>	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="mi">101</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">name</span>
	<span class="k">assert</span> <span class="n">new_user</span><span class="p">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">query_user</span><span class="p">.</span><span class="n">password</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>git commit을 통해 pytest가 실패를 잘 잡아내는지 확인한다.</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git add .
git commit -m "feat: Createing 
UserRepository with insert_user and test it"
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927174527715.png" alt="image-20220927174527715"></p>
  </li>
</ol>

<h3 id="04-upstream내꺼라면-remote에-push해서-해당-작업br를-확인한다">
<a class="anchor" href="#04-upstream%EB%82%B4%EA%BA%BC%EB%9D%BC%EB%A9%B4-remote%EC%97%90-push%ED%95%B4%EC%84%9C-%ED%95%B4%EB%8B%B9-%EC%9E%91%EC%97%85br%EB%A5%BC-%ED%99%95%EC%9D%B8%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 upstream(내꺼라면 remote)에 push해서 해당 작업br를 확인한다.</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git push
</code></pre></div></div>

<ul>
  <li>
    <p>master에 들어가도 PR가 뜨긴한다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175050873.png" alt="image-20220927175050873"></p>
  </li>
  <li>
    <p>작업br로 들어가서 직접 파일을 볼땐 꺼지지만, 바꾼 즉시는 떠있다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175215916.png" alt="image-20220927175215916"></p>
  </li>
  <li>
    <p>PR을 누르고, base &lt;- <strong>compare쪽을 작업br로 확인</strong>하고 <strong>아래 코드변화를 확인</strong>한다</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175356646.png" alt="image-20220927175356646">
<img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175411293.png" alt="image-20220927175411293"></p>
  </li>
  <li>
    <p><strong>관리자는 PR탭으로 가서 확인</strong>한다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175543099.png" alt="image-20220927175543099"></p>
  </li>
  <li>
    <p>관리자는 <strong>file changes 탭에서 변화를 본다</strong></p>

    <ul>
      <li>코멘트를 달고나서 finish review를 해준다.</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175705790.png" alt="image-20220927175705790"></p>
  </li>
  <li>
    <p><strong>관리자는 파일마다 Viewed를 클릭하면, 확인한 파일들 쉽게 확인할 수 있다.</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175906652.png" alt="image-20220927175906652"></p>
  </li>
  <li>
    <p>확인이 끝나면, merge PR해준다.</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220927175609772.png" alt="image-20220927175609772"></p>
  </li>
</ul>

<h2 id="3-domain-layer-및-models-use_cases-개발">
<a class="anchor" href="#3-domain-layer-%EB%B0%8F-models-use_cases-%EA%B0%9C%EB%B0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>3 Domain layer 및 models, use_cases 개발</h2>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928021521443.png" alt="image-20220928021521443"></p>

<h3 id="01-src-domain--models-use_cases-모듈-생성">
<a class="anchor" href="#01-src-domain--models-use_cases-%EB%AA%A8%EB%93%88-%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 src&gt; domain &gt; models, use_cases 모듈 생성</h3>

<ol>
  <li>
    <p>src&gt; <code class="language-plaintext highlighter-rouge">domain</code>폴더 및 init.py를 생성</p>
  </li>
  <li>
    <p>src&gt; domain &gt; <code class="language-plaintext highlighter-rouge">models</code>폴더 및 init.py를 생성</p>
  </li>
  <li>
    <p>src&gt; domain &gt; <code class="language-plaintext highlighter-rouge">use_cases</code>폴더 및 init.py를 생성</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928022241819.png" alt="image-20220928022241819"></p>
  </li>
</ol>

<h3 id="02-repository에-있던-namedtupleusers를-domain--modelsuserspy로-옮기고-users-entity는-usersmodel로-취급하기">
<a class="anchor" href="#02-repository%EC%97%90-%EC%9E%88%EB%8D%98-namedtupleusers%EB%A5%BC-domain--modelsuserspy%EB%A1%9C-%EC%98%AE%EA%B8%B0%EA%B3%A0-users-entity%EB%8A%94-usersmodel%EB%A1%9C-%EC%B7%A8%EA%B8%89%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 repository에 있던 namedTuple(“Users”)를 domain &gt; models&gt;users.py로 옮기고, Users entity는 UsersModel로 취급하기</h3>

<ol>
  <li>
    <p>user_repository에 있는 namedTuple import + 사용코드를 src&gt;model&gt;<code class="language-plaintext highlighter-rouge">users.py</code> 만들어 로 옮긴다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
   
<span class="n">InsertData</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">"Users"</span><span class="p">,</span> <span class="s">"id name password"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>불변클래스 변수명 == import된 class명으로서 Users로 수정한 뒤, init에 올린다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
   
<span class="n">Users</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">"Users"</span><span class="p">,</span> <span class="s">"id name password"</span><span class="p">)</span>
</code></pre></div>    </div>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.users</span> <span class="kn">import</span> <span class="n">Users</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>user_repository에서는 <strong>DTO개념으로서 src&gt;models&gt;user.py에 정의된 namedTuple의 불변클래스 <code class="language-plaintext highlighter-rouge">Users</code>를 import해서 기존 InsertData관련 로직을 대체한다</strong>.</p>

    <ul>
      <li>namedTuple -&gt; User(model)</li>
      <li>User(entity) -&gt; UsersModel</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># from collections import namedtuple
</span><span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Users</span>
   
<span class="c1">#...
</span>   
<span class="k">class</span> <span class="nc">UserRepository</span><span class="p">:</span>
    <span class="c1"># ...
</span>   
        <span class="c1"># InsertData = namedtuple("Users", "id name password")
</span>   
        <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># new_uesr = Users(name=name, password=password)
</span>                <span class="n">new_uesr</span> <span class="o">=</span> <span class="n">UsersModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_uesr</span><span class="p">)</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
   
                <span class="c1"># return InsertData(
</span>                <span class="k">return</span> <span class="n">Users</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">new_uesr</span><span class="p">.</span><span class="n">password</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
   
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>교체한 로직이 잘 작동하는지 pytest -vs를 돌렵노다.</strong></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pytest -vs
</code></pre></div>    </div>
  </li>
  <li>
    <p>잘 작동하면 git status add commit한다.</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git commit -m "feat: Implementing models in domain layer"
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="03-select_userselect메서드를-객체가-부르는-static메서드인-classmethod로-정의">
<a class="anchor" href="#03-select_userselect%EB%A9%94%EC%84%9C%EB%93%9C%EB%A5%BC-%EA%B0%9D%EC%B2%B4%EA%B0%80-%EB%B6%80%EB%A5%B4%EB%8A%94-static%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%B8-classmethod%EB%A1%9C-%EC%A0%95%EC%9D%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 select_user(SELECT)메서드를 객체가 부르는 static메서드인 @classmethod로 정의</h3>

<h4 id="01-select의-결과는-listmodel불변class">
<a class="anchor" href="#01-select%EC%9D%98-%EA%B2%B0%EA%B3%BC%EB%8A%94-listmodel%EB%B6%88%EB%B3%80class" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 select의 결과는 List[model(불변class)]</h4>

<ol>
  <li>
    <p><strong>id와 동등한 unique필드 name이 있으므로 <code class="language-plaintext highlighter-rouge">id와 name모두 = None</code>형태로 선택형으로 받는다.</strong></p>
  </li>
  <li>
    <p><strong>return 타입을 typing을 import해 정의하며 결국엔 <code class="language-plaintext highlighter-rouge">List[model]</code>형태로 반환받는다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">select_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Users</span><span class="p">]:</span>
        <span class="s">"""
        Select data in user entity by id and/or name
        :param - user_id: Id of the registry
               - name: User name
        :return - List with Users selected
        """</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="02-select는-insert와-달리-파라미터의-경우의수---try가-제일-바깥에서-내부if-elif별-진입후에-with-handler">
<a class="anchor" href="#02-select%EB%8A%94-insert%EC%99%80-%EB%8B%AC%EB%A6%AC-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EC%9D%98-%EA%B2%BD%EC%9A%B0%EC%9D%98%EC%88%98---try%EA%B0%80-%EC%A0%9C%EC%9D%BC-%EB%B0%94%EA%B9%A5%EC%97%90%EC%84%9C-%EB%82%B4%EB%B6%80if-elif%EB%B3%84-%EC%A7%84%EC%9E%85%ED%9B%84%EC%97%90-with-handler" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 select는 insert와 달리 파라미터의 경우의수 -&gt; try가 제일 바깥에서 내부if elif별 진입후에 with handler</h4>

<ol>
  <li>
    <p>select는 id외에 대체칼럼인 unqiue칼럼을 쓸 수 있는 순간부터 옵셔널하게 받을 수 있어야한다.</p>

    <ul>
      <li>파라미터를 =None으로 모두 주고, 모두 None이면 예외처리 해야할 듯</li>
    </ul>
  </li>
  <li>
    <p><strong>select결과는 1개일수도 여러개일 수도 있다. 결과는 List로 맞춰났으니, 가변변수에 1개일시 []씌워서 반환해준다.</strong></p>

    <ol>
      <li>가변변수 query_data = None에다가
        <ol>
          <li>
<code class="language-plaintext highlighter-rouge">.one()</code>1개시 -&gt;  [data] 할당</li>
          <li>2개이상시 -&gt; 그대로 할당</li>
        </ol>
      </li>
    </ol>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">select_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Users</span><span class="p">]:</span>
        <span class="s">"""
        Select data in user entity by id and/or name
        :param - user_id: Id of the registry
               - name: User name
        :return - List with Users selected
        """</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query_data</span> <span class="o">=</span> <span class="bp">None</span>
   
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">UsersModel</span><span class="p">).</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">).</span><span class="n">one</span><span class="p">()</span>
                    <span class="n">query_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
   
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">UsersModel</span><span class="p">).</span><span class="n">filter_by</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">).</span><span class="n">one</span><span class="p">()</span>
                    <span class="n">query_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
   
            <span class="k">elif</span> <span class="n">user_id</span> <span class="ow">and</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">UsersModel</span><span class="p">).</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">).</span><span class="n">one</span><span class="p">()</span>
                    <span class="n">query_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
   
            <span class="k">return</span> <span class="n">query_data</span>
   
        <span class="k">except</span><span class="p">:</span>
            <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="04-select메서드에-대한-test메서드-작성">
<a class="anchor" href="#04-select%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90-%EB%8C%80%ED%95%9C-test%EB%A9%94%EC%84%9C%EB%93%9C-%EC%9E%91%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 select메서드에 대한 test메서드 작성</h3>

<h4 id="insertcreate메서드---db조회후-db삭제-와-달리-select는-db삽입생성후----select메서드---db삭제">
<a class="anchor" href="#insertcreate%EB%A9%94%EC%84%9C%EB%93%9C---db%EC%A1%B0%ED%9A%8C%ED%9B%84-db%EC%82%AD%EC%A0%9C-%EC%99%80-%EB%8B%AC%EB%A6%AC-select%EB%8A%94-db%EC%82%BD%EC%9E%85%EC%83%9D%EC%84%B1%ED%9B%84----select%EB%A9%94%EC%84%9C%EB%93%9C---db%EC%82%AD%EC%A0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert(create메서드 -&gt; db조회후 db삭제 )와 달리, select는 db삽입생성후  -&gt; select메서드 -&gt; db삭제</h4>

<ol>
  <li>
    <p><strong>조회의 경우, entity에 데이터를 넣어서 entity객체로 조회한다.</strong></p>

    <ul>
      <li>Users entity -&gt; UsersModel로 가져온다.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">.user_repository</span> <span class="kn">import</span> <span class="n">UserRepository</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Users</span> <span class="k">as</span> <span class="n">UsersModel</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>faker로 필드데이터를 만들고, <strong>select전 DB생성부터 한다</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_select_user</span><span class="p">():</span>
    <span class="s">"""Should select a user in Users table and compare it """</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">word</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">UsersModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
   
    <span class="n">engine</span> <span class="o">=</span> <span class="n">db_connection_handler</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
    <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s">f"  INSERT INTO users (id, name, password) VALUES (</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s">);"</span>
    <span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="데이터를-assert-필드비교를-떠나-entity객체별-비교하기-위해서-entity별-eq메서드-정의하기파라미터를-other로-주고-비교">
<a class="anchor" href="#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-assert-%ED%95%84%EB%93%9C%EB%B9%84%EA%B5%90%EB%A5%BC-%EB%96%A0%EB%82%98-entity%EA%B0%9D%EC%B2%B4%EB%B3%84-%EB%B9%84%EA%B5%90%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%B4%EC%84%9C-entity%EB%B3%84-eq%EB%A9%94%EC%84%9C%EB%93%9C-%EC%A0%95%EC%9D%98%ED%95%98%EA%B8%B0%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-other%EB%A1%9C-%EC%A3%BC%EA%B3%A0-%EB%B9%84%EA%B5%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>데이터를 assert 필드비교를 떠나 entity객체별 비교하기 위해서, entity별 eq메서드 정의하기(파라미터를 other로 주고 비교)</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Users</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="s">"""Users Entity"""</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"users"</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">id_pet</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s">"Pets"</span><span class="p">)</span>

    <span class="c1">#...
</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="nb">id</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">password</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">password</span>
</code></pre></div></div>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">\</code>없이 enter를 편하게 줄바꿈하기 위해서 괄호를 걸어주고 친다.</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Pets</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="s">"""Pets Entity"""</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s">"pets"</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Enum</span><span class="p">(</span><span class="n">AnimalTypes</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">(</span><span class="s">"users.id"</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">f"Pets: [name=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, specie=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">specie</span><span class="err">!</span><span class="n">r</span><span class="si">}</span><span class="s">, user_id=</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">user_id</span><span class="si">}</span><span class="s">]"</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="nb">id</span> 
            <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">name</span> 
            <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">specie</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">specie</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">age</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">age</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">user_id</span>
            <span class="p">)</span>
</code></pre></div></div>

<h4 id="uniquekey칼럼을-가진-경우의수별-조회결과1개라도listentitymodel를-assert-in으로-여러개-다-비교하기">
<a class="anchor" href="#uniquekey%EC%B9%BC%EB%9F%BC%EC%9D%84-%EA%B0%80%EC%A7%84-%EA%B2%BD%EC%9A%B0%EC%9D%98%EC%88%98%EB%B3%84-%EC%A1%B0%ED%9A%8C%EA%B2%B0%EA%B3%BC1%EA%B0%9C%EB%9D%BC%EB%8F%84listentitymodel%EB%A5%BC-assert-in%EC%9C%BC%EB%A1%9C-%EC%97%AC%EB%9F%AC%EA%B0%9C-%EB%8B%A4-%EB%B9%84%EA%B5%90%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>uniquekey칼럼을 가진 경우의수별 조회결과(1개라도List[entityModel])를 assert in으로 여러개 다 비교하기</h4>

<ol>
  <li>
<strong>가짜데이터로 -&gt; 모델 data객체</strong>를 만든다.</li>
  <li>가짜데이터를 -&gt; db에 삽입생성한다.</li>
  <li>select메서드로 db조회하여 -&gt; List[모델]을 만든다.</li>
  <li>1번에서 만든 모델data vs 3번에서 db조회한 List[모델]을 <strong>객체 in [객체List]로 비교</strong>한다.</li>
</ol>

<ul>
  <li><strong>f-string sql 중 VALUES다음에는 각 {value}에는 바깥쪽에 ‘‘작은따옴표를 씌워서 넣어줘야한다.</strong></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_select_user</span><span class="p">():</span>
    <span class="s">"""Should select a user in Users table and compare it """</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">word</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">UsersModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

    <span class="n">engine</span> <span class="o">=</span> <span class="n">db_connection_handler</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
    <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s">f"  INSERT INTO users (id, name, password) VALUES ('</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">', '</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">', '</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s">');"</span>
    <span class="p">)</span>

    <span class="n">query_user1</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">select_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="n">query_user2</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">select_user</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="n">query_user3</span> <span class="o">=</span> <span class="n">user_repository</span><span class="p">.</span><span class="n">select_user</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_user1</span>
    <span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_user2</span>
    <span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_user3</span>

    <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"DELETE FROM users WHERE id='</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">';"</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pytest -v -s
</code></pre></div></div>

<h4 id="commit포맷팅등-후-hook에-의해-취소되었다면-수정된-것을-다시-한번-add-commit">
<a class="anchor" href="#commit%ED%8F%AC%EB%A7%B7%ED%8C%85%EB%93%B1-%ED%9B%84-hook%EC%97%90-%EC%9D%98%ED%95%B4-%EC%B7%A8%EC%86%8C%EB%90%98%EC%97%88%EB%8B%A4%EB%A9%B4-%EC%88%98%EC%A0%95%EB%90%9C-%EA%B2%83%EC%9D%84-%EB%8B%A4%EC%8B%9C-%ED%95%9C%EB%B2%88-add-commit" aria-hidden="true"><span class="octicon octicon-link"></span></a>commit(포맷팅등) 후 hook에 의해 취소되었다면, 수정된 것을 다시 한번 add commit</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status

git add .

git commit -m 'feat: implementing select_user in UserRepository'
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161430582.png" alt="image-20220928161430582"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161441497.png" alt="image-20220928161441497"></p>

<h3 id="05-pr후-동일br에서-다른-작업이-끝났을-때">
<a class="anchor" href="#05-pr%ED%9B%84-%EB%8F%99%EC%9D%BCbr%EC%97%90%EC%84%9C-%EB%8B%A4%EB%A5%B8-%EC%9E%91%EC%97%85%EC%9D%B4-%EB%81%9D%EB%82%AC%EC%9D%84-%EB%95%8C" aria-hidden="true"><span class="octicon octicon-link"></span></a>05 PR후 동일br에서 다른 작업이 끝났을 때</h3>

<h4 id="commit후-push-전-github를-보니-이전-pr이-merge되어있는데도-남아있다면-close-pr해준다">
<a class="anchor" href="#commit%ED%9B%84-push-%EC%A0%84-github%EB%A5%BC-%EB%B3%B4%EB%8B%88-%EC%9D%B4%EC%A0%84-pr%EC%9D%B4-merge%EB%90%98%EC%96%B4%EC%9E%88%EB%8A%94%EB%8D%B0%EB%8F%84-%EB%82%A8%EC%95%84%EC%9E%88%EB%8B%A4%EB%A9%B4-close-pr%ED%95%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>commit후 push 전, github를 보니 이전 PR이 merge되어있는데도 남아있다면, close PR해준다.</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928160730842.png" alt="image-20220928160730842"></p>

<h4 id="push전-prnew-pull-request를-눌러-들어가서-comparing-changes로-이전pr이-어디까지-작업됬는지-확인한다">
<a class="anchor" href="#push%EC%A0%84-prnew-pull-request%EB%A5%BC-%EB%88%8C%EB%9F%AC-%EB%93%A4%EC%96%B4%EA%B0%80%EC%84%9C-comparing-changes%EB%A1%9C-%EC%9D%B4%EC%A0%84pr%EC%9D%B4-%EC%96%B4%EB%94%94%EA%B9%8C%EC%A7%80-%EC%9E%91%EC%97%85%EB%90%AC%EB%8A%94%EC%A7%80-%ED%99%95%EC%9D%B8%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>push전 PR&gt;New pull request를 눌러 들어가서, Comparing changes로 이전PR이 어디까지 작업됬는지 확인한다</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161040496.png" alt="image-20220928161040496"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161111314.png" alt="image-20220928161111314"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161136719.png" alt="image-20220928161136719"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161147312.png" alt="image-20220928161147312"></p>

<h4 id="local의-clone-작업br에서--commit을-push해서한-뒤---직접-new-pr--compare-branch-바꿔서---create-pr해서-새로운-pr을-만든다">
<a class="anchor" href="#local%EC%9D%98-clone-%EC%9E%91%EC%97%85br%EC%97%90%EC%84%9C--commit%EC%9D%84-push%ED%95%B4%EC%84%9C%ED%95%9C-%EB%92%A4---%EC%A7%81%EC%A0%91-new-pr--compare-branch-%EB%B0%94%EA%BF%94%EC%84%9C---create-pr%ED%95%B4%EC%84%9C-%EC%83%88%EB%A1%9C%EC%9A%B4-pr%EC%9D%84-%EB%A7%8C%EB%93%A0%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>local의 [clone 작업br]에서  commit을 push해서한 뒤 -&gt; 직접 New PR &gt; Compare branch 바꿔서 -&gt; Create PR해서 새로운 PR을 만든다.</h4>

<ul>
  <li>vscode에서 git push(로그인 된 터미널개념)</li>
</ul>

<ol>
  <li>
    <p>새 PR 누르기</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161847178.png" alt="image-20220928161847178"></p>
  </li>
  <li>
    <p>Comparing Changes에서 작업br로 바꾸기</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161905559.png" alt="image-20220928161905559"></p>
  </li>
  <li>
    <p><strong>직접 create PR 누르기</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928161929876.png" alt="image-20220928161929876"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928162011863.png" alt="image-20220928162011863"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928162033796.png" alt="image-20220928162033796"></p>
  </li>
  <li>
    <p>직접 merge 누르기</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928162139266.png" alt="image-20220928162139266"></p>
  </li>
  <li>
    <p>master에서 merge된 것 확인하기</p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220928162212960.png" alt="image-20220928162212960"></p>
  </li>
</ol>

<h3 id="06-github에서-만든-타-작업br을-가져오되-최신master를-rebase하고-사용하기">
<a class="anchor" href="#06-github%EC%97%90%EC%84%9C-%EB%A7%8C%EB%93%A0-%ED%83%80-%EC%9E%91%EC%97%85br%EC%9D%84-%EA%B0%80%EC%A0%B8%EC%98%A4%EB%90%98-%EC%B5%9C%EC%8B%A0master%EB%A5%BC-rebase%ED%95%98%EA%B3%A0-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>06 github에서 만든 타 작업br을 가져오되, 최신master를 rebase하고 사용하기</h3>

<h4 id="br1과-br2를-동시에-만들고-동시에-clone--b했었더라면">
<a class="anchor" href="#br1%EA%B3%BC-br2%EB%A5%BC-%EB%8F%99%EC%8B%9C%EC%97%90-%EB%A7%8C%EB%93%A4%EA%B3%A0-%EB%8F%99%EC%8B%9C%EC%97%90-clone--b%ED%96%88%EC%97%88%EB%8D%94%EB%9D%BC%EB%A9%B4" aria-hidden="true"><span class="octicon octicon-link"></span></a>br1과 br2를 동시에 만들고 동시에 clone -b했었더라면</h4>

<ul>
  <li>feat/user_repository -&gt; clone -b</li>
  <li>
<strong>feat/pet_repository -&gt; clone - b 안됨(폴더명 동일해서)</strong>
    <ul>
      <li><strong>다른 폴더에 clone -b 했어야함</strong></li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p>feat/pet_repository br을 clone해 둔 곳으로 가서, 터미널을 열고</p>

    <ul>
      <li>git branch</li>
      <li>
<strong>git checkout master</strong>
        <ul>
          <li><strong>작업b만clone-b한 상황에서 <code class="language-plaintext highlighter-rouge">master로 checktout</code>하면 master가 생긴다.</strong></li>
        </ul>
      </li>
      <li>git branch</li>
      <li>
<strong>git pull</strong>
        <ul>
          <li>feat/user_repository에서 작업한 것들이 다 maste로 받아진다.</li>
        </ul>
      </li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929012747541.png" alt="image-20220929012747541"></p>
  </li>
</ol>

<h4 id="다음작업br만-local-clone--b하고-ignore되었던---상위폴더에-백업해놓았던-sqlite-db파일을-복붙해준다">
<a class="anchor" href="#%EB%8B%A4%EC%9D%8C%EC%9E%91%EC%97%85br%EB%A7%8C-local-clone--b%ED%95%98%EA%B3%A0-ignore%EB%90%98%EC%97%88%EB%8D%98---%EC%83%81%EC%9C%84%ED%8F%B4%EB%8D%94%EC%97%90-%EB%B0%B1%EC%97%85%ED%95%B4%EB%86%93%EC%95%98%EB%8D%98-sqlite-db%ED%8C%8C%EC%9D%BC%EC%9D%84-%EB%B3%B5%EB%B6%99%ED%95%B4%EC%A4%80%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>다음작업br만 local clone -b하고, ignore되었던 -&gt; 상위폴더에 백업해놓았던 sqlite .db파일을 복붙해준다.</h4>

<ol>
  <li>
    <p>나는 폴더명을 pet_repository로 만들고 진입한 뒤,  터미널을 열어서 <code class="language-plaintext highlighter-rouge">현재폴더 .</code>에 clone - b해온다</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git clone -b feat/pet_repository https://github.com/is2js/backend-python.git .
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929013207357.png" alt="image-20220929013207357"></p>
  </li>
  <li>
    <p>상위폴더에 백업해둔 db파일을 복붙한다.</p>
  </li>
  <li>
    <p>혹시 몰라서 master로 checkout하고 git pull해준다.</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>PS C:\Users\is2js\pythonProject\pet_repository&gt; git branch
* feat/pet_repository
PS C:\Users\is2js\pythonProject\pet_repository&gt; git checkout master
Switched to a new branch 'master'
Branch 'master' set up to track remote branch 'master' from 'origin'.
PS C:\Users\is2js\pythonProject\pet_repository&gt; git branch
  feat/pet_repository
* master
PS C:\Users\is2js\pythonProject\pet_repository&gt; git pull
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="최신업뎃된-master를-두고-다시-작업br로-넘어와-git-rebase-master를-통해-master로부터-최신작업을-가져온다">
<a class="anchor" href="#%EC%B5%9C%EC%8B%A0%EC%97%85%EB%8E%83%EB%90%9C-master%EB%A5%BC-%EB%91%90%EA%B3%A0-%EB%8B%A4%EC%8B%9C-%EC%9E%91%EC%97%85br%EB%A1%9C-%EB%84%98%EC%96%B4%EC%99%80-git-rebase-master%EB%A5%BC-%ED%86%B5%ED%95%B4-master%EB%A1%9C%EB%B6%80%ED%84%B0-%EC%B5%9C%EC%8B%A0%EC%9E%91%EC%97%85%EC%9D%84-%EA%B0%80%EC%A0%B8%EC%98%A8%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>최신업뎃된 master를 두고, 다시 작업br로 넘어와, git rebase master를 통해 master로부터 최신작업을 가져온다.</h4>

<ul>
  <li>
    <p>일단 최신업뎃 master의 git log를 보자.</p>

    <ul>
      <li>
        <p><strong>rebase결과 1줄로 이어지므로, 미리 보자.</strong></p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929013732893.png" alt="image-20220929013732893"></p>
      </li>
    </ul>
  </li>
</ul>

<ol>
  <li>
    <p><strong>최신업뎃master를 둔 상태에서, 작업br로 checkout한다.</strong></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git checkout feat/pet_repository
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>작업br에서 -&gt; master에게 rebase를 요청한다</strong></p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git rebase master
   
First, rewinding head to replay your work on top of it...
Fast-forwarded feat/pet_repository to master.
</code></pre></div>    </div>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929013958639.png" alt="image-20220929013958639"></p>
  </li>
</ol>

<h3 id="07-clone한-폴더-new-setting최초">
<a class="anchor" href="#07-clone%ED%95%9C-%ED%8F%B4%EB%8D%94-new-setting%EC%B5%9C%EC%B4%88" aria-hidden="true"><span class="octicon octicon-link"></span></a>07 clone한 폴더 new setting(최초)</h3>

<h4 id="01-gitignore중에-db파일-있으면-옮겨주기">
<a class="anchor" href="#01-gitignore%EC%A4%91%EC%97%90-db%ED%8C%8C%EC%9D%BC-%EC%9E%88%EC%9C%BC%EB%A9%B4-%EC%98%AE%EA%B2%A8%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 gitignore중에 db파일 있으면 옮겨주기</h4>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929154256052.png" alt="image-20220929154256052"></p>

<h4 id="02-github에서-따온-빈-새br에-대해-venv를-만들고-활성화하고--vscode를-연다">
<a class="anchor" href="#02-github%EC%97%90%EC%84%9C-%EB%94%B0%EC%98%A8-%EB%B9%88-%EC%83%88br%EC%97%90-%EB%8C%80%ED%95%B4-venv%EB%A5%BC-%EB%A7%8C%EB%93%A4%EA%B3%A0-%ED%99%9C%EC%84%B1%ED%99%94%ED%95%98%EA%B3%A0--vscode%EB%A5%BC-%EC%97%B0%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 github에서 따온 빈 새br에 대해, venv를 만들고 활성화하고  vscode를 연다</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m virtualenv -p python310 venv

.\venv\Scripts\activate
</code></pre></div></div>

<h4 id="03-최초-requirementstxt-직접-설치">
<a class="anchor" href="#03-%EC%B5%9C%EC%B4%88-requirementstxt-%EC%A7%81%EC%A0%91-%EC%84%A4%EC%B9%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 최초 requirements.txt 직접 설치</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 install -r requirements.txt
</code></pre></div></div>

<h4 id="04-최초-pre-commit-install-직접-설치">
<a class="anchor" href="#04-%EC%B5%9C%EC%B4%88-pre-commit-install-%EC%A7%81%EC%A0%91-%EC%84%A4%EC%B9%98" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 최초 pre-commit install 직접 설치</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-commit install
</code></pre></div></div>

<h3 id="08-pet-repository-개발">
<a class="anchor" href="#08-pet-repository-%EA%B0%9C%EB%B0%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>08 pet repository 개발</h3>

<h4 id="insert_petcreate-메서드">
<a class="anchor" href="#insert_petcreate-%EB%A9%94%EC%84%9C%EB%93%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert_pet(CREATE) 메서드</h4>

<h5 id="pets-entity에-대한-srcdomainmodels에서-petspydto-pets-만들어서-올리기">
<a class="anchor" href="#pets-entity%EC%97%90-%EB%8C%80%ED%95%9C-srcdomainmodels%EC%97%90%EC%84%9C-petspydto-pets-%EB%A7%8C%EB%93%A4%EC%96%B4%EC%84%9C-%EC%98%AC%EB%A6%AC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>pets entity에 대한 src&gt;domain&gt;models에서 pets.py(dto Pets) 만들어서 올리기</h5>

<ol>
  <li>
    <p>src&gt;infra&gt;entities에 있는 pet.py의 Pets class entity의 필드를 확인하고, namedTuple로 DTO class를 먼저 만든다.</p>

    <ol>
      <li>
        <p>pets.py</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
      
<span class="n">Pets</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s">"Pets"</span><span class="p">,</span> <span class="s">"id name specie age user_id"</span><span class="p">)</span>
</code></pre></div>        </div>
      </li>
      <li>
        <p>modes의 init에 올리기</p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.users</span> <span class="kn">import</span> <span class="n">Users</span>
<span class="kn">from</span> <span class="nn">.pets</span> <span class="kn">import</span> <span class="n">Pets</span>
      
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>

<h5 id="pets-entity에-대한-srcinfrarepo에서-pet_repositorypy-에서-create메서드insert_부터-만들기">
<a class="anchor" href="#pets-entity%EC%97%90-%EB%8C%80%ED%95%9C-srcinfrarepo%EC%97%90%EC%84%9C-pet_repositorypy-%EC%97%90%EC%84%9C-create%EB%A9%94%EC%84%9C%EB%93%9Cinsert_%EB%B6%80%ED%84%B0-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>pets entity에 대한 src&gt;infra&gt;repo에서 pet_repository.py 에서 CREATE메서드(insert_)부터 만들기</h5>

<ol>
  <li>
    <p>classmethod로 id를 제외한 필드를 인자로, <strong>반환타입은 DTO Pets로(생성된 것을 반환하여 확인하게 한다)</strong></p>

    <ul>
      <li><strong>반환타입에 의해, 어쩔수 없이 <code class="language-plaintext highlighter-rouge">model(dto)</code>를 import 해야하므로, 먼저 정의했다.</strong></li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>   
<span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Pets</span>
   
   
<span class="k">class</span> <span class="nc">PetRepository</span><span class="p">:</span>
	<span class="s">"""Class to manage Pet Repository"""</span>
   
	<span class="o">@</span><span class="nb">classmethod</span>
	<span class="k">def</span> <span class="nf">insert_pet</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">specie</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pets</span><span class="p">:</span>
   
</code></pre></div>    </div>

    <ul>
      <li>
        <p>import 추천이 뜨는데 소문자로 import된다?</p>

        <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929155819036.png" alt="image-20220929155819036"></p>
      </li>
    </ul>
  </li>
  <li>
    <p><strong>crud를 하려면, return타입DTO뿐만 아니라, 실제 <code class="language-plaintext highlighter-rouge">entity + session</code>이 필요하다 <code class="language-plaintext highlighter-rouge">as PetsModel</code> + <code class="language-plaintext highlighter-rouge">handler</code>를 import하자.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Pets</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Pets</span> <span class="k">as</span> <span class="n">PetsModel</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>with handler -&gt; conn -&gt; session객체로 entity객체를 add해서 commit후, <strong>commit후 자동으로 변수에 등록된 id를 사용해서 DTO를 채워 반환한다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># pylint: disable=E1101
</span>   
<span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Pets</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Pets</span> <span class="k">as</span> <span class="n">PetsModel</span>
   
<span class="k">class</span> <span class="nc">PetRepository</span><span class="p">:</span>
	<span class="s">"""Class to manage Pet Repository"""</span>
   
	<span class="o">@</span><span class="nb">classmethod</span>
	<span class="k">def</span> <span class="nf">insert_pet</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">specie</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pets</span><span class="p">:</span>
		<span class="s">"""Insert data in pets entity
   
		Args:
			name (str): name of the pet
			specie (str): Enum with species accpets
			age (int): pet age
			user_id (int): id of the owner (FK)
   
		Returns:
			Pets: tuple with new pet inserted
		"""</span>
		<span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">new_pet</span> <span class="o">=</span> <span class="n">PetsModel</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">specie</span><span class="o">=</span><span class="n">specie</span><span class="p">,</span>  <span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_pet</span><span class="p">)</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
   
				<span class="k">return</span> <span class="n">Pets</span><span class="p">(</span>
					<span class="nb">id</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span> 
					<span class="n">name</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> 
					<span class="n">specie</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">specie</span><span class="p">,</span>  
					<span class="n">age</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">age</span><span class="p">,</span> 
					<span class="n">user_id</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">user_id</span>
				<span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
				<span class="k">raise</span>
			<span class="k">finally</span><span class="p">:</span>
				<span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
   		
		<span class="k">return</span> <span class="bp">None</span>
</code></pre></div>    </div>
  </li>
</ol>

<h5 id="pet-repo-메서드1개-만들때마다-_testpy에-test작성하기">
<a class="anchor" href="#pet-repo-%EB%A9%94%EC%84%9C%EB%93%9C1%EA%B0%9C-%EB%A7%8C%EB%93%A4%EB%95%8C%EB%A7%88%EB%8B%A4-_testpy%EC%97%90-test%EC%9E%91%EC%84%B1%ED%95%98%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>pet repo 메서드1개 만들때마다 _test.py에 test작성하기</h5>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pet_repositort_test.py</code>를 만들고 <code class="language-plaintext highlighter-rouge">test_해당메서드</code>를 정의한다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_insert_pet</span><span class="p">():</span>
	<span class="s">"""Should insert pet in Pet table and return it"""</span>
   	
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>테스트 데이터를 만들기 위해, faker를 사용한다</strong></p>

    <ul>
      <li>faker객체는 전역변수로 1개로서 import 밑에 만들어준다.</li>
      <li><strong>faker로 못만드는<code class="language-plaintext highlighter-rouge">enum</code>은 직접 입력해준다.</strong></li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
   
<span class="n">faker</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
   
   
<span class="k">def</span> <span class="nf">test_insert_pet</span><span class="p">():</span>
    <span class="s">"""Should insert pet in Pet table and return it"""</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="s">"fish"</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>repository를 import해서 거기 메서드를 사용해 테스트할 것이다.</strong></p>

    <ul>
      <li>전역 객체변수를 만든다.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">.pet_repository</span> <span class="kn">import</span> <span class="n">PetRepository</span>
   
<span class="n">faker</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">pet_repository</span> <span class="o">=</span> <span class="n">PetRepository</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>sqlalchemy CRUD를 증명하기 위해 hanlder를 import해서 engine.execute를 활용할 것이다.</strong></p>

    <ul>
      <li>전역 hadler -&gt; db_connection_handler객체를 만든다.</li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">.pet_repository</span> <span class="kn">import</span> <span class="n">PetRepository</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
   
<span class="n">faker</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">pet_repository</span> <span class="o">=</span> <span class="n">PetRepository</span><span class="p">()</span>
<span class="n">db_connection_handler</span> <span class="o">=</span> <span class="n">DBConnectionHandler</span><span class="p">()</span>
</code></pre></div>    </div>
  </li>
</ol>

<h5 id="createinsert의-결과비교는-메서드-결과namedtuple-vs-engine쿼리결과lecayrow-tuple-결과은-어쩔수-없이-필드끼리-한다">
<a class="anchor" href="#createinsert%EC%9D%98-%EA%B2%B0%EA%B3%BC%EB%B9%84%EA%B5%90%EB%8A%94-%EB%A9%94%EC%84%9C%EB%93%9C-%EA%B2%B0%EA%B3%BCnamedtuple-vs-engine%EC%BF%BC%EB%A6%AC%EA%B2%B0%EA%B3%BClecayrow-tuple-%EA%B2%B0%EA%B3%BC%EC%9D%80-%EC%96%B4%EC%A9%94%EC%88%98-%EC%97%86%EC%9D%B4-%ED%95%84%EB%93%9C%EB%81%BC%EB%A6%AC-%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>create(insert)의 결과비교는 메서드 결과(namedTuple) vs engine쿼리결과(LecayRow, tuple) 결과은 어쩔수 없이 필드끼리 한다</h5>

<ol>
  <li>
    <p><strong>repo메서드 결과물(dto, namedTuple) vs engine쿼리결과물(tuple)을 비교한다</strong></p>

    <ul>
      <li>
        <p><strong>참고: commit이 이루어지는 순간 entity model로 만든 객체에는, id를 포함한 정보가 부여된다.</strong></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Pets</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_conn</span><span class="p">:</span>
<span class="p">...</span>     <span class="n">new_pet</span> <span class="o">=</span> <span class="n">Pets</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">'adf'</span><span class="p">,</span><span class="n">specie</span><span class="o">=</span><span class="s">'fish'</span><span class="p">,</span><span class="n">age</span><span class="o">=</span><span class="mi">33</span><span class="p">,</span><span class="n">user_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                       
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">new_pet</span><span class="p">),</span> <span class="n">new_pet</span><span class="p">)</span>
<span class="p">...</span>     <span class="n">db_conn</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_pet</span><span class="p">)</span>
<span class="p">...</span>     <span class="n">db_conn</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">commit</span><span class="p">()</span>
<span class="p">...</span>     <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">new_pet</span><span class="p">),</span> <span class="n">new_pet</span><span class="p">)</span>
<span class="p">...</span>     <span class="n">db_conn</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="p">...</span> 
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">src</span><span class="p">.</span><span class="n">infra</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="n">pets</span><span class="p">.</span><span class="n">Pets</span><span class="s">'&gt; Pets: [name='</span><span class="n">adf</span><span class="s">', specie='</span><span class="n">fish</span><span class="s">', user_id=1]
&lt;class '</span><span class="n">src</span><span class="p">.</span><span class="n">infra</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="n">pets</span><span class="p">.</span><span class="n">Pets</span><span class="s">'&gt; Pets: [name='</span><span class="n">adf</span><span class="s">', specie=&lt;AnimalTypes.fish: '</span><span class="n">fish</span><span class="s">'&gt;, user_id=1]
</span></code></pre></div>        </div>

        <ul>
          <li>repo -&gt; entitymodel -&gt; session.addcommit -&gt; entitymodel완성 -&gt; <strong>dto(namedTuple)</strong>
</li>
        </ul>
      </li>
      <li>
        <p><strong>참고: engine으로 fetchone()해온 결과물은 tuple같은 것이다.</strong></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">query_user</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">'select * from users where id = 1;'</span><span class="p">).</span><span class="n">fetchone</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">query_user</span><span class="p">),</span> <span class="n">query_user</span><span class="p">)</span> 
<span class="o">&lt;</span><span class="k">class</span> <span class="err">'</span><span class="nc">sqlalchemy</span><span class="p">.</span><span class="n">engine</span><span class="p">.</span><span class="n">row</span><span class="p">.</span><span class="n">LegacyRow</span><span class="s">'&gt; (1, '</span><span class="n">cho</span><span class="s">', '</span><span class="mi">1234</span><span class="s">')
</span></code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ol>

<h4 id="test_insert_pet">
<a class="anchor" href="#test_insert_pet" aria-hidden="true"><span class="octicon octicon-link"></span></a>test_insert_pet</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Pets</span> <span class="k">as</span> <span class="n">PetsModel</span>
<span class="kn">from</span> <span class="nn">src.infra.config</span> <span class="kn">import</span> <span class="n">DBConnectionHandler</span>
<span class="kn">from</span> <span class="nn">src.infra.entities.pets</span> <span class="kn">import</span> <span class="n">AnimalTypes</span>
<span class="kn">from</span> <span class="nn">.pet_repository</span> <span class="kn">import</span> <span class="n">PetRepository</span>


<span class="n">faker</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="n">pet_repository</span> <span class="o">=</span> <span class="n">PetRepository</span><span class="p">()</span>
<span class="n">db_connection_handler</span> <span class="o">=</span> <span class="n">DBConnectionHandler</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_insert_pet</span><span class="p">():</span>
    <span class="s">"""Should insert pet in Pet table and return it"""</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="s">"fish"</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">()</span>

    <span class="c1"># SQL Commands
</span>    <span class="n">new_pet</span> <span class="o">=</span> <span class="n">pet_repository</span><span class="p">.</span><span class="n">insert_pet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">specie</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">db_connection_handler</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
    <span class="n">query_pet</span> <span class="o">=</span> <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="s">f'SELECT * FROM pets WHERE id ="</span><span class="si">{</span><span class="n">new_pet</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">";'</span>
    <span class="p">).</span><span class="n">fetchone</span><span class="p">()</span>

    <span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"DELETE FROM users WHERE id = '</span><span class="si">{</span><span class="n">new_pet</span><span class="p">.</span><span class="nb">id</span><span class="si">}</span><span class="s">';"</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">new_pet</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">query_pet</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">new_pet</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">new_pet</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">.</span><span class="nb">id</span>
    <span class="k">assert</span> <span class="n">new_pet</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">.</span><span class="n">name</span>
    <span class="k">assert</span> <span class="n">new_pet</span><span class="p">.</span><span class="n">specie</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">.</span><span class="n">specie</span>
    <span class="k">assert</span> <span class="n">new_pet</span><span class="p">.</span><span class="n">age</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">.</span><span class="n">age</span>
    <span class="k">assert</span> <span class="n">new_pet</span><span class="p">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">query_pet</span><span class="p">.</span><span class="n">user_id</span>
</code></pre></div></div>

<h5 id="pytest를-경로를-직접-찾아가-1개의-testpy만-걸-수도-있다">
<a class="anchor" href="#pytest%EB%A5%BC-%EA%B2%BD%EB%A1%9C%EB%A5%BC-%EC%A7%81%EC%A0%91-%EC%B0%BE%EC%95%84%EA%B0%80-1%EA%B0%9C%EC%9D%98-testpy%EB%A7%8C-%EA%B1%B8-%EC%88%98%EB%8F%84-%EC%9E%88%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>pytest를 경로를 직접 찾아가 1개의 test.py만 걸 수도 있다.</h5>

<ul>
  <li>상위폴더부터 직접 py까지 가주면 된다.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> pytest .\src\infra\repo\pet_repository_test.py -vs
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929225934419.png" alt="image-20220929225934419"></p>

<h5 id="dto-repo의-createinsert메서드의-결과물에서-enum-field를-dto에-담을-때는-value로--담는다">
<a class="anchor" href="#dto-repo%EC%9D%98-createinsert%EB%A9%94%EC%84%9C%EB%93%9C%EC%9D%98-%EA%B2%B0%EA%B3%BC%EB%AC%BC%EC%97%90%EC%84%9C-enum-field%EB%A5%BC-dto%EC%97%90-%EB%8B%B4%EC%9D%84-%EB%95%8C%EB%8A%94-value%EB%A1%9C--%EB%8B%B4%EB%8A%94%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>[DTO] repo의 create(insert)메서드의 결과물에서 enum field를 DTO에 담을 때는 .value로  담는다.</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PetRepository</span><span class="p">:</span>
    <span class="c1">#...
</span>    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">insert_pet</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">specie</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pets</span><span class="p">:</span>
        <span class="c1">#...
</span>        <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
            <span class="c1">#...
</span>                <span class="k">return</span> <span class="n">Pets</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="nb">id</span><span class="p">,</span>
                    <span class="n">name</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="c1"># specie=new_pet.specie,
</span>                    <span class="n">specie</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">specie</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="n">age</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">age</span><span class="p">,</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">new_pet</span><span class="p">.</span><span class="n">user_id</span>
                <span class="p">)</span>
</code></pre></div></div>

<h5 id="my-dtonamedtuple과-lecacyrow-모두-tuple이라-값비교시-통과-바로-되더라">
<a class="anchor" href="#my-dtonamedtuple%EA%B3%BC-lecacyrow-%EB%AA%A8%EB%91%90-tuple%EC%9D%B4%EB%9D%BC-%EA%B0%92%EB%B9%84%EA%B5%90%EC%8B%9C-%ED%86%B5%EA%B3%BC-%EB%B0%94%EB%A1%9C-%EB%90%98%EB%8D%94%EB%9D%BC" aria-hidden="true"><span class="octicon octicon-link"></span></a>my) DTO(namedTuple)과 LecacyRow 모두 tuple이라 값비교시 통과 바로 되더라…</h5>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929230642759.png" alt="image-20220929230642759"></p>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929230705136.png" alt="image-20220929230705136"></p>

<h5 id="method-test완료후-commit작업을-이어할-것이면-push없이-commit후-바로-진행">
<a class="anchor" href="#method-test%EC%99%84%EB%A3%8C%ED%9B%84-commit%EC%9E%91%EC%97%85%EC%9D%84-%EC%9D%B4%EC%96%B4%ED%95%A0-%EA%B2%83%EC%9D%B4%EB%A9%B4-push%EC%97%86%EC%9D%B4-commit%ED%9B%84-%EB%B0%94%EB%A1%9C-%EC%A7%84%ED%96%89" aria-hidden="true"><span class="octicon octicon-link"></span></a>method test완료후 commit(작업을 이어할 것이면, push없이 commit후 바로 진행)</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">git</span> <span class="n">add</span> <span class="p">.</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">m</span> <span class="s">"feat: implementing insert_pet in PetRepository"</span>
</code></pre></div></div>

<h4 id="select_pet-메서드">
<a class="anchor" href="#select_pet-%EB%A9%94%EC%84%9C%EB%93%9C" aria-hidden="true"><span class="octicon octicon-link"></span></a>select_pet 메서드</h4>

<ol>
  <li>
    <p>select부터는 1개든 여러개는 return type이 <code class="language-plaintext highlighter-rouge">List[DTO]</code>형태다.</p>

    <ul>
      <li>typing 패키지에서 List 를 import한다.</li>
      <li>select시 파라미터가 선택형이므로 = None으로 선언하며, <strong>자신의 id or unique key칼럼 or <code class="language-plaintext highlighter-rouge">하위entity(M)으로서 fk를 반드시 포함</code>시킨다.</strong>
        <ul>
          <li>pet_id : 자신의 id</li>
          <li>user_id: Manyentity가 가지고 있는 상위entity의 id (FK)</li>
        </ul>
      </li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="c1">#...
</span>    <span class="o">@</span><span class="nb">classmethod</span>
    <span class="k">def</span> <span class="nf">select_pet</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pet_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Pets</span><span class="p">]:</span>
   
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>select는 unique or fk 등 선택형이 가능하기 때문에 <code class="language-plaintext highlighter-rouge">try -&gt; 가변변수 -&gt; if elif return List[DTO] -&gt; 각 경우마다 with </code>의 전략으로 간다.</strong></p>
  </li>
</ol>

<h5 id="조심-fk가-select메서드에-들어간-경우-one이-아니라-all을-쓰며-return-data가-아니라-그냥-return-data">
<a class="anchor" href="#%EC%A1%B0%EC%8B%AC-fk%EA%B0%80-select%EB%A9%94%EC%84%9C%EB%93%9C%EC%97%90-%EB%93%A4%EC%96%B4%EA%B0%84-%EA%B2%BD%EC%9A%B0-one%EC%9D%B4-%EC%95%84%EB%8B%88%EB%9D%BC-all%EC%9D%84-%EC%93%B0%EB%A9%B0-return-data%EA%B0%80-%EC%95%84%EB%8B%88%EB%9D%BC-%EA%B7%B8%EB%83%A5-return-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>조심! fk가 select메서드에 들어간 경우, .one()이 아니라 .all()을 쓰며, return [data]가 아니라 그냥 return data</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="nb">classmethod</span>
<span class="k">def</span> <span class="nf">select_pet</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">pet_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Pets</span><span class="p">]:</span>
    <span class="s">"""
        Select dat in PetEntity by id and/or user_id
        :param - pet_id: Id of the pet registry
               - user_id: Id of the owner
                :return - List with Pets selected
        """</span>
    <span class="k">try</span><span class="p">:</span>

        <span class="n">query_data</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">pet_id</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">PetsModel</span><span class="p">)</span>
                    <span class="p">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pet_id</span><span class="p">)</span>
                    <span class="p">.</span><span class="n">one</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">query_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>

                <span class="k">elif</span> <span class="ow">not</span> <span class="n">pet_id</span> <span class="ow">and</span> <span class="n">user_id</span><span class="p">:</span>
                    <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">PetsModel</span><span class="p">)</span>
                            <span class="p">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
                            <span class="p">.</span><span class="nb">all</span><span class="p">()</span>
                        <span class="p">)</span>
                        <span class="n">query_data</span> <span class="o">=</span> <span class="n">data</span>

                        <span class="k">elif</span> <span class="n">pet_id</span> <span class="ow">and</span> <span class="n">user_id</span><span class="p">:</span>
                            <span class="k">with</span> <span class="n">DBConnectionHandler</span><span class="p">()</span> <span class="k">as</span> <span class="n">db_connection</span><span class="p">:</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">PetsModel</span><span class="p">)</span>
                                    <span class="p">.</span><span class="n">filter_by</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pet_id</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
                                    <span class="p">.</span><span class="n">one</span><span class="p">()</span>
                                <span class="p">)</span>
                                <span class="n">query_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
                                <span class="k">return</span> <span class="n">query_data</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">rollback</span><span class="p">()</span>
                                <span class="k">raise</span>
                                <span class="k">finally</span><span class="p">:</span>
                                    <span class="n">db_connection</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>

                                    <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<h4 id="select_test">
<a class="anchor" href="#select_test" aria-hidden="true"><span class="octicon octicon-link"></span></a>select_test</h4>

<h5 id="insertcreate와-다르게-id도-faker로-생성해서-조회한다">
<a class="anchor" href="#insertcreate%EC%99%80-%EB%8B%A4%EB%A5%B4%EA%B2%8C-id%EB%8F%84-faker%EB%A1%9C-%EC%83%9D%EC%84%B1%ED%95%B4%EC%84%9C-%EC%A1%B0%ED%9A%8C%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert(CREATE)와 다르게, id도 faker로 생성해서 조회한다.</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_select_pet</span><span class="p">():</span>
    <span class="s">"""Should select a pet in Pets table and compare it"""</span>
    <span class="n">pet_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="s">"fish"</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="insertcreate-test와-다르게-selectread-test는-해당-entity-model-및-enum도-직접필요하다">
<a class="anchor" href="#insertcreate-test%EC%99%80-%EB%8B%A4%EB%A5%B4%EA%B2%8C-selectread-test%EB%8A%94-%ED%95%B4%EB%8B%B9-entity-model-%EB%B0%8F-enum%EB%8F%84-%EC%A7%81%EC%A0%91%ED%95%84%EC%9A%94%ED%95%98%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert(CREATE) test와 다르게, select(READ) test는 해당 entity Model 및 enum도 직접필요하다.</h5>

<h6 id="insert는-dtotuple-vs-query결과tuple">
<a class="anchor" href="#insert%EB%8A%94-dtotuple-vs-query%EA%B2%B0%EA%B3%BCtuple" aria-hidden="true"><span class="octicon octicon-link"></span></a>insert는 dto(tuple) vs query결과(tuple)</h6>

<h6 id="create는-faker---entitymodel-vs--faker-insert-into---select메서드-listdto">
<a class="anchor" href="#create%EB%8A%94-faker---entitymodel-vs--faker-insert-into---select%EB%A9%94%EC%84%9C%EB%93%9C-listdto" aria-hidden="true"><span class="octicon octicon-link"></span></a>create는 faker -&gt; entitymodel vs  faker-&gt;insert into -&gt; select메서드 List[DTO]</h6>

<ol>
  <li>
    <p>entity 및 entityModel객체 생성에 필요한 enum도 같이  import한다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="c1">#...
</span><span class="kn">from</span> <span class="nn">src.infra.entities</span> <span class="kn">import</span> <span class="n">Pets</span> <span class="k">as</span> <span class="n">PetsModel</span>
<span class="kn">from</span> <span class="nn">src.infra.entities.pets</span> <span class="kn">import</span> <span class="n">AnimalTypes</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>faker로 만든 데이터로 entityModel을 만든다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_select_pet</span><span class="p">():</span>
    <span class="s">"""Should select a pet in Pets table and compare it"""</span>
   
    <span class="n">pet_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">name</span><span class="p">()</span>
    <span class="n">specie</span> <span class="o">=</span> <span class="s">"fish"</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">faker</span><span class="p">.</span><span class="n">random_number</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
   
    <span class="n">specie_mock</span> <span class="o">=</span> <span class="n">AnimalTypes</span><span class="p">(</span><span class="s">"fish"</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">PetsModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pet_id</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">specie</span><span class="o">=</span><span class="n">specie_mock</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
       
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>engine으로 select할 데이터를 db에 삽입생성한다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1"># SQL Commands
</span><span class="n">engine</span> <span class="o">=</span> <span class="n">db_connection_handler</span><span class="p">.</span><span class="n">get_engine</span><span class="p">()</span>
<span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span>
    <span class="s">f"""
        INSERT INFO pets (id, name, spiece, age, user_id)
        VALUES ('</span><span class="si">{</span><span class="n">pet_id</span><span class="si">}</span><span class="s">', '</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">','</span><span class="si">{</span><span class="n">specie</span><span class="si">}</span><span class="s">','</span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s">','</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">');
        """</span>
<span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>select를 파라미터 경우의 수(3가지)로 날려서 entityModel객체 in select쿼리결과List[Dto]으로 비교한다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">query_pets1</span> <span class="o">=</span> <span class="n">pet_repository</span><span class="p">.</span><span class="n">select_pet</span><span class="p">(</span><span class="n">pet_id</span><span class="o">=</span><span class="n">pet_id</span><span class="p">)</span>
<span class="n">query_pets2</span> <span class="o">=</span> <span class="n">pet_repository</span><span class="p">.</span><span class="n">select_pet</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
<span class="n">query_pets3</span> <span class="o">=</span> <span class="n">pet_repository</span><span class="p">.</span><span class="n">select_pet</span><span class="p">(</span><span class="n">pet_id</span><span class="o">=</span><span class="n">pet_id</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
   
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">query_pets1</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">query_pets1</span><span class="p">))</span>
   
<span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets1</span>
<span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets2</span>
<span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets3</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>insert와 달리,  비교끝내고 삽입한 데이터를 삭제한다.</strong></p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets1</span>
<span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets2</span>
<span class="k">assert</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">query_pets3</span>
   
<span class="n">engine</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="s">f"DELETE FROM users WHERE id='</span><span class="si">{</span><span class="n">pet_id</span><span class="si">}</span><span class="s">';"</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>테스트한다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">pytest</span> <span class="p">.</span>\<span class="n">src</span>\<span class="n">infra</span>\<span class="n">repo</span>\<span class="n">pet_repository_test</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">vs</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>entity model과 List[DTO]는 타입이 다르지만, <code class="language-plaintext highlighter-rouge">entity model 속 __eq__</code>으로 인해, 필드끼리 비교하게 되니 가능한 것이다.</strong></p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">entity class 속 __eq__</code></p>

        <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="nb">id</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">name</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">specie</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">specie</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">age</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">age</span>
        <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">user_id</span>
    <span class="p">)</span>
</code></pre></div>        </div>
      </li>
    </ul>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>[name='Marcus Smith', specie=&lt;AnimalTypes.fish: 'fish'&gt;, user_id=5935]
   
&lt;class 'src.infra.entities.pets.Pets'&gt;
   
[Pets: [name='Marcus Smith', specie=&lt;AnimalTypes.fish: 'fish'&gt;, user_id=5935]] 
   
&lt;class 'list'&gt;
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="pre-commit에-의해-한번은-걸리고-수정되니-매번-add하지말고-그냥--am으로-commit해주고-log확인하자">
<a class="anchor" href="#pre-commit%EC%97%90-%EC%9D%98%ED%95%B4-%ED%95%9C%EB%B2%88%EC%9D%80-%EA%B1%B8%EB%A6%AC%EA%B3%A0-%EC%88%98%EC%A0%95%EB%90%98%EB%8B%88-%EB%A7%A4%EB%B2%88-add%ED%95%98%EC%A7%80%EB%A7%90%EA%B3%A0-%EA%B7%B8%EB%83%A5--am%EC%9C%BC%EB%A1%9C-commit%ED%95%B4%EC%A3%BC%EA%B3%A0-log%ED%99%95%EC%9D%B8%ED%95%98%EC%9E%90" aria-hidden="true"><span class="octicon octicon-link"></span></a>pre-commit에 의해 한번은 걸리고, 수정되니 매번 add하지말고 그냥 -am으로 commit해주고 log확인하자</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git status

git commit -am "feat: implementing insert_pet and select_pet in PetRepository"

git log --oneline
</code></pre></div></div>

<h4 id="test-정리-insert메서드와-select메서드-테스트">
<a class="anchor" href="#test-%EC%A0%95%EB%A6%AC-insert%EB%A9%94%EC%84%9C%EB%93%9C%EC%99%80-select%EB%A9%94%EC%84%9C%EB%93%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8" aria-hidden="true"><span class="octicon octicon-link"></span></a>[Test] 정리: insert메서드와 select메서드 테스트</h4>

<h5 id="01-insert메서드test_insert_pet">
<a class="anchor" href="#01-insert%EB%A9%94%EC%84%9C%EB%93%9Ctest_insert_pet" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 insert메서드(test_insert_pet)</h5>

<ol>
  <li>faker로 insert메서드의 필드재료들을 <code class="language-plaintext highlighter-rouge">db배정 id필드</code>제외하고  만든다</li>
  <li>
<strong>insert메서드로 new_pet(DTO)로 반환</strong>받는다.
    <ul>
      <li>(내부)재료-&gt;entity모델객체-&gt;db에 add(INSERT, CREATE)후 entity객체에 id배급 -&gt; entity모델객체의 필드들로 <strong>DTO를 만들어서 반환</strong>
</li>
    </ul>
  </li>
  <li>
<strong>assert</strong>는 DTO필드(namedTuple) == query필드(tupe, LegacyRow)의 <strong>필드비교</strong>이며 <strong>DTO필드에 대응되는 query결과 tuple이 요구된다</strong>
</li>
  <li>
<strong>insert메서드결과 DTO에서 id만 받아와서 db engine으로 select -&gt; query_pet</strong>으로 받아주고 <strong>바로 engine으로 delete까지 먹여준다.</strong>
    <ul>
      <li>query_data에 <strong>sqlalchemy insert된 데이터의 id로 데이터만 조회해오면 됨</strong>
</li>
    </ul>
  </li>
  <li>dto필드들과 query필드들을 비교한다.</li>
</ol>

<ul>
  <li>
<strong>요약</strong>
    <ul>
      <li>id제외 faker + insert메서드 -&gt; new_dto</li>
      <li>new_dto속 배정id + engine db select -&gt; query_data -&gt; engine db delete</li>
      <li>assert new_dto.필드 == query_data필드 비교</li>
    </ul>
  </li>
</ul>

<h5 id="02-select-메서드test_select_pet">
<a class="anchor" href="#02-select-%EB%A9%94%EC%84%9C%EB%93%9Ctest_select_pet" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 select 메서드(test_select_pet)</h5>

<ol>
  <li>faker로 select메서드들의 재료들을 <code class="language-plaintext highlighter-rouge">이미db에있으니 id까지</code> 만든다.
    <ul>
      <li><strong>enum type이라면, enumClass(enum value)로 _mock 필드를 만든다.</strong></li>
    </ul>
  </li>
  <li>id포함 재료들 + <strong><code class="language-plaintext highlighter-rouge">entity모델객체</code></strong>를 직접 만든다.
    <ul>
      <li>entity모델객체는 비교를 위한 것이며, sqlalchemy로 CRUD를 직접 하진 않는다??!</li>
    </ul>
  </li>
  <li>
<strong>똑같은 id포함재료들 + engine -&gt; db insert로 삽입생성해서 db에 select할 데이터를 세팅</strong>해놓는다.</li>
  <li>
<strong>select메서드로 <code class="language-plaintext highlighter-rouge">id 및 fk_id경우의수만큼</code> query_data = <code class="language-plaintext highlighter-rouge">List[Entity모델객체]</code>를 반환받는다.</strong>
    <ul>
      <li>(내부) session query(Entity모델).filter등 one() or all()  -&gt; <strong>List[Entity모델객체]</strong>
</li>
    </ul>
  </li>
  <li>
<strong>assert는 (session조작없이 그냥만든) entity모델객체 in List[entity모델객체]</strong>이다</li>
  <li>
<strong>select를 위해 id포함재료들로 만든 db데이터</strong>를 <strong>engine으로 delete</strong>해준다.</li>
</ol>

<ul>
  <li>
<strong>요약</strong>
    <ul>
      <li>id포함 faker -&gt; entity모델 객체</li>
      <li>id포함 재료들 + engine db insert -&gt; db데이터만들어놓기</li>
      <li>id, fk재료들 + select메서드 -&gt; List[entity모델객체들]</li>
      <li>engine db delete</li>
    </ul>
  </li>
</ul>

<h2 id="4-insert-select-메서드들의-interface-제작">
<a class="anchor" href="#4-insert-select-%EB%A9%94%EC%84%9C%EB%93%9C%EB%93%A4%EC%9D%98-interface-%EC%A0%9C%EC%9E%91" aria-hidden="true"><span class="octicon octicon-link"></span></a>4 insert, select 메서드들의 Interface 제작</h2>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930200823231.png" alt="image-20220930200823231"></p>

<h3 id="01-src-data폴더-및-init-생성--interfaces-폴더-및-init생성">
<a class="anchor" href="#01-src-data%ED%8F%B4%EB%8D%94-%EB%B0%8F-init-%EC%83%9D%EC%84%B1--interfaces-%ED%8F%B4%EB%8D%94-%EB%B0%8F-init%EC%83%9D%EC%84%B1" aria-hidden="true"><span class="octicon octicon-link"></span></a>01 src&gt; data폴더 및 init 생성 &gt; interfaces 폴더 및 init생성</h3>

<ul>
  <li>
<strong>db관련된 entities</strong>(Base상속class entity모델)는 <strong><code class="language-plaintext highlighter-rouge">infra layer</code>에 **, **실제로 사용되는 객체와 관련된 models</strong>(DTO)는 <strong><code class="language-plaintext highlighter-rouge">domain layer</code>에</strong> , <strong>interface는 <code class="language-plaintext highlighter-rouge">data layer</code></strong>에 속한다.</li>
</ul>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930231400928.png" alt="image-20220930231400928"></p>

<h3 id="02-각-repositorypy별-repository_interfacepy-만들기">
<a class="anchor" href="#02-%EA%B0%81-repositorypy%EB%B3%84-repository_interfacepy-%EB%A7%8C%EB%93%A4%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>02 각 repository.py별 repository_interface.py 만들기</h3>

<ol>
  <li>
    <p><code class="language-plaintext highlighter-rouge">pet_repository_interface.py</code> 생성</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PetRepositoryInterface</span><span class="p">():</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>각 Interface class들은 추상클래스가 되어야하므로 아래 것들을 import한다.</strong></p>

    <ol>
      <li>abc 패키지에서 추상클래스ABC와 추상메서드모듈</li>
      <li>select메서드의 응답타입 List</li>
      <li>insert메서드의 응답타입(id배정된entity-&gt;DTO)인 models의 DTO</li>
    </ol>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractclassmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Pets</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>interface클래스는 ABC를 상속해서 @abstractmethod로 정의한다.</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractclassmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Pets</span>
   
<span class="k">class</span> <span class="nc">PetRepositoryInterface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
	<span class="s">""" Interface to Pet repository"""</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>추상메서드의 signature는 <code class="language-plaintext highlighter-rouge">repo의 method signature</code>를 복사해서 구성한다</strong></p>

    <ul>
      <li><strong>repo메서드는 class메서드이므로 <code class="language-plaintext highlighter-rouge">cls</code>를 추상메서드용  <code class="language-plaintext highlighter-rouge">self</code>로 변경해서 쓴다</strong></li>
      <li><strong>구현안되고 호출되는 경우는 예외가 발생할 수 있게 <code class="language-plaintext highlighter-rouge">raise Exception("")</code>을 작성해주면 된다.</strong></li>
    </ul>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="o">@</span><span class="n">abstractclassmethod</span>
<span class="k">def</span> 
</code></pre></div>    </div>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PetRepositoryInterface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">""" Interface to Pet repository"""</span>
   
    <span class="o">@</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">insert_pet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">specie</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Pets</span><span class="p">:</span>
        <span class="s">""" abstractmethod """</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"Method not implemented"</span><span class="p">)</span>
   
    <span class="o">@</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">select_pet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pet_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Pets</span><span class="p">]:</span>
        <span class="s">""" abstractmethod """</span>
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"Method not implemented"</span><span class="p">)</span>
   
</code></pre></div>    </div>
  </li>
</ol>

<h4 id="user_repository_interfacepy도-pet꺼를-복사해서-바꿔주기">
<a class="anchor" href="#user_repository_interfacepy%EB%8F%84-pet%EA%BA%BC%EB%A5%BC-%EB%B3%B5%EC%82%AC%ED%95%B4%EC%84%9C-%EB%B0%94%EA%BF%94%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>user_repository_interface.py도 Pet꺼를 복사해서 바꿔주기</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractclassmethod</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span> <span class="nn">src.domain.models</span> <span class="kn">import</span> <span class="n">Users</span>


<span class="k">class</span> <span class="nc">UserRepositoryInterface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="s">""" Interface to Pet repository"""</span>

    <span class="o">@</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">insert_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Users</span><span class="p">:</span>
        <span class="s">""" abstractmethod """</span>
        
        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"Method not implemented"</span><span class="p">)</span>

    <span class="o">@</span><span class="n">abstractclassmethod</span>
    <span class="k">def</span> <span class="nf">select_user</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Users</span><span class="p">]:</span>
        <span class="s">""" abstractmethod """</span>

        <span class="k">raise</span> <span class="nb">Exception</span><span class="p">(</span><span class="s">"Method not implemented"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="03-initpy에-생성한-interface-올려주기">
<a class="anchor" href="#03-initpy%EC%97%90-%EC%83%9D%EC%84%B1%ED%95%9C-interface-%EC%98%AC%EB%A0%A4%EC%A3%BC%EA%B8%B0" aria-hidden="true"><span class="octicon octicon-link"></span></a>03 init.py에 생성한 Interface 올려주기</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">.pet_repository_interface</span> <span class="kn">import</span> <span class="n">PetRepositoryInterface</span>
<span class="kn">from</span> <span class="nn">.user_repository_interface</span> <span class="kn">import</span> <span class="n">UserRepositoryInterface</span>

</code></pre></div></div>

<h3 id="04-각-infrarepo속-repositorypy들의-class들은-datainterfaces-속repository_interfacepy들을-상속해서-구현해야한다">
<a class="anchor" href="#04-%EA%B0%81-infrarepo%EC%86%8D-repositorypy%EB%93%A4%EC%9D%98-class%EB%93%A4%EC%9D%80-datainterfaces-%EC%86%8Drepository_interfacepy%EB%93%A4%EC%9D%84-%EC%83%81%EC%86%8D%ED%95%B4%EC%84%9C-%EA%B5%AC%ED%98%84%ED%95%B4%EC%95%BC%ED%95%9C%EB%8B%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>04 각 infra&gt;repo속&gt; repository.py들의 class들은 data&gt;interfaces 속&gt;repository_interface.py들을 상속해서 구현해야한다.</h3>

<ol>
  <li>
    <p>interface import 후 class가 상속</p>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#...
</span><span class="kn">from</span> <span class="nn">src.data.interfaces</span> <span class="kn">import</span> <span class="n">UserRepositoryInterface</span>
<span class="c1">#...
</span>   
   
<span class="k">class</span> <span class="nc">UserRepository</span><span class="p">(</span><span class="n">UserRepositoryInterface</span><span class="p">):</span>
    <span class="s">"""class to manage User Repository"""</span>
   
</code></pre></div>    </div>

    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="c1">#...
</span><span class="kn">from</span> <span class="nn">src.data.interfaces</span> <span class="kn">import</span> <span class="n">PetRepositoryInterface</span>
<span class="c1">#...
</span>   
   
<span class="k">class</span> <span class="nc">PetRepository</span><span class="p">(</span><span class="n">PetRepositoryInterface</span><span class="p">):</span>
    <span class="s">"""Class to manage Pet Repository"""</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>pytest 돌려서 메서드들 작동 문제없는지 확인</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pytest -vs
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="05-작업br-완료구현-pytest---커밋-push---github에서-new-pr까지">
<a class="anchor" href="#05-%EC%9E%91%EC%97%85br-%EC%99%84%EB%A3%8C%EA%B5%AC%ED%98%84-pytest---%EC%BB%A4%EB%B0%8B-push---github%EC%97%90%EC%84%9C-new-pr%EA%B9%8C%EC%A7%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>05 작업br 완료(구현 pytest) -&gt; 커밋 push -&gt; github에서 new PR까지</h3>

<ol>
  <li>
    <p>status 확인후 add . 후  -am으로 커밋-&gt;실패-&gt;-am커밋</p>

    <ul>
      <li><strong>add를 먼저 날려야 add된상태로 pytest하는 것 같다?!</strong></li>
    </ul>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git status
   
git add 
   
git commit -am "feat: implementing data interfaces"
   
git commit -am "feat: implementing data interfaces"
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>git push는 현재 로그인된 vscode에서 하고 있음.</strong></p>
  </li>
  <li>
    <p><strong>github에 들어가보면, <code class="language-plaintext highlighter-rouge">Compare &amp; pull request</code>가 떠있더라도 <code class="language-plaintext highlighter-rouge">PR탭 &gt; new PR</code>로 들어가는 버릇을 들여보자.</strong></p>

    <ul>
      <li>Comparing change까지 들어가서 코드를 확인하고 <code class="language-plaintext highlighter-rouge">Able to merge</code> 및 <code class="language-plaintext highlighter-rouge">세부코드</code>를 확인하고 <strong>직접 Create PR까지 가자</strong>
</li>
    </ul>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235359040.png" alt="image-20220930235359040"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235410729.png" alt="image-20220930235410729"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235422088.png" alt="image-20220930235422088"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235435742.png" alt="image-20220930235435742"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235515759.png" alt="image-20220930235515759"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235609221.png" alt="image-20220930235609221"></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235628829.png" alt="image-20220930235628829"></p>
  </li>
</ol>

<ul>
  <li>
    <p><strong>merge후 master에 반영되었는지까지 확인하자</strong></p>

    <p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220930235822367.png" alt="image-20220930235822367"></p>
  </li>
</ul>

<h2 id="참고">
<a class="anchor" href="#%EC%B0%B8%EA%B3%A0" aria-hidden="true"><span class="octicon octicon-link"></span></a>참고</h2>

<h4 id="gitignore">
<a class="anchor" href="#gitignore" aria-hidden="true"><span class="octicon octicon-link"></span></a>gitignore</h4>

<ul>
  <li>
    <p>git에 commit되었던 것을 ignore하고 싶을 때</p>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git rm [파일명] --cached
</code></pre></div>    </div>
  </li>
</ul>

<ol>
  <li>console 등에서 init import부터 생기는 pycache폴더</li>
  <li>venv</li>
  <li>연습용 sqlite .db파일</li>
  <li>pytest시 생기는 .pytest_cache 폴더</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>**/__pycache__
venv
storage.db
.pytest_cache
</code></pre></div></div>

<h4 id="sqlalchemy패키지">
<a class="anchor" href="#sqlalchemy%ED%8C%A8%ED%82%A4%EC%A7%80" aria-hidden="true"><span class="octicon octicon-link"></span></a>sqlalchemy패키지</h4>

<ul>
  <li>일반 패키지: create_engine / 칼럼재료들</li>
  <li>.orm 패키지:   relatioship(1관계)/sessionmaker(handler의 enter에서 engine을 묶어서 가지고 있을 놈)</li>
</ul>

<h4 id="clone후-작업-세팅">
<a class="anchor" href="#clone%ED%9B%84-%EC%9E%91%EC%97%85-%EC%84%B8%ED%8C%85" aria-hidden="true"><span class="octicon octicon-link"></span></a>clone후 작업 세팅</h4>

<ol>
  <li>gitignore중에 db파일 있으면 옮겨주기</li>
</ol>

<ul>
  <li>없으면 config import해서 Base + enigne bind한 다음, create_all()해줘야할듯??</li>
</ul>

<p><img src="https://raw.githubusercontent.com/is3js/screenshots/main/image-20220929154256052.png" alt="image-20220929154256052"></p>

<ol>
  <li>github에서 따온 빈 새br에 대해, venv를 만들고 활성화하고  vscode를 연다</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m virtualenv -p python310 venv

.\venv\Scripts\activate
</code></pre></div></div>

<ol>
  <li>최초 requirements.txt 직접 설치</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 install -r requirements.txt
</code></pre></div></div>

<ol>
  <li>최초 pre-commit install 직접 설치</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pre-commit install
</code></pre></div></div>

<h4 id="clone--b-작업테스트완료후--merge까지-정리">
<a class="anchor" href="#clone--b-%EC%9E%91%EC%97%85%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%99%84%EB%A3%8C%ED%9B%84--merge%EA%B9%8C%EC%A7%80-%EC%A0%95%EB%A6%AC" aria-hidden="true"><span class="octicon octicon-link"></span></a>clone -b 작업+테스트완료후 ~ merge까지 정리</h4>

<ol>
  <li>
    <p>status 확인후 add . 후  -am으로 커밋-&gt;실패-&gt;-am커밋</p>

    <ul>
      <li><strong>add를 먼저 날려야 add된상태로 pytest하는 것 같다?!</strong></li>
    </ul>

    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>git status
   
git add 
   
git commit -am "feat: implementing data interfaces"
   
git commit -am "feat: implementing data interfaces"
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>git push는 현재 로그인된 vscode에서 하고 있음.</strong></p>
  </li>
  <li>
    <p><strong>github에 들어가보면, <code class="language-plaintext highlighter-rouge">Compare &amp; pull request</code>가 떠있더라도 <code class="language-plaintext highlighter-rouge">PR탭 &gt; new PR</code>로 들어가는 버릇을 들여보자.</strong></p>
  </li>
</ol>

<ul>
  <li>Comparing change까지 들어가서 코드를 확인하고 <code class="language-plaintext highlighter-rouge">Able to merge</code> 및 <code class="language-plaintext highlighter-rouge">세부코드</code>를 확인하고 <strong>직접 Create PR까지 가자</strong>
</li>
</ul>

<ol>
  <li><strong>merge후 master에 반영되었는지까지 확인하자</strong></li>
</ol>

<h4 id="vscode-설정">
<a class="anchor" href="#vscode-%EC%84%A4%EC%A0%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>vscode 설정</h4>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nl">"files.exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"**/__pycache__"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"**/.pytest_cache"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<h4 id="test정리">
<a class="anchor" href="#test%EC%A0%95%EB%A6%AC" aria-hidden="true"><span class="octicon octicon-link"></span></a>test정리</h4>

<ol>
  <li>
    <p>test_insert_X</p>

    <ol>
      <li>id제외 faker + insert메서드 -&gt; new_dto</li>
      <li>new_dto속 배정id + engine db select -&gt; query_data -&gt; engine db delete</li>
      <li>assert new_dto.필드 == query_data필드 비교</li>
    </ol>
  </li>
  <li>
    <p>test_select_X</p>

    <ol>
      <li>id포함 faker -&gt; entity모델 객체</li>
      <li>id포함 재료들 + engine db insert -&gt; db데이터만들어놓기</li>
      <li>id, fk재료들 + select메서드 -&gt; List[entity모델객체들]</li>
      <li>engine db delete</li>
    </ol>
  </li>
</ol>


  </div><a class="u-url" href="/python/flask/cleanarchitecture/2022/09/01/%ED%81%B4%EB%A6%B0%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90_01_infra_domain_data_layer.html" hidden></a>
</article>


<!-- <script src="https://utteranc.es/client.js"
        repo="is2js/blog_raw"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="blog.chojaeseong.com/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>평범한 한의사 돌범의 엔지니어 도전기</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a href="/feed.xml" target="_blank" title="rss">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://github.com/is2js/" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/yarotheslav" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/yshmarov/" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
